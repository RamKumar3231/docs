<!DOCTYPE HTML>
<html lang="en" class="navy sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Snowflake Terraform Infrastructure Documentation</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="Comprehensive documentation for managing Snowflake infrastructure using Terraform">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Snowflake Terraform Infrastructure Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>Welcome to the Snowflake Terraform Infrastructure documentation. This project provides a comprehensive Infrastructure-as-Code (IaC) solution for managing Snowflake resources using Terraform.</p>
<h2 id="what-is-this-project"><a class="header" href="#what-is-this-project">What is This Project?</a></h2>
<p>This Terraform configuration manages Snowflake infrastructure components including:</p>
<ul>
<li><strong>Roles</strong>: Account roles with hierarchical relationships</li>
<li><strong>Users</strong>: Person users, service users, and legacy service users</li>
<li><strong>Warehouses</strong>: Compute warehouses with configurable sizing and scaling policies</li>
<li><strong>Databases</strong>: Snowflake databases with retention policies</li>
<li><strong>Schemas</strong>: Database schemas with managed access</li>
<li><strong>Tables</strong>: Structured data tables with columns and constraints</li>
<li><strong>Views</strong>: SQL views for data aggregation and presentation</li>
<li><strong>Grants</strong>: Privilege grants for roles on various objects</li>
</ul>
<h2 id="key-features"><a class="header" href="#key-features">Key Features</a></h2>
<ul>
<li><strong>Modular Design</strong>: Reusable modules for roles, users, and warehouses</li>
<li><strong>Provider Aliases</strong>: Separate provider configurations for SECURITYADMIN and SYSADMIN roles</li>
<li><strong>Flexible Configuration</strong>: Map-based configuration for easy resource management</li>
<li><strong>Role-Based Access Control</strong>: Comprehensive RBAC implementation</li>
<li><strong>Dependency Management</strong>: Proper resource dependencies and ordering</li>
</ul>
<h2 id="project-goals"><a class="header" href="#project-goals">Project Goals</a></h2>
<ol>
<li><strong>Infrastructure as Code</strong>: Version control and manage Snowflake infrastructure</li>
<li><strong>Reproducibility</strong>: Consistent infrastructure across environments</li>
<li><strong>Scalability</strong>: Easy addition of new resources through configuration</li>
<li><strong>Security</strong>: Proper role separation and privilege management</li>
<li><strong>Documentation</strong>: Clear documentation for maintainability</li>
</ol>
<h2 id="who-should-use-this"><a class="header" href="#who-should-use-this">Who Should Use This?</a></h2>
<p>This documentation is designed for:</p>
<ul>
<li><strong>DevOps Engineers</strong>: Setting up and maintaining Snowflake infrastructure</li>
<li><strong>Data Engineers</strong>: Understanding the infrastructure structure</li>
<li><strong>Platform Teams</strong>: Managing multi-environment Snowflake deployments</li>
<li><strong>Security Teams</strong>: Reviewing and auditing access controls</li>
</ul>
<h2 id="documentation-structure"><a class="header" href="#documentation-structure">Documentation Structure</a></h2>
<p>This documentation is organized into several sections:</p>
<ul>
<li><strong>Getting Started</strong>: Prerequisites, installation, and initial setup</li>
<li><strong>Architecture Overview</strong>: Project structure and design decisions</li>
<li><strong>Modules</strong>: Detailed documentation for each module</li>
<li><strong>Resources</strong>: Documentation for individual resources</li>
<li><strong>Usage Guide</strong>: Practical examples and workflows</li>
<li><strong>Reference</strong>: Complete variable and output references</li>
</ul>
<p>Let’s get started by reviewing the <a href="getting-started/prerequisites.html">Prerequisites</a>!</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h1>
<p>Before you begin using this Terraform configuration, ensure you have the following prerequisites installed and configured.</p>
<h2 id="required-software"><a class="header" href="#required-software">Required Software</a></h2>
<h3 id="1-terraform"><a class="header" href="#1-terraform">1. Terraform</a></h3>
<p>Terraform version <strong>1.0.0</strong> or higher is required.</p>
<p><strong>Installation:</strong></p>
<ul>
<li>
<p><strong>Windows</strong>: Download from <a href="https://www.terraform.io/downloads">terraform.io/downloads</a> or use Chocolatey:</p>
<pre><code class="language-powershell">choco install terraform
</code></pre>
</li>
<li>
<p><strong>macOS</strong>: Use Homebrew:</p>
<pre><code class="language-bash">brew install terraform
</code></pre>
</li>
<li>
<p><strong>Linux</strong>: Download from <a href="https://www.terraform.io/downloads">terraform.io/downloads</a> or use your package manager</p>
</li>
</ul>
<p><strong>Verify Installation:</strong></p>
<pre><code class="language-bash">terraform version
</code></pre>
<h3 id="2-git"><a class="header" href="#2-git">2. Git</a></h3>
<p>Git is required for version control and cloning repositories.</p>
<p><strong>Installation:</strong></p>
<ul>
<li><strong>Windows</strong>: Download from <a href="https://git-scm.com/download/win">git-scm.com</a></li>
<li><strong>macOS</strong>: <code>brew install git</code></li>
<li><strong>Linux</strong>: Use your distribution’s package manager</li>
</ul>
<p><strong>Verify Installation:</strong></p>
<pre><code class="language-bash">git --version
</code></pre>
<h2 id="snowflake-requirements"><a class="header" href="#snowflake-requirements">Snowflake Requirements</a></h2>
<h3 id="1-snowflake-account"><a class="header" href="#1-snowflake-account">1. Snowflake Account</a></h3>
<p>You need access to a Snowflake account with the following:</p>
<ul>
<li><strong>Organization Name</strong>: Your Snowflake organization identifier</li>
<li><strong>Account Name</strong>: Your Snowflake account identifier</li>
<li><strong>Username</strong>: A user with appropriate privileges</li>
<li><strong>Password</strong>: Authentication credentials</li>
</ul>
<h3 id="2-required-snowflake-roles"><a class="header" href="#2-required-snowflake-roles">2. Required Snowflake Roles</a></h3>
<p>The Terraform configuration uses two provider aliases with different roles:</p>
<ul>
<li><strong>SECURITYADMIN</strong>: Required for managing roles and users</li>
<li><strong>SYSADMIN</strong>: Required for managing warehouses, databases, schemas, tables, and views</li>
</ul>
<p>Your Snowflake user must have the ability to assume these roles. Typically, this means your user should have the <strong>ACCOUNTADMIN</strong> role or be granted the ability to use these roles.</p>
<h3 id="3-initial-warehouse"><a class="header" href="#3-initial-warehouse">3. Initial Warehouse</a></h3>
<p>You need access to an existing warehouse (default: <code>COMPUTE_WH</code>) for Terraform operations. This warehouse is used by the Terraform provider to execute commands.</p>
<h2 id="optional-tools"><a class="header" href="#optional-tools">Optional Tools</a></h2>
<h3 id="1-code-editor"><a class="header" href="#1-code-editor">1. Code Editor</a></h3>
<p>A code editor with Terraform support is recommended:</p>
<ul>
<li><strong>VS Code</strong> with HashiCorp Terraform extension</li>
<li><strong>IntelliJ IDEA</strong> with Terraform plugin</li>
<li><strong>Vim/Neovim</strong> with terraform-ls</li>
</ul>
<h3 id="2-terraform-cloudenterprise-optional"><a class="header" href="#2-terraform-cloudenterprise-optional">2. Terraform Cloud/Enterprise (Optional)</a></h3>
<p>For team collaboration and state management:</p>
<ul>
<li>Terraform Cloud account (free tier available)</li>
<li>Terraform Enterprise for enterprise features</li>
</ul>
<h2 id="system-requirements"><a class="header" href="#system-requirements">System Requirements</a></h2>
<ul>
<li><strong>Operating System</strong>: Windows, macOS, or Linux</li>
<li><strong>RAM</strong>: Minimum 4GB (8GB recommended)</li>
<li><strong>Disk Space</strong>: At least 500MB for Terraform and dependencies</li>
<li><strong>Network</strong>: Internet connection for downloading providers and modules</li>
</ul>
<h2 id="next-steps"><a class="header" href="#next-steps">Next Steps</a></h2>
<p>Once you have all prerequisites installed, proceed to <a href="getting-started/installation.html">Installation</a> to set up the project.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p>This guide will walk you through installing and setting up the Terraform Snowflake infrastructure project.</p>
<h2 id="step-1-clone-or-download-the-project"><a class="header" href="#step-1-clone-or-download-the-project">Step 1: Clone or Download the Project</a></h2>
<p>If the project is in a Git repository:</p>
<pre><code class="language-bash">git clone &lt;repository-url&gt;
cd terraform
</code></pre>
<p>If you have the project files locally, navigate to the project directory:</p>
<pre><code class="language-bash">cd path/to/terraform
</code></pre>
<h2 id="step-2-verify-project-structure"><a class="header" href="#step-2-verify-project-structure">Step 2: Verify Project Structure</a></h2>
<p>Ensure your project has the following structure:</p>
<pre><code>terraform/
├── main.tf
├── provider.tf
├── variables.tf
├── outputs.tf
├── terraform.tfvars
├── modules/
│   └── snowflake/
│       ├── roles/
│       ├── users/
│       └── warehouse/
└── .gitignore
</code></pre>
<h2 id="step-3-initialize-terraform"><a class="header" href="#step-3-initialize-terraform">Step 3: Initialize Terraform</a></h2>
<p>Initialize Terraform to download the required providers:</p>
<pre><code class="language-bash">terraform init
</code></pre>
<p>This command will:</p>
<ul>
<li>Download the Snowflake provider plugin</li>
<li>Create a <code>.terraform</code> directory with provider binaries</li>
<li>Create or update <code>.terraform.lock.hcl</code> with provider version constraints</li>
</ul>
<p><strong>Expected Output:</strong></p>
<pre><code>Initializing the backend...

Initializing provider plugins...
- Finding snowflakedb/snowflake versions matching "latest"...
- Installing snowflakedb/snowflake v0.x.x...
...

Terraform has been successfully initialized!
</code></pre>
<h2 id="step-4-verify-provider-installation"><a class="header" href="#step-4-verify-provider-installation">Step 4: Verify Provider Installation</a></h2>
<p>Check that the Snowflake provider is installed:</p>
<pre><code class="language-bash">terraform providers
</code></pre>
<p>You should see:</p>
<pre><code>Providers required by configuration:
.
└── provider[registry.terraform.io/snowflakedb/snowflake]
</code></pre>
<h2 id="step-5-configure-variables"><a class="header" href="#step-5-configure-variables">Step 5: Configure Variables</a></h2>
<p>Before running Terraform, you need to configure your Snowflake credentials. See <a href="getting-started/configuration.html">Configuration</a> for detailed instructions.</p>
<h2 id="step-6-validate-configuration-optional"><a class="header" href="#step-6-validate-configuration-optional">Step 6: Validate Configuration (Optional)</a></h2>
<p>Validate your Terraform configuration syntax:</p>
<pre><code class="language-bash">terraform validate
</code></pre>
<p><strong>Expected Output:</strong></p>
<pre><code>Success! The configuration is valid.
</code></pre>
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<h3 id="provider-download-issues"><a class="header" href="#provider-download-issues">Provider Download Issues</a></h3>
<p>If <code>terraform init</code> fails to download providers:</p>
<ol>
<li><strong>Check Internet Connection</strong>: Ensure you have internet access</li>
<li><strong>Check Terraform Registry</strong>: Visit <a href="https://registry.terraform.io">registry.terraform.io</a> to verify it’s accessible</li>
<li><strong>Proxy Settings</strong>: If behind a proxy, configure Terraform proxy settings:
<pre><code class="language-bash">export HTTP_PROXY=http://proxy.example.com:8080
export HTTPS_PROXY=http://proxy.example.com:8080
</code></pre>
</li>
</ol>
<h3 id="permission-issues"><a class="header" href="#permission-issues">Permission Issues</a></h3>
<p>If you encounter permission errors:</p>
<ul>
<li><strong>Windows</strong>: Run PowerShell/Command Prompt as Administrator</li>
<li><strong>macOS/Linux</strong>: Use <code>sudo</code> if necessary (though typically not required)</li>
</ul>
<h3 id="provider-version-conflicts"><a class="header" href="#provider-version-conflicts">Provider Version Conflicts</a></h3>
<p>If you see version conflicts:</p>
<ol>
<li>Check <code>.terraform.lock.hcl</code> for locked versions</li>
<li>Update <code>provider.tf</code> if you need a specific provider version</li>
<li>Run <code>terraform init -upgrade</code> to update providers</li>
</ol>
<h2 id="next-steps-1"><a class="header" href="#next-steps-1">Next Steps</a></h2>
<p>After successful installation, proceed to <a href="getting-started/configuration.html">Configuration</a> to set up your Snowflake credentials and variables.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configuration"><a class="header" href="#configuration">Configuration</a></h1>
<p>This guide explains how to configure the Terraform project with your Snowflake credentials and customize the infrastructure.</p>
<h2 id="configuration-files"><a class="header" href="#configuration-files">Configuration Files</a></h2>
<p>The project uses two main configuration files:</p>
<ol>
<li><strong><code>variables.tf</code></strong>: Defines all input variables</li>
<li><strong><code>terraform.tfvars</code></strong>: Contains actual values for your environment</li>
</ol>
<h2 id="required-variables"><a class="header" href="#required-variables">Required Variables</a></h2>
<p>The following variables must be configured in <code>terraform.tfvars</code>:</p>
<h3 id="snowflake-connection-variables"><a class="header" href="#snowflake-connection-variables">Snowflake Connection Variables</a></h3>
<pre><code class="language-hcl">snowflake_organization = "YOUR_ORG_NAME"
snowflake_account      = "YOUR_ACCOUNT_NAME"
snowflake_username     = "YOUR_USERNAME"
snowflake_password     = "YOUR_PASSWORD"
snowflake_role         = "ACCOUNTADMIN"
snowflake_warehouse    = "COMPUTE_WH"
</code></pre>
<h3 id="variable-descriptions"><a class="header" href="#variable-descriptions">Variable Descriptions</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Variable</th><th>Description</th><th>Example</th></tr></thead><tbody>
<tr><td><code>snowflake_organization</code></td><td>Your Snowflake organization identifier</td><td><code>XKVLJOE</code></td></tr>
<tr><td><code>snowflake_account</code></td><td>Your Snowflake account identifier</td><td><code>JO28946</code></td></tr>
<tr><td><code>snowflake_username</code></td><td>Snowflake user for Terraform operations</td><td><code>terraform_user</code></td></tr>
<tr><td><code>snowflake_password</code></td><td>Password for the Snowflake user</td><td><code>SecurePassword123!</code></td></tr>
<tr><td><code>snowflake_role</code></td><td>Initial role to use (typically ACCOUNTADMIN)</td><td><code>ACCOUNTADMIN</code></td></tr>
<tr><td><code>snowflake_warehouse</code></td><td>Warehouse for Terraform operations</td><td><code>COMPUTE_WH</code></td></tr>
</tbody></table>
</div>
<h2 id="creating-terraformtfvars"><a class="header" href="#creating-terraformtfvars">Creating terraform.tfvars</a></h2>
<ol>
<li><strong>Copy the example</strong> (if provided) or create a new file:</li>
</ol>
<pre><code class="language-bash">cp terraform.tfvars.example terraform.tfvars
</code></pre>
<ol start="2">
<li><strong>Edit <code>terraform.tfvars</code></strong> with your values:</li>
</ol>
<pre><code class="language-hcl"># terraform.tfvars
snowflake_organization = "YOUR_ORG_NAME"
snowflake_account      = "YOUR_ACCOUNT_NAME"
snowflake_username     = "YOUR_USERNAME"
snowflake_password     = "YOUR_PASSWORD"
snowflake_role         = "ACCOUNTADMIN"
snowflake_warehouse    = "COMPUTE_WH"
</code></pre>
<h2 id="security-best-practices"><a class="header" href="#security-best-practices">Security Best Practices</a></h2>
<h3 id="1-never-commit-terraformtfvars"><a class="header" href="#1-never-commit-terraformtfvars">1. Never Commit terraform.tfvars</a></h3>
<p>The <code>.gitignore</code> file should already exclude <code>*.tfvars</code> files. Verify this:</p>
<pre><code class="language-bash">cat .gitignore | grep tfvars
</code></pre>
<h3 id="2-use-environment-variables-alternative"><a class="header" href="#2-use-environment-variables-alternative">2. Use Environment Variables (Alternative)</a></h3>
<p>Instead of <code>terraform.tfvars</code>, you can use environment variables:</p>
<pre><code class="language-bash"># Windows PowerShell
$env:TF_VAR_snowflake_username = "YOUR_USERNAME"
$env:TF_VAR_snowflake_password = "YOUR_PASSWORD"
$env:TF_VAR_snowflake_organization = "YOUR_ORG_NAME"
$env:TF_VAR_snowflake_account = "YOUR_ACCOUNT_NAME"
$env:TF_VAR_snowflake_role = "ACCOUNTADMIN"
$env:TF_VAR_snowflake_warehouse = "COMPUTE_WH"

# Linux/macOS
export TF_VAR_snowflake_username="YOUR_USERNAME"
export TF_VAR_snowflake_password="YOUR_PASSWORD"
export TF_VAR_snowflake_organization="YOUR_ORG_NAME"
export TF_VAR_snowflake_account="YOUR_ACCOUNT_NAME"
export TF_VAR_snowflake_role="ACCOUNTADMIN"
export TF_VAR_snowflake_warehouse="COMPUTE_WH"
</code></pre>
<h3 id="3-use-terraform-cloudenterprise-variables"><a class="header" href="#3-use-terraform-cloudenterprise-variables">3. Use Terraform Cloud/Enterprise Variables</a></h3>
<p>For team environments, use Terraform Cloud or Enterprise to store sensitive variables:</p>
<ol>
<li>Navigate to your workspace</li>
<li>Go to Variables</li>
<li>Add variables as “Sensitive” for passwords</li>
</ol>
<h3 id="4-use-key-management-services"><a class="header" href="#4-use-key-management-services">4. Use Key Management Services</a></h3>
<p>For production, consider using:</p>
<ul>
<li>AWS Secrets Manager</li>
<li>Azure Key Vault</li>
<li>HashiCorp Vault</li>
<li>Google Secret Manager</li>
</ul>
<h2 id="customizing-infrastructure"><a class="header" href="#customizing-infrastructure">Customizing Infrastructure</a></h2>
<h3 id="modifying-roles"><a class="header" href="#modifying-roles">Modifying Roles</a></h3>
<p>Edit the <code>role_map</code> in <code>main.tf</code>:</p>
<pre><code class="language-hcl">module "ALL_ROLES" {
  source = "./modules/snowflake/roles"
  
  role_map = {
    "YOUR_ROLE" = {
      parent_role_name = "SYSADMIN"
      comment          = "Your role description"
    }
  }
}
</code></pre>
<h3 id="modifying-users"><a class="header" href="#modifying-users">Modifying Users</a></h3>
<p>Edit the <code>user_map</code> in <code>main.tf</code>:</p>
<pre><code class="language-hcl">module "ALL_USERS" {
  source = "./modules/snowflake/users"
  
  user_map = {
    "YOUR_USER" = {
      first_name  = "John"
      last_name   = "Doe"
      email       = "john.doe@example.com"
      user_type   = "person"
      roles_to_assign = [module.ALL_ROLES.ROLES.YOUR_ROLE.name]
    }
  }
}
</code></pre>
<h3 id="modifying-warehouses"><a class="header" href="#modifying-warehouses">Modifying Warehouses</a></h3>
<p>Edit the <code>warehouse_map</code> in <code>main.tf</code>:</p>
<pre><code class="language-hcl">module "ALL_WAREHOUSES" {
  source = "./modules/snowflake/warehouse"
  
  warehouse_map = {
    "YOUR_WAREHOUSE" = {
      warehouse_type = "STANDARD"
      warehouse_generation = "2"
      warehouse_size = "SMALL"
      # ... other configuration
    }
  }
}
</code></pre>
<h2 id="validating-configuration"><a class="header" href="#validating-configuration">Validating Configuration</a></h2>
<p>After configuring variables, validate your setup:</p>
<pre><code class="language-bash"># Validate syntax
terraform validate

# Format code
terraform fmt

# Plan changes (dry run)
terraform plan
</code></pre>
<h2 id="environment-specific-configuration"><a class="header" href="#environment-specific-configuration">Environment-Specific Configuration</a></h2>
<p>For multiple environments, use separate <code>.tfvars</code> files:</p>
<pre><code class="language-bash"># Development
terraform.tfvars.dev

# Staging
terraform.tfvars.staging

# Production
terraform.tfvars.prod
</code></pre>
<p>Apply with:</p>
<pre><code class="language-bash">terraform apply -var-file="terraform.tfvars.dev"
</code></pre>
<h2 id="next-steps-2"><a class="header" href="#next-steps-2">Next Steps</a></h2>
<p>Once configured, proceed to <a href="getting-started/initial-setup.html">Initial Setup</a> to create your first resources.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="initial-setup"><a class="header" href="#initial-setup">Initial Setup</a></h1>
<p>This guide walks you through the initial setup and first deployment of your Snowflake infrastructure.</p>
<h2 id="pre-flight-checklist"><a class="header" href="#pre-flight-checklist">Pre-Flight Checklist</a></h2>
<p>Before running Terraform, ensure:</p>
<ul>
<li><input disabled="" type="checkbox"/>
Terraform is installed and initialized</li>
<li><input disabled="" type="checkbox"/>
<code>terraform.tfvars</code> is configured with your Snowflake credentials</li>
<li><input disabled="" type="checkbox"/>
Your Snowflake user has ACCOUNTADMIN role or can assume SECURITYADMIN and SYSADMIN</li>
<li><input disabled="" type="checkbox"/>
An initial warehouse (e.g., <code>COMPUTE_WH</code>) exists in your Snowflake account</li>
<li><input disabled="" type="checkbox"/>
You have reviewed the configuration in <code>main.tf</code></li>
</ul>
<h2 id="step-1-review-the-plan"><a class="header" href="#step-1-review-the-plan">Step 1: Review the Plan</a></h2>
<p>Always review what Terraform will create before applying:</p>
<pre><code class="language-bash">terraform plan
</code></pre>
<p>This command will:</p>
<ul>
<li>Show all resources that will be created</li>
<li>Display any changes to existing resources</li>
<li>Highlight any errors or warnings</li>
</ul>
<p><strong>Review the output carefully</strong> to ensure it matches your expectations.</p>
<h3 id="understanding-plan-output"><a class="header" href="#understanding-plan-output">Understanding Plan Output</a></h3>
<p>The plan output shows:</p>
<ul>
<li><strong><code>+</code></strong>: Resources to be created</li>
<li><strong><code>-</code></strong>: Resources to be destroyed</li>
<li><strong><code>~</code></strong>: Resources to be modified</li>
<li><strong><code>-/+</code></strong>: Resources to be replaced</li>
</ul>
<p>Example:</p>
<pre><code>Plan: 25 to add, 0 to change, 0 to destroy.
</code></pre>
<h2 id="step-2-apply-the-configuration"><a class="header" href="#step-2-apply-the-configuration">Step 2: Apply the Configuration</a></h2>
<p>Once you’ve reviewed the plan, apply the configuration:</p>
<pre><code class="language-bash">terraform apply
</code></pre>
<p>Terraform will:</p>
<ol>
<li>Show the plan again</li>
<li>Ask for confirmation: <code>Do you want to perform these actions?</code></li>
<li>Type <code>yes</code> to proceed</li>
</ol>
<h3 id="automatic-confirmation-optional"><a class="header" href="#automatic-confirmation-optional">Automatic Confirmation (Optional)</a></h3>
<p>For automated deployments, use:</p>
<pre><code class="language-bash">terraform apply -auto-approve
</code></pre>
<p><strong>Warning</strong>: Use <code>-auto-approve</code> only in automated pipelines, not for manual operations.</p>
<h2 id="step-3-monitor-the-execution"><a class="header" href="#step-3-monitor-the-execution">Step 3: Monitor the Execution</a></h2>
<p>Terraform will create resources in the following order:</p>
<ol>
<li><strong>Roles</strong> (via <code>ALL_ROLES</code> module)</li>
<li><strong>Warehouses</strong> (via <code>ALL_WAREHOUSES</code> module)</li>
<li><strong>Users</strong> (via <code>ALL_USERS</code> module)</li>
<li><strong>Databases</strong> (<code>TEST_DB</code>, <code>TEST_DB2</code>)</li>
<li><strong>Schemas</strong> (<code>ADS</code>)</li>
<li><strong>Tables</strong> (<code>FACEBOOK_ADS</code>)</li>
<li><strong>Views</strong> (<code>AGG_FACEBOOK_ADS</code>)</li>
<li><strong>Grants</strong> (various privilege grants)</li>
</ol>
<h3 id="expected-output"><a class="header" href="#expected-output">Expected Output</a></h3>
<pre><code>module.ALL_ROLES.snowflake_account_role.ROLES["ANALYST"]: Creating...
module.ALL_ROLES.snowflake_account_role.ROLES["DATA_ENGINEER"]: Creating...
...
Apply complete! Resources: 25 added, 0 changed, 0 destroyed.
</code></pre>
<h2 id="step-4-verify-resources"><a class="header" href="#step-4-verify-resources">Step 4: Verify Resources</a></h2>
<p>After successful application, verify resources in Snowflake:</p>
<h3 id="using-snowflake-web-ui"><a class="header" href="#using-snowflake-web-ui">Using Snowflake Web UI</a></h3>
<ol>
<li>Log into Snowflake</li>
<li>Navigate to <strong>Admin</strong> → <strong>Users &amp; Roles</strong></li>
<li>Verify roles and users are created</li>
<li>Navigate to <strong>Admin</strong> → <strong>Warehouses</strong></li>
<li>Verify warehouses are created</li>
<li>Navigate to <strong>Data</strong> → <strong>Databases</strong></li>
<li>Verify databases, schemas, tables, and views</li>
</ol>
<h3 id="using-terraform-outputs"><a class="header" href="#using-terraform-outputs">Using Terraform Outputs</a></h3>
<p>View outputs:</p>
<pre><code class="language-bash">terraform output
</code></pre>
<p>View specific outputs:</p>
<pre><code class="language-bash">terraform output ALL_ROLES
terraform output ALL_USERS
terraform output ALL_WAREHOUSES
</code></pre>
<h2 id="step-5-test-access"><a class="header" href="#step-5-test-access">Step 5: Test Access</a></h2>
<p>Test that users can access their assigned resources:</p>
<ol>
<li><strong>Test User Login</strong>: Log in as a created user</li>
<li><strong>Test Warehouse Access</strong>: Verify users can use assigned warehouses</li>
<li><strong>Test Database Access</strong>: Verify users can query assigned databases</li>
<li><strong>Test Role Hierarchy</strong>: Verify role inheritance works correctly</li>
</ol>
<h2 id="common-issues-and-solutions"><a class="header" href="#common-issues-and-solutions">Common Issues and Solutions</a></h2>
<h3 id="issue-provider-authentication-failed"><a class="header" href="#issue-provider-authentication-failed">Issue: Provider Authentication Failed</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: 390100: Invalid username or password
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Verify credentials in <code>terraform.tfvars</code></li>
<li>Check if the user account is locked</li>
<li>Ensure the user has necessary privileges</li>
</ul>
<h3 id="issue-insufficient-privileges"><a class="header" href="#issue-insufficient-privileges">Issue: Insufficient Privileges</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: 001003 (42000): SQL access control error: Insufficient privileges
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Ensure your user has ACCOUNTADMIN role</li>
<li>Or ensure your user can assume SECURITYADMIN and SYSADMIN roles</li>
<li>Grant necessary privileges to your user</li>
</ul>
<h3 id="issue-resource-already-exists"><a class="header" href="#issue-resource-already-exists">Issue: Resource Already Exists</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: 2003: Object already exists
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Import existing resources: <code>terraform import &lt;resource_type&gt;.&lt;name&gt; &lt;snowflake_identifier&gt;</code></li>
<li>Or remove existing resources from Snowflake manually</li>
<li>Or modify resource names in configuration</li>
</ul>
<h3 id="issue-dependency-errors"><a class="header" href="#issue-dependency-errors">Issue: Dependency Errors</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: Resource depends on resource that doesn't exist
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Review resource dependencies in <code>main.tf</code></li>
<li>Ensure modules are created in correct order</li>
<li>Check that referenced resources exist</li>
</ul>
<h2 id="state-management"><a class="header" href="#state-management">State Management</a></h2>
<h3 id="viewing-state"><a class="header" href="#viewing-state">Viewing State</a></h3>
<pre><code class="language-bash">terraform show
</code></pre>
<h3 id="listing-resources"><a class="header" href="#listing-resources">Listing Resources</a></h3>
<pre><code class="language-bash">terraform state list
</code></pre>
<h3 id="inspecting-a-resource"><a class="header" href="#inspecting-a-resource">Inspecting a Resource</a></h3>
<pre><code class="language-bash">terraform state show module.ALL_ROLES.snowflake_account_role.ROLES["ANALYST"]
</code></pre>
<h2 id="next-steps-3"><a class="header" href="#next-steps-3">Next Steps</a></h2>
<p>After successful initial setup:</p>
<ol>
<li><strong>Review Resources</strong>: Verify all resources are created correctly</li>
<li><strong>Test Functionality</strong>: Test user access and permissions</li>
<li><strong>Customize Configuration</strong>: Modify <code>main.tf</code> for your specific needs</li>
<li><strong>Set Up CI/CD</strong>: Integrate with your deployment pipeline</li>
<li><strong>Document Customizations</strong>: Document any environment-specific changes</li>
</ol>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<ol>
<li><strong>Always Plan First</strong>: Never apply without reviewing the plan</li>
<li><strong>Version Control</strong>: Commit your Terraform code to version control</li>
<li><strong>State Management</strong>: Use remote state (Terraform Cloud, S3, etc.) for teams</li>
<li><strong>Backup State</strong>: Regularly backup your <code>terraform.tfstate</code> file</li>
<li><strong>Review Changes</strong>: Review all changes before applying in production</li>
</ol>
<h2 id="troubleshooting-1"><a class="header" href="#troubleshooting-1">Troubleshooting</a></h2>
<p>If you encounter issues:</p>
<ol>
<li><strong>Check Logs</strong>: Review Terraform output for detailed error messages</li>
<li><strong>Validate Configuration</strong>: Run <code>terraform validate</code></li>
<li><strong>Format Code</strong>: Run <code>terraform fmt</code> to ensure proper formatting</li>
<li><strong>Check Dependencies</strong>: Verify all resource dependencies are correct</li>
<li><strong>Review State</strong>: Use <code>terraform state list</code> to see current state</li>
</ol>
<p>For more detailed information, see the <a href="getting-started/../usage/basic-usage.html">Usage Guide</a> and <a href="getting-started/../usage/best-practices.html">Best Practices</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="project-structure"><a class="header" href="#project-structure">Project Structure</a></h1>
<p>This document explains the structure and organization of the Terraform project.</p>
<h2 id="directory-layout"><a class="header" href="#directory-layout">Directory Layout</a></h2>
<pre><code>terraform/
├── main.tf                    # Main configuration with modules and resources
├── provider.tf                # Provider configuration
├── variables.tf               # Variable definitions
├── outputs.tf                 # Output definitions
├── terraform.tfvars           # Variable values (not in version control)
├── .gitignore                 # Git ignore rules
├── .terraform/                # Terraform provider binaries (generated)
├── .terraform.lock.hcl        # Provider version lock file
├── terraform.tfstate          # State file (not in version control)
├── terraform.tfstate.backup   # State backup (not in version control)
└── modules/
    └── snowflake/
        ├── roles/
        │   ├── main.tf        # Role resource definitions
        │   ├── variables.tf   # Role module variables
        │   └── outputs.tf     # Role module outputs
        ├── users/
        │   ├── main.tf        # User resource definitions
        │   ├── variables.tf   # User module variables
        │   └── outputs.tf     # User module outputs
        └── warehouse/
            ├── main.tf        # Warehouse resource definitions
            ├── variables.tf   # Warehouse module variables
            └── outputs.tf     # Warehouse module outputs
</code></pre>
<h2 id="file-descriptions"><a class="header" href="#file-descriptions">File Descriptions</a></h2>
<h3 id="root-level-files"><a class="header" href="#root-level-files">Root Level Files</a></h3>
<h4 id="maintf"><a class="header" href="#maintf"><code>main.tf</code></a></h4>
<p>The primary configuration file containing:</p>
<ul>
<li>Module declarations for roles, users, and warehouses</li>
<li>Direct resource definitions (databases, schemas, tables, views)</li>
<li>Grant resources for privilege management</li>
</ul>
<h4 id="providertf"><a class="header" href="#providertf"><code>provider.tf</code></a></h4>
<p>Defines the Terraform providers:</p>
<ul>
<li>Snowflake provider configuration</li>
<li>Provider aliases for different roles (SECURITYADMIN, SYSADMIN)</li>
<li>Required provider versions</li>
</ul>
<h4 id="variablestf"><a class="header" href="#variablestf"><code>variables.tf</code></a></h4>
<p>Defines all input variables:</p>
<ul>
<li>Snowflake connection parameters</li>
<li>Default values</li>
<li>Variable types and descriptions</li>
</ul>
<h4 id="outputstf"><a class="header" href="#outputstf"><code>outputs.tf</code></a></h4>
<p>Defines outputs from the root module:</p>
<ul>
<li>Module outputs</li>
<li>Resource references</li>
<li>Sensitive output flags</li>
</ul>
<h4 id="terraformtfvars"><a class="header" href="#terraformtfvars"><code>terraform.tfvars</code></a></h4>
<p>Contains actual variable values:</p>
<ul>
<li><strong>Not committed to version control</strong> (in <code>.gitignore</code>)</li>
<li>Contains sensitive credentials</li>
<li>Environment-specific values</li>
</ul>
<h3 id="module-structure"><a class="header" href="#module-structure">Module Structure</a></h3>
<p>The project uses a modular architecture with three main modules:</p>
<h4 id="modulessnowflakeroles"><a class="header" href="#modulessnowflakeroles"><code>modules/snowflake/roles/</code></a></h4>
<p>Manages Snowflake account roles:</p>
<ul>
<li>Creates roles with hierarchical relationships</li>
<li>Grants roles to parent roles</li>
<li>Outputs role information</li>
</ul>
<h4 id="modulessnowflakeusers"><a class="header" href="#modulessnowflakeusers"><code>modules/snowflake/users/</code></a></h4>
<p>Manages Snowflake users:</p>
<ul>
<li>Supports person users, service users, and legacy service users</li>
<li>Assigns roles to users</li>
<li>Configures user defaults (warehouse, role)</li>
</ul>
<h4 id="modulessnowflakewarehouse"><a class="header" href="#modulessnowflakewarehouse"><code>modules/snowflake/warehouse/</code></a></h4>
<p>Manages Snowflake warehouses:</p>
<ul>
<li>Creates warehouses with configurable properties</li>
<li>Grants warehouse privileges to roles</li>
<li>Supports multiple warehouse configurations</li>
</ul>
<h2 id="design-principles"><a class="header" href="#design-principles">Design Principles</a></h2>
<h3 id="1-modularity"><a class="header" href="#1-modularity">1. Modularity</a></h3>
<p>Resources are organized into reusable modules:</p>
<ul>
<li><strong>Reusability</strong>: Modules can be used across different configurations</li>
<li><strong>Maintainability</strong>: Changes to module logic are centralized</li>
<li><strong>Testability</strong>: Modules can be tested independently</li>
</ul>
<h3 id="2-separation-of-concerns"><a class="header" href="#2-separation-of-concerns">2. Separation of Concerns</a></h3>
<p>Different resource types are managed by different modules:</p>
<ul>
<li><strong>Roles Module</strong>: Handles role creation and hierarchy</li>
<li><strong>Users Module</strong>: Handles user creation and role assignment</li>
<li><strong>Warehouse Module</strong>: Handles warehouse creation and privileges</li>
</ul>
<h3 id="3-provider-aliases"><a class="header" href="#3-provider-aliases">3. Provider Aliases</a></h3>
<p>Different provider aliases for different operations:</p>
<ul>
<li><strong>SECURITYADMIN</strong>: For role and user management</li>
<li><strong>SYSADMIN</strong>: For warehouse, database, and object management</li>
</ul>
<h3 id="4-map-based-configuration"><a class="header" href="#4-map-based-configuration">4. Map-Based Configuration</a></h3>
<p>Resources are defined using maps for flexibility:</p>
<ul>
<li>Easy to add/remove resources</li>
<li>Consistent structure</li>
<li>Easy to iterate over</li>
</ul>
<h2 id="resource-dependencies"><a class="header" href="#resource-dependencies">Resource Dependencies</a></h2>
<p>The following dependency order is enforced:</p>
<pre><code>Roles
  ↓
Warehouses (may reference roles)
  ↓
Users (references roles and warehouses)
  ↓
Databases
  ↓
Schemas (references databases)
  ↓
Tables (references schemas)
  ↓
Views (references tables)
  ↓
Grants (references all above)
</code></pre>
<h2 id="state-management-1"><a class="header" href="#state-management-1">State Management</a></h2>
<h3 id="local-state-default"><a class="header" href="#local-state-default">Local State (Default)</a></h3>
<ul>
<li>Stored in <code>terraform.tfstate</code></li>
<li>Backup in <code>terraform.tfstate.backup</code></li>
<li><strong>Not committed to version control</strong></li>
</ul>
<h3 id="remote-state-recommended-for-teams"><a class="header" href="#remote-state-recommended-for-teams">Remote State (Recommended for Teams)</a></h3>
<p>Consider using:</p>
<ul>
<li><strong>Terraform Cloud</strong>: Free tier available</li>
<li><strong>AWS S3</strong>: With DynamoDB for locking</li>
<li><strong>Azure Storage</strong>: With state locking</li>
<li><strong>Google Cloud Storage</strong>: With state locking</li>
</ul>
<h2 id="version-control"><a class="header" href="#version-control">Version Control</a></h2>
<h3 id="committed-files"><a class="header" href="#committed-files">Committed Files</a></h3>
<ul>
<li><code>*.tf</code> files (configuration)</li>
<li><code>.gitignore</code></li>
<li><code>.terraform.lock.hcl</code> (provider versions)</li>
</ul>
<h3 id="ignored-files"><a class="header" href="#ignored-files">Ignored Files</a></h3>
<ul>
<li><code>*.tfvars</code> (contains secrets)</li>
<li><code>terraform.tfstate*</code> (state files)</li>
<li><code>.terraform/</code> (provider binaries)</li>
</ul>
<h2 id="extension-points"><a class="header" href="#extension-points">Extension Points</a></h2>
<h3 id="adding-new-modules"><a class="header" href="#adding-new-modules">Adding New Modules</a></h3>
<ol>
<li>Create directory: <code>modules/snowflake/&lt;module-name&gt;/</code></li>
<li>Add <code>main.tf</code>, <code>variables.tf</code>, <code>outputs.tf</code></li>
<li>Reference in root <code>main.tf</code></li>
</ol>
<h3 id="adding-new-resources"><a class="header" href="#adding-new-resources">Adding New Resources</a></h3>
<ol>
<li>Add resource definition to appropriate file</li>
<li>Add variables if needed</li>
<li>Add outputs if needed</li>
<li>Update documentation</li>
</ol>
<h3 id="environment-specific-configurations"><a class="header" href="#environment-specific-configurations">Environment-Specific Configurations</a></h3>
<p>Use separate <code>.tfvars</code> files:</p>
<ul>
<li><code>terraform.tfvars.dev</code></li>
<li><code>terraform.tfvars.staging</code></li>
<li><code>terraform.tfvars.prod</code></li>
</ul>
<p>Apply with: <code>terraform apply -var-file="terraform.tfvars.dev"</code></p>
<h2 id="best-practices-1"><a class="header" href="#best-practices-1">Best Practices</a></h2>
<ol>
<li><strong>Keep Modules Focused</strong>: Each module should have a single responsibility</li>
<li><strong>Use Variables</strong>: Don’t hardcode values</li>
<li><strong>Document Dependencies</strong>: Use <code>depends_on</code> explicitly when needed</li>
<li><strong>Version Control</strong>: Commit all <code>.tf</code> files, never commit <code>.tfvars</code> or state</li>
<li><strong>Remote State</strong>: Use remote state for team collaboration</li>
<li><strong>Code Review</strong>: Review all changes before applying</li>
</ol>
<h2 id="next-steps-4"><a class="header" href="#next-steps-4">Next Steps</a></h2>
<ul>
<li>Learn about <a href="architecture/provider-configuration.html">Provider Configuration</a></li>
<li>Understand <a href="architecture/module-architecture.html">Module Architecture</a></li>
<li>Review <a href="architecture/../modules/roles-module.html">Module Documentation</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="provider-configuration"><a class="header" href="#provider-configuration">Provider Configuration</a></h1>
<p>This document explains the Snowflake provider configuration and how provider aliases are used to manage different aspects of Snowflake infrastructure.</p>
<h2 id="provider-overview"><a class="header" href="#provider-overview">Provider Overview</a></h2>
<p>The project uses the official Snowflake Terraform provider from <code>snowflakedb/snowflake</code>. The provider is configured in <code>provider.tf</code> with multiple aliases to support role-based operations.</p>
<h2 id="provider-declaration"><a class="header" href="#provider-declaration">Provider Declaration</a></h2>
<h3 id="base-configuration"><a class="header" href="#base-configuration">Base Configuration</a></h3>
<pre><code class="language-hcl">terraform {
  required_providers {
    snowflake = {
      source = "snowflakedb/snowflake"
    }
  }
}
</code></pre>
<p>This declares that the Snowflake provider is required. Terraform will automatically download the latest compatible version during <code>terraform init</code>.</p>
<h2 id="provider-aliases"><a class="header" href="#provider-aliases">Provider Aliases</a></h2>
<p>The project uses <strong>provider aliases</strong> to operate with different Snowflake roles. This is necessary because different operations require different privileges.</p>
<h3 id="securityadmin-provider"><a class="header" href="#securityadmin-provider">SECURITYADMIN Provider</a></h3>
<pre><code class="language-hcl">provider "snowflake" {
  alias             = "snowflake_securityadmin"
  organization_name = var.snowflake_organization
  account_name      = var.snowflake_account
  user              = var.snowflake_username
  password          = var.snowflake_password
  role              = "SECURITYADMIN"
  warehouse         = var.snowflake_warehouse
}
</code></pre>
<p><strong>Used for:</strong></p>
<ul>
<li>Creating and managing roles</li>
<li>Creating and managing users</li>
<li>Granting roles to users</li>
</ul>
<p><strong>Required Privileges:</strong></p>
<ul>
<li>Ability to assume <code>SECURITYADMIN</code> role</li>
<li>Typically requires <code>ACCOUNTADMIN</code> role or explicit grant</li>
</ul>
<h3 id="sysadmin-provider"><a class="header" href="#sysadmin-provider">SYSADMIN Provider</a></h3>
<pre><code class="language-hcl">provider "snowflake" {
  alias             = "snowflake_sysadmin"
  organization_name = var.snowflake_organization
  account_name      = var.snowflake_account
  user              = var.snowflake_username
  password          = var.snowflake_password
  role              = "SYSADMIN"
  warehouse         = var.snowflake_warehouse
  preview_features_enabled = ["snowflake_table_resource"]
}
</code></pre>
<p><strong>Used for:</strong></p>
<ul>
<li>Creating and managing warehouses</li>
<li>Creating and managing databases</li>
<li>Creating and managing schemas</li>
<li>Creating and managing tables</li>
<li>Creating and managing views</li>
<li>Granting privileges on objects</li>
</ul>
<p><strong>Required Privileges:</strong></p>
<ul>
<li>Ability to assume <code>SYSADMIN</code> role</li>
<li>Typically requires <code>ACCOUNTADMIN</code> role or explicit grant</li>
</ul>
<p><strong>Preview Features:</strong></p>
<ul>
<li><code>snowflake_table_resource</code>: Enables the table resource (may be required for certain table operations)</li>
</ul>
<h2 id="provider-parameters"><a class="header" href="#provider-parameters">Provider Parameters</a></h2>
<h3 id="connection-parameters"><a class="header" href="#connection-parameters">Connection Parameters</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Example</th></tr></thead><tbody>
<tr><td><code>organization_name</code></td><td>Snowflake organization identifier</td><td><code>XKVLJOE</code></td></tr>
<tr><td><code>account_name</code></td><td>Snowflake account identifier</td><td><code>JO28946</code></td></tr>
<tr><td><code>user</code></td><td>Username for authentication</td><td><code>terraform_user</code></td></tr>
<tr><td><code>password</code></td><td>Password for authentication</td><td><code>SecurePassword123!</code></td></tr>
<tr><td><code>role</code></td><td>Role to assume</td><td><code>SECURITYADMIN</code> or <code>SYSADMIN</code></td></tr>
<tr><td><code>warehouse</code></td><td>Warehouse to use for operations</td><td><code>COMPUTE_WH</code></td></tr>
</tbody></table>
</div>
<h3 id="alternative-authentication-methods"><a class="header" href="#alternative-authentication-methods">Alternative Authentication Methods</a></h3>
<p>The Snowflake provider also supports:</p>
<h4 id="key-pair-authentication"><a class="header" href="#key-pair-authentication">Key Pair Authentication</a></h4>
<pre><code class="language-hcl">provider "snowflake" {
  alias             = "snowflake_securityadmin"
  organization_name = var.snowflake_organization
  account_name      = var.snowflake_account
  user              = var.snowflake_username
  private_key_path  = var.private_key_path
  role              = "SECURITYADMIN"
  warehouse         = var.snowflake_warehouse
}
</code></pre>
<h4 id="oauth-authentication"><a class="header" href="#oauth-authentication">OAuth Authentication</a></h4>
<pre><code class="language-hcl">provider "snowflake" {
  alias             = "snowflake_securityadmin"
  organization_name = var.snowflake_organization
  account_name      = var.snowflake_account
  oauth_access_token = var.oauth_token
  role              = "SECURITYADMIN"
  warehouse         = var.snowflake_warehouse
}
</code></pre>
<h2 id="using-provider-aliases"><a class="header" href="#using-provider-aliases">Using Provider Aliases</a></h2>
<p>Provider aliases are referenced in resources and modules using the <code>provider</code> parameter:</p>
<h3 id="in-modules"><a class="header" href="#in-modules">In Modules</a></h3>
<pre><code class="language-hcl">module "ALL_ROLES" {
  source = "./modules/snowflake/roles"
  
  providers = {
    snowflake = snowflake.snowflake_securityadmin
  }
  
  role_map = { ... }
}
</code></pre>
<h3 id="in-resources"><a class="header" href="#in-resources">In Resources</a></h3>
<pre><code class="language-hcl">resource "snowflake_database" "TEST_DB" {
  name    = "TEST_DB"
  comment = "Test database"
  
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h2 id="why-use-provider-aliases"><a class="header" href="#why-use-provider-aliases">Why Use Provider Aliases?</a></h2>
<h3 id="1-principle-of-least-privilege"><a class="header" href="#1-principle-of-least-privilege">1. Principle of Least Privilege</a></h3>
<p>Different operations require different privileges:</p>
<ul>
<li><strong>SECURITYADMIN</strong>: For security-related operations (roles, users)</li>
<li><strong>SYSADMIN</strong>: For system administration (warehouses, databases, objects)</li>
</ul>
<h3 id="2-security-best-practices"><a class="header" href="#2-security-best-practices">2. Security Best Practices</a></h3>
<p>Using the appropriate role for each operation:</p>
<ul>
<li>Reduces risk of privilege escalation</li>
<li>Makes it clear which operations require which privileges</li>
<li>Easier to audit and review</li>
</ul>
<h3 id="3-operational-clarity"><a class="header" href="#3-operational-clarity">3. Operational Clarity</a></h3>
<p>Clear separation of concerns:</p>
<ul>
<li>Security operations use SECURITYADMIN</li>
<li>System operations use SYSADMIN</li>
<li>Easy to understand what each resource requires</li>
</ul>
<h2 id="provider-version-constraints"><a class="header" href="#provider-version-constraints">Provider Version Constraints</a></h2>
<h3 id="current-configuration"><a class="header" href="#current-configuration">Current Configuration</a></h3>
<p>The current configuration doesn’t specify a version constraint, so Terraform will use the latest version. For production, consider pinning the version:</p>
<pre><code class="language-hcl">terraform {
  required_providers {
    snowflake = {
      source  = "snowflakedb/snowflake"
      version = "~&gt; 0.90"  # Use version 0.90.x
    }
  }
}
</code></pre>
<h3 id="version-constraints"><a class="header" href="#version-constraints">Version Constraints</a></h3>
<ul>
<li><code>~&gt; 0.90</code>: Allows 0.90.x but not 0.91.0</li>
<li><code>&gt;= 0.90, &lt; 1.0</code>: Allows any 0.x version &gt;= 0.90</li>
<li><code>= 0.90.0</code>: Exact version only</li>
</ul>
<h2 id="troubleshooting-2"><a class="header" href="#troubleshooting-2">Troubleshooting</a></h2>
<h3 id="authentication-errors"><a class="header" href="#authentication-errors">Authentication Errors</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: 390100: Invalid username or password
</code></pre>
<p><strong>Solutions:</strong></p>
<ul>
<li>Verify credentials in <code>terraform.tfvars</code></li>
<li>Check if account is locked</li>
<li>Verify organization and account names</li>
</ul>
<h3 id="insufficient-privileges"><a class="header" href="#insufficient-privileges">Insufficient Privileges</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: 001003 (42000): SQL access control error: Insufficient privileges
</code></pre>
<p><strong>Solutions:</strong></p>
<ul>
<li>Ensure user can assume required roles</li>
<li>Grant necessary roles to the Terraform user</li>
<li>Verify role hierarchy is correct</li>
</ul>
<h3 id="provider-not-found"><a class="header" href="#provider-not-found">Provider Not Found</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: Failed to query provider registry
</code></pre>
<p><strong>Solutions:</strong></p>
<ul>
<li>Check internet connection</li>
<li>Verify Terraform registry is accessible</li>
<li>Run <code>terraform init -upgrade</code></li>
</ul>
<h2 id="best-practices-2"><a class="header" href="#best-practices-2">Best Practices</a></h2>
<ol>
<li><strong>Use Provider Aliases</strong>: Always use appropriate provider aliases for operations</li>
<li><strong>Pin Versions</strong>: Pin provider versions in production</li>
<li><strong>Secure Credentials</strong>: Never commit credentials to version control</li>
<li><strong>Use Key Pairs</strong>: Consider key pair authentication for production</li>
<li><strong>Monitor Provider Updates</strong>: Review provider changelog for updates</li>
</ol>
<h2 id="next-steps-5"><a class="header" href="#next-steps-5">Next Steps</a></h2>
<ul>
<li>Learn about <a href="architecture/module-architecture.html">Module Architecture</a></li>
<li>Review <a href="architecture/../modules/roles-module.html">Module Documentation</a></li>
<li>Understand <a href="architecture/../resources/databases.html">Resource Dependencies</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="module-architecture"><a class="header" href="#module-architecture">Module Architecture</a></h1>
<p>This document explains the modular architecture of the Terraform project and how modules interact.</p>
<h2 id="module-overview"><a class="header" href="#module-overview">Module Overview</a></h2>
<p>The project uses a modular architecture with three main modules:</p>
<ol>
<li><strong>Roles Module</strong>: Manages Snowflake account roles</li>
<li><strong>Users Module</strong>: Manages Snowflake users</li>
<li><strong>Warehouse Module</strong>: Manages Snowflake warehouses</li>
</ol>
<h2 id="module-design-principles"><a class="header" href="#module-design-principles">Module Design Principles</a></h2>
<h3 id="1-single-responsibility"><a class="header" href="#1-single-responsibility">1. Single Responsibility</a></h3>
<p>Each module has a single, well-defined responsibility:</p>
<ul>
<li><strong>Roles Module</strong>: Only manages roles and role grants</li>
<li><strong>Users Module</strong>: Only manages users and user-role assignments</li>
<li><strong>Warehouse Module</strong>: Only manages warehouses and warehouse privileges</li>
</ul>
<h3 id="2-reusability"><a class="header" href="#2-reusability">2. Reusability</a></h3>
<p>Modules are designed to be reusable:</p>
<ul>
<li>Accept map-based inputs for flexibility</li>
<li>Output resources for use by other modules</li>
<li>No hardcoded values</li>
</ul>
<h3 id="3-dependency-management"><a class="header" href="#3-dependency-management">3. Dependency Management</a></h3>
<p>Modules handle dependencies internally:</p>
<ul>
<li>Resources within modules have proper <code>depends_on</code> relationships</li>
<li>Modules output resources that other modules can reference</li>
</ul>
<h2 id="module-structure-1"><a class="header" href="#module-structure-1">Module Structure</a></h2>
<p>Each module follows a consistent structure:</p>
<pre><code>modules/snowflake/&lt;module-name&gt;/
├── main.tf        # Resource definitions
├── variables.tf   # Input variables
└── outputs.tf     # Output values
</code></pre>
<h2 id="module-interactions"><a class="header" href="#module-interactions">Module Interactions</a></h2>
<h3 id="dependency-flow"><a class="header" href="#dependency-flow">Dependency Flow</a></h3>
<pre><code>┌─────────────┐
│ Roles Module│
└──────┬──────┘
       │
       ├─────────────────┐
       │                 │
       ▼                 ▼
┌─────────────┐   ┌──────────────┐
│Users Module │   │Warehouse Module│
└─────────────┘   └──────────────┘
</code></pre>
<p><strong>Key Dependencies:</strong></p>
<ul>
<li><strong>Users Module</strong> depends on <strong>Roles Module</strong> (users need roles)</li>
<li><strong>Warehouse Module</strong> may depend on <strong>Roles Module</strong> (warehouses grant to roles)</li>
<li><strong>Root Resources</strong> depend on all modules (databases, schemas, etc.)</li>
</ul>
<h3 id="data-flow"><a class="header" href="#data-flow">Data Flow</a></h3>
<ol>
<li><strong>Roles Module</strong> creates roles and outputs them</li>
<li><strong>Warehouse Module</strong> references roles for grants</li>
<li><strong>Users Module</strong> references roles for assignments</li>
<li><strong>Root Resources</strong> reference modules for grants</li>
</ol>
<h2 id="roles-module"><a class="header" href="#roles-module">Roles Module</a></h2>
<h3 id="purpose"><a class="header" href="#purpose">Purpose</a></h3>
<p>Creates Snowflake account roles with hierarchical relationships.</p>
<h3 id="inputs"><a class="header" href="#inputs">Inputs</a></h3>
<ul>
<li><code>role_map</code>: Map of role names to role configurations</li>
</ul>
<h3 id="outputs"><a class="header" href="#outputs">Outputs</a></h3>
<ul>
<li><code>ROLES</code>: Map of created role resources</li>
</ul>
<h3 id="key-features-1"><a class="header" href="#key-features-1">Key Features</a></h3>
<ul>
<li>Supports parent role relationships</li>
<li>Creates role grants automatically</li>
<li>Outputs roles for use by other modules</li>
</ul>
<h3 id="example-usage"><a class="header" href="#example-usage">Example Usage</a></h3>
<pre><code class="language-hcl">module "ALL_ROLES" {
  source = "./modules/snowflake/roles"
  
  providers = {
    snowflake = snowflake.snowflake_securityadmin
  }
  
  role_map = {
    "ANALYST" = {
      parent_role_name = "DATA_ENGINEER"
      comment          = "Role for data analysts"
    }
  }
}
</code></pre>
<h2 id="users-module"><a class="header" href="#users-module">Users Module</a></h2>
<h3 id="purpose-1"><a class="header" href="#purpose-1">Purpose</a></h3>
<p>Creates Snowflake users (person, service, legacy service) and assigns roles.</p>
<h3 id="inputs-1"><a class="header" href="#inputs-1">Inputs</a></h3>
<ul>
<li><code>user_map</code>: Map of user names to user configurations</li>
</ul>
<h3 id="outputs-1"><a class="header" href="#outputs-1">Outputs</a></h3>
<ul>
<li><code>USERS</code>: Map of person user resources</li>
<li><code>SERVICE_USERS</code>: Map of service user resources</li>
<li><code>LEGACY_SERVICE_USERS</code>: Map of legacy service user resources</li>
</ul>
<h3 id="key-features-2"><a class="header" href="#key-features-2">Key Features</a></h3>
<ul>
<li>Supports multiple user types</li>
<li>Automatically assigns roles to users</li>
<li>Handles default warehouse and role configuration</li>
<li>Uses locals for complex transformations</li>
</ul>
<h3 id="example-usage-1"><a class="header" href="#example-usage-1">Example Usage</a></h3>
<pre><code class="language-hcl">module "ALL_USERS" {
  source = "./modules/snowflake/users"
  
  providers = {
    snowflake = snowflake.snowflake_securityadmin
  }
  
  user_map = {
    "TEST_USER1" = {
      first_name  = "Test"
      last_name   = "User1"
      email       = "test@example.com"
      user_type   = "person"
      roles_to_assign = [module.ALL_ROLES.ROLES.ANALYST.name]
    }
  }
}
</code></pre>
<h2 id="warehouse-module"><a class="header" href="#warehouse-module">Warehouse Module</a></h2>
<h3 id="purpose-2"><a class="header" href="#purpose-2">Purpose</a></h3>
<p>Creates Snowflake warehouses and grants privileges to roles.</p>
<h3 id="inputs-2"><a class="header" href="#inputs-2">Inputs</a></h3>
<ul>
<li><code>warehouse_map</code>: Map of warehouse names to warehouse configurations</li>
</ul>
<h3 id="outputs-2"><a class="header" href="#outputs-2">Outputs</a></h3>
<ul>
<li><code>WAREHOUSES</code>: Map of created warehouse resources</li>
</ul>
<h3 id="key-features-3"><a class="header" href="#key-features-3">Key Features</a></h3>
<ul>
<li>Supports multiple warehouse configurations</li>
<li>Grants warehouse privileges to roles</li>
<li>Configurable sizing, scaling, and auto-suspend settings</li>
<li>Uses locals for grant flattening</li>
</ul>
<h3 id="example-usage-2"><a class="header" href="#example-usage-2">Example Usage</a></h3>
<pre><code class="language-hcl">module "ALL_WAREHOUSES" {
  source = "./modules/snowflake/warehouse"
  
  providers = {
    snowflake = snowflake.snowflake_sysadmin
  }
  
  warehouse_map = {
    "MY_WAREHOUSE" = {
      warehouse_type = "STANDARD"
      warehouse_generation = "2"
      warehouse_size = "SMALL"
      role_privileges = [
        {
          account_role_name = module.ALL_ROLES.ROLES.ANALYST.name
          privileges        = ["USAGE"]
        }
      ]
    }
  }
}
</code></pre>
<h2 id="module-patterns"><a class="header" href="#module-patterns">Module Patterns</a></h2>
<h3 id="map-based-configuration"><a class="header" href="#map-based-configuration">Map-Based Configuration</a></h3>
<p>All modules use map-based configuration:</p>
<p><strong>Benefits:</strong></p>
<ul>
<li>Easy to add/remove resources</li>
<li>Consistent structure</li>
<li>Easy to iterate with <code>for_each</code></li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="language-hcl">role_map = {
  "ROLE1" = { ... }
  "ROLE2" = { ... }
}
</code></pre>
<h3 id="locals-for-transformations"><a class="header" href="#locals-for-transformations">Locals for Transformations</a></h3>
<p>Modules use <code>locals</code> for complex data transformations:</p>
<p><strong>Benefits:</strong></p>
<ul>
<li>Cleaner resource definitions</li>
<li>Reusable computed values</li>
<li>Better readability</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="language-hcl">locals {
  flattened_grants = merge([
    for grants in values(local.grant_items) : grants
  ]...)
}
</code></pre>
<h3 id="output-references"><a class="header" href="#output-references">Output References</a></h3>
<p>Modules output resources for cross-module references:</p>
<p><strong>Benefits:</strong></p>
<ul>
<li>Loose coupling between modules</li>
<li>Clear dependency chain</li>
<li>Easy to reference in root configuration</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="language-hcl">roles_to_assign = [module.ALL_ROLES.ROLES.ANALYST.name]
</code></pre>
<h2 id="extending-modules"><a class="header" href="#extending-modules">Extending Modules</a></h2>
<h3 id="adding-a-new-module"><a class="header" href="#adding-a-new-module">Adding a New Module</a></h3>
<ol>
<li>
<p><strong>Create Module Directory:</strong></p>
<pre><code class="language-bash">mkdir -p modules/snowflake/&lt;module-name&gt;
</code></pre>
</li>
<li>
<p><strong>Create Module Files:</strong></p>
<ul>
<li><code>main.tf</code>: Resource definitions</li>
<li><code>variables.tf</code>: Input variables</li>
<li><code>outputs.tf</code>: Output values</li>
</ul>
</li>
<li>
<p><strong>Follow Patterns:</strong></p>
<ul>
<li>Use map-based inputs</li>
<li>Use <code>for_each</code> for resources</li>
<li>Output resources for references</li>
</ul>
</li>
<li>
<p><strong>Reference in Root:</strong></p>
<pre><code class="language-hcl">module "MY_MODULE" {
  source = "./modules/snowflake/&lt;module-name&gt;"
  # ...
}
</code></pre>
</li>
</ol>
<h3 id="modifying-existing-modules"><a class="header" href="#modifying-existing-modules">Modifying Existing Modules</a></h3>
<ol>
<li><strong>Add Variables:</strong> Update <code>variables.tf</code></li>
<li><strong>Add Resources:</strong> Update <code>main.tf</code></li>
<li><strong>Add Outputs:</strong> Update <code>outputs.tf</code></li>
<li><strong>Update Documentation:</strong> Document changes</li>
</ol>
<h2 id="best-practices-3"><a class="header" href="#best-practices-3">Best Practices</a></h2>
<ol>
<li><strong>Keep Modules Focused:</strong> Each module should have a single responsibility</li>
<li><strong>Use Maps:</strong> Use map-based configuration for flexibility</li>
<li><strong>Output Resources:</strong> Output resources for cross-module references</li>
<li><strong>Handle Dependencies:</strong> Use <code>depends_on</code> when needed</li>
<li><strong>Document Modules:</strong> Document inputs, outputs, and usage</li>
<li><strong>Version Modules:</strong> Consider versioning modules for stability</li>
</ol>
<h2 id="next-steps-6"><a class="header" href="#next-steps-6">Next Steps</a></h2>
<ul>
<li>Review <a href="architecture/../modules/roles-module.html">Roles Module Documentation</a></li>
<li>Review <a href="architecture/../modules/users-module.html">Users Module Documentation</a></li>
<li>Review <a href="architecture/../modules/warehouse-module.html">Warehouse Module Documentation</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="roles-module-1"><a class="header" href="#roles-module-1">Roles Module</a></h1>
<p>The Roles module manages Snowflake account roles with hierarchical relationships and role grants.</p>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>The Roles module (<code>modules/snowflake/roles</code>) creates Snowflake account roles and establishes parent-child relationships between roles. This enables role-based access control (RBAC) with proper privilege inheritance.</p>
<h2 id="module-location"><a class="header" href="#module-location">Module Location</a></h2>
<pre><code>modules/snowflake/roles/
├── main.tf        # Role resource definitions
├── variables.tf   # Input variables
└── outputs.tf     # Output values
</code></pre>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<h3 id="basic-usage"><a class="header" href="#basic-usage">Basic Usage</a></h3>
<pre><code class="language-hcl">module "ALL_ROLES" {
  source = "./modules/snowflake/roles"
  
  providers = {
    snowflake = snowflake.snowflake_securityadmin
  }
  
  role_map = {
    "DATA_SCIENTIST" = {
      comment = "Role for data scientists"
    }
  }
}
</code></pre>
<h3 id="with-parent-roles"><a class="header" href="#with-parent-roles">With Parent Roles</a></h3>
<pre><code class="language-hcl">module "ALL_ROLES" {
  source = "./modules/snowflake/roles"
  
  providers = {
    snowflake = snowflake.snowflake_securityadmin
  }
  
  role_map = {
    "DATA_SCIENTIST" = {
      comment = "Role for data scientists"
    },
    "DATA_ENGINEER" = {
      parent_role_name = "DATA_SCIENTIST"
      comment          = "Role for data engineers"
    },
    "ANALYST" = {
      parent_role_name = "DATA_ENGINEER"
      comment          = "Role for data analysts"
    }
  }
}
</code></pre>
<h2 id="input-variables"><a class="header" href="#input-variables">Input Variables</a></h2>
<h3 id="role_map"><a class="header" href="#role_map"><code>role_map</code></a></h3>
<p>Type: <code>map(any)</code></p>
<p>A map where:</p>
<ul>
<li><strong>Key</strong>: Role name (string)</li>
<li><strong>Value</strong>: Role configuration object</li>
</ul>
<h4 id="role-configuration-object"><a class="header" href="#role-configuration-object">Role Configuration Object</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Required</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td><code>parent_role_name</code></td><td><code>string</code></td><td>No</td><td><code>"SYSADMIN"</code></td><td>Name of the parent role to grant this role to</td></tr>
<tr><td><code>comment</code></td><td><code>string</code></td><td>No</td><td><code>null</code></td><td>Comment describing the role</td></tr>
</tbody></table>
</div>
<h2 id="resources-created"><a class="header" href="#resources-created">Resources Created</a></h2>
<h3 id="snowflake_account_roleroles"><a class="header" href="#snowflake_account_roleroles"><code>snowflake_account_role.ROLES</code></a></h3>
<p>Creates account roles using <code>for_each</code> over the <code>role_map</code>.</p>
<p><strong>Properties:</strong></p>
<ul>
<li><code>name</code>: Role name (from map key)</li>
<li><code>comment</code>: Role comment (from configuration)</li>
</ul>
<h3 id="snowflake_grant_account_rolerole_grant"><a class="header" href="#snowflake_grant_account_rolerole_grant"><code>snowflake_grant_account_role.ROLE_GRANT</code></a></h3>
<p>Grants each role to its parent role (or SYSADMIN if no parent specified).</p>
<p><strong>Properties:</strong></p>
<ul>
<li><code>role_name</code>: The role being granted</li>
<li><code>parent_role_name</code>: The parent role receiving the grant</li>
</ul>
<p><strong>Dependencies:</strong></p>
<ul>
<li>Depends on <code>snowflake_account_role.ROLES</code> to ensure roles exist before granting</li>
</ul>
<h2 id="outputs-3"><a class="header" href="#outputs-3">Outputs</a></h2>
<h3 id="roles"><a class="header" href="#roles"><code>ROLES</code></a></h3>
<p>Type: <code>map(object)</code></p>
<p>A map of all created role resources, keyed by role name.</p>
<p><strong>Example Output:</strong></p>
<pre><code class="language-hcl">{
  "ANALYST" = {
    name    = "ANALYST"
    comment = "Role for data analysts"
    # ... other attributes
  }
  "DATA_ENGINEER" = {
    name    = "DATA_ENGINEER"
    comment = "Role for data engineers"
    # ... other attributes
  }
}
</code></pre>
<p><strong>Usage:</strong></p>
<pre><code class="language-hcl"># Reference a role in another module
roles_to_assign = [module.ALL_ROLES.ROLES.ANALYST.name]

# Reference a role in a grant
account_role_name = module.ALL_ROLES.ROLES.MARKETING.name
</code></pre>
<h2 id="role-hierarchy"><a class="header" href="#role-hierarchy">Role Hierarchy</a></h2>
<p>The module supports role hierarchies through the <code>parent_role_name</code> field. When a role is granted to a parent role, users with the parent role automatically inherit privileges from the child role.</p>
<h3 id="example-hierarchy"><a class="header" href="#example-hierarchy">Example Hierarchy</a></h3>
<pre><code>SYSADMIN
  ├── MARKETING
  └── SALES

DATA_SCIENTIST
  └── DATA_ENGINEER
      └── ANALYST
</code></pre>
<h3 id="implementation"><a class="header" href="#implementation">Implementation</a></h3>
<pre><code class="language-hcl">role_map = {
  "DATA_SCIENTIST" = {
    comment = "Top-level role"
  },
  "DATA_ENGINEER" = {
    parent_role_name = "DATA_SCIENTIST"
    comment          = "Inherits from DATA_SCIENTIST"
  },
  "ANALYST" = {
    parent_role_name = "DATA_ENGINEER"
    comment          = "Inherits from DATA_ENGINEER (and DATA_SCIENTIST)"
  }
}
</code></pre>
<h2 id="provider-requirements"><a class="header" href="#provider-requirements">Provider Requirements</a></h2>
<p>The module requires the <code>snowflake_securityadmin</code> provider alias because:</p>
<ul>
<li>Creating account roles requires SECURITYADMIN privileges</li>
<li>Granting roles to other roles requires SECURITYADMIN privileges</li>
</ul>
<h2 id="dependencies"><a class="header" href="#dependencies">Dependencies</a></h2>
<h3 id="internal-dependencies"><a class="header" href="#internal-dependencies">Internal Dependencies</a></h3>
<ul>
<li><code>snowflake_grant_account_role.ROLE_GRANT</code> depends on <code>snowflake_account_role.ROLES</code></li>
</ul>
<h3 id="external-dependencies"><a class="header" href="#external-dependencies">External Dependencies</a></h3>
<ul>
<li>None (this module has no dependencies on other modules)</li>
</ul>
<h2 id="examples"><a class="header" href="#examples">Examples</a></h2>
<h3 id="simple-role-creation"><a class="header" href="#simple-role-creation">Simple Role Creation</a></h3>
<pre><code class="language-hcl">module "ALL_ROLES" {
  source = "./modules/snowflake/roles"
  
  providers = {
    snowflake = snowflake.snowflake_securityadmin
  }
  
  role_map = {
    "READONLY" = {
      comment = "Read-only access role"
    }
  }
}
</code></pre>
<h3 id="complex-role-hierarchy"><a class="header" href="#complex-role-hierarchy">Complex Role Hierarchy</a></h3>
<pre><code class="language-hcl">module "ALL_ROLES" {
  source = "./modules/snowflake/roles"
  
  providers = {
    snowflake = snowflake.snowflake_securityadmin
  }
  
  role_map = {
    "DEVELOPER" = {
      comment = "Base developer role"
    },
    "SENIOR_DEVELOPER" = {
      parent_role_name = "DEVELOPER"
      comment          = "Senior developers inherit from DEVELOPER"
    },
    "LEAD_DEVELOPER" = {
      parent_role_name = "SENIOR_DEVELOPER"
      comment          = "Lead developers inherit from SENIOR_DEVELOPER"
    }
  }
}
</code></pre>
<h2 id="best-practices-4"><a class="header" href="#best-practices-4">Best Practices</a></h2>
<ol>
<li><strong>Use Descriptive Names</strong>: Use clear, descriptive role names</li>
<li><strong>Document Roles</strong>: Always provide comments explaining role purpose</li>
<li><strong>Plan Hierarchy</strong>: Design role hierarchy before implementation</li>
<li><strong>Avoid Deep Hierarchies</strong>: Keep role hierarchies shallow (2-3 levels)</li>
<li><strong>Reference Outputs</strong>: Use module outputs to reference roles in other modules</li>
</ol>
<h2 id="troubleshooting-3"><a class="header" href="#troubleshooting-3">Troubleshooting</a></h2>
<h3 id="role-already-exists"><a class="header" href="#role-already-exists">Role Already Exists</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: 2003: Object already exists
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Import existing role: <code>terraform import module.ALL_ROLES.snowflake_account_role.ROLES["ROLE_NAME"] "ROLE_NAME"</code></li>
<li>Or remove role from Snowflake manually</li>
<li>Or use a different role name</li>
</ul>
<h3 id="insufficient-privileges-1"><a class="header" href="#insufficient-privileges-1">Insufficient Privileges</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: 001003 (42000): SQL access control error: Insufficient privileges
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Ensure provider uses SECURITYADMIN role</li>
<li>Verify user can assume SECURITYADMIN role</li>
<li>Check role hierarchy doesn’t create circular dependencies</li>
</ul>
<h3 id="parent-role-not-found"><a class="header" href="#parent-role-not-found">Parent Role Not Found</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: Parent role does not exist
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Ensure parent role is created before child role</li>
<li>Verify parent role name is correct</li>
<li>Check that parent role exists in Snowflake</li>
</ul>
<h2 id="related-documentation"><a class="header" href="#related-documentation">Related Documentation</a></h2>
<ul>
<li><a href="modules/users-module.html">Users Module</a> - Uses roles for user assignments</li>
<li><a href="modules/warehouse-module.html">Warehouse Module</a> - Grants warehouse privileges to roles</li>
<li><a href="modules/../resources/grants.html">Grants and Privileges</a> - Additional privilege management</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="users-module-1"><a class="header" href="#users-module-1">Users Module</a></h1>
<p>The Users module manages Snowflake users, including person users, service users, and legacy service users, with automatic role assignments.</p>
<h2 id="overview-1"><a class="header" href="#overview-1">Overview</a></h2>
<p>The Users module (<code>modules/snowflake/users</code>) creates and manages different types of Snowflake users:</p>
<ul>
<li><strong>Person Users</strong>: Standard user accounts for individuals</li>
<li><strong>Service Users</strong>: Modern service accounts for applications</li>
<li><strong>Legacy Service Users</strong>: Legacy service accounts for backward compatibility</li>
</ul>
<p>The module automatically assigns roles to users and configures default warehouses and roles.</p>
<h2 id="module-location-1"><a class="header" href="#module-location-1">Module Location</a></h2>
<pre><code>modules/snowflake/users/
├── main.tf        # User resource definitions
├── variables.tf   # Input variables
└── outputs.tf     # Output values
</code></pre>
<h2 id="usage-1"><a class="header" href="#usage-1">Usage</a></h2>
<h3 id="basic-person-user"><a class="header" href="#basic-person-user">Basic Person User</a></h3>
<pre><code class="language-hcl">module "ALL_USERS" {
  source = "./modules/snowflake/users"
  
  providers = {
    snowflake = snowflake.snowflake_securityadmin
  }
  
  user_map = {
    "JOHN_DOE" = {
      first_name  = "John"
      last_name   = "Doe"
      email       = "john.doe@example.com"
      user_type   = "person"
      roles_to_assign = [module.ALL_ROLES.ROLES.ANALYST.name]
    }
  }
}
</code></pre>
<h3 id="user-with-default-warehouse-and-role"><a class="header" href="#user-with-default-warehouse-and-role">User with Default Warehouse and Role</a></h3>
<pre><code class="language-hcl">module "ALL_USERS" {
  source = "./modules/snowflake/users"
  
  providers = {
    snowflake = snowflake.snowflake_securityadmin
  }
  
  user_map = {
    "JANE_SMITH" = {
      first_name       = "Jane"
      last_name        = "Smith"
      email            = "jane.smith@example.com"
      user_type        = "person"
      default_warehouse = module.ALL_WAREHOUSES.WAREHOUSES.MARKETING_XSMALL_WH.name
      default_role     = module.ALL_ROLES.ROLES.MARKETING.name
      roles_to_assign  = [module.ALL_ROLES.ROLES.MARKETING.name]
    }
  }
}
</code></pre>
<h3 id="service-user"><a class="header" href="#service-user">Service User</a></h3>
<pre><code class="language-hcl">module "ALL_USERS" {
  source = "./modules/snowflake/users"
  
  providers = {
    snowflake = snowflake.snowflake_securityadmin
  }
  
  user_map = {
    "DBT_SERVICE" = {
      first_name  = "dbt"
      last_name   = "service"
      user_type   = "service"
      roles_to_assign = [
        module.ALL_ROLES.ROLES.DATA_ENGINEER.name,
        module.ALL_ROLES.ROLES.DATA_SCIENTIST.name
      ]
    }
  }
}
</code></pre>
<h2 id="input-variables-1"><a class="header" href="#input-variables-1">Input Variables</a></h2>
<h3 id="user_map"><a class="header" href="#user_map"><code>user_map</code></a></h3>
<p>Type: <code>map(object)</code></p>
<p>A map where:</p>
<ul>
<li><strong>Key</strong>: Username (string)</li>
<li><strong>Value</strong>: User configuration object</li>
</ul>
<h4 id="user-configuration-object"><a class="header" href="#user-configuration-object">User Configuration Object</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Required</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td><code>first_name</code></td><td><code>string</code></td><td>Yes</td><td>-</td><td>User’s first name</td></tr>
<tr><td><code>last_name</code></td><td><code>string</code></td><td>Yes</td><td>-</td><td>User’s last name</td></tr>
<tr><td><code>email</code></td><td><code>string</code></td><td>No</td><td><code>null</code></td><td>User’s email address</td></tr>
<tr><td><code>comment</code></td><td><code>string</code></td><td>No</td><td><code>null</code></td><td>Comment describing the user</td></tr>
<tr><td><code>disabled</code></td><td><code>string</code></td><td>No</td><td><code>"false"</code></td><td>Whether the user is disabled (“true” or “false”)</td></tr>
<tr><td><code>default_warehouse</code></td><td><code>string</code></td><td>No</td><td><code>"NONE"</code></td><td>Default warehouse for the user (use “NONE” for no default)</td></tr>
<tr><td><code>default_role</code></td><td><code>string</code></td><td>No</td><td><code>"NONE"</code></td><td>Default role for the user (use “NONE” for PUBLIC)</td></tr>
<tr><td><code>default_secondary_roles_option</code></td><td><code>string</code></td><td>No</td><td><code>"NONE"</code></td><td>Secondary roles option (“ALL”, “NONE”, or custom)</td></tr>
<tr><td><code>user_type</code></td><td><code>string</code></td><td>Yes</td><td>-</td><td>Type of user: “person”, “service”, or “legacy_service”</td></tr>
<tr><td><code>must_change_password</code></td><td><code>string</code></td><td>No</td><td><code>"true"</code></td><td>Whether user must change password on first login</td></tr>
<tr><td><code>disable_mfa</code></td><td><code>string</code></td><td>No</td><td><code>"false"</code></td><td>Whether MFA is disabled for the user</td></tr>
<tr><td><code>roles_to_assign</code></td><td><code>list(string)</code></td><td>No</td><td><code>[]</code></td><td>List of role names to assign to the user</td></tr>
</tbody></table>
</div>
<h2 id="resources-created-1"><a class="header" href="#resources-created-1">Resources Created</a></h2>
<h3 id="snowflake_userusers"><a class="header" href="#snowflake_userusers"><code>snowflake_user.USERS</code></a></h3>
<p>Creates person users using <code>for_each</code> over users with <code>user_type = "person"</code>.</p>
<p><strong>Properties:</strong></p>
<ul>
<li><code>name</code>: Username (from map key)</li>
<li><code>login_name</code>: Login name (same as username)</li>
<li><code>first_name</code>: User’s first name</li>
<li><code>last_name</code>: User’s last name</li>
<li><code>display_name</code>: Auto-generated as “first_name last_name”</li>
<li><code>email</code>: User’s email address</li>
<li><code>comment</code>: User comment</li>
<li><code>disabled</code>: Whether user is disabled</li>
<li><code>default_warehouse</code>: Default warehouse (null if “NONE”)</li>
<li><code>default_role</code>: Default role (PUBLIC if “NONE”)</li>
<li><code>default_secondary_roles_option</code>: Secondary roles option</li>
<li><code>must_change_password</code>: Whether password change is required</li>
<li><code>disable_mfa</code>: Whether MFA is disabled</li>
</ul>
<h3 id="snowflake_service_userservice_users"><a class="header" href="#snowflake_service_userservice_users"><code>snowflake_service_user.SERVICE_USERS</code></a></h3>
<p>Creates service users using <code>for_each</code> over users with <code>user_type = "service"</code>.</p>
<p><strong>Properties:</strong></p>
<ul>
<li>Similar to person users, but without <code>must_change_password</code> and <code>disable_mfa</code></li>
<li>Designed for application/service accounts</li>
</ul>
<h3 id="snowflake_legacy_service_userlegacy_service_users"><a class="header" href="#snowflake_legacy_service_userlegacy_service_users"><code>snowflake_legacy_service_user.LEGACY_SERVICE_USERS</code></a></h3>
<p>Creates legacy service users using <code>for_each</code> over users with <code>user_type = "legacy_service"</code>.</p>
<p><strong>Properties:</strong></p>
<ul>
<li>Similar to service users, but uses legacy resource type</li>
<li>For backward compatibility</li>
</ul>
<h3 id="snowflake_grant_account_roleuser_grant"><a class="header" href="#snowflake_grant_account_roleuser_grant"><code>snowflake_grant_account_role.USER_GRANT</code></a></h3>
<p>Grants roles to users based on the <code>roles_to_assign</code> list.</p>
<p><strong>Properties:</strong></p>
<ul>
<li><code>user_name</code>: The user receiving the role</li>
<li><code>role_name</code>: The role being granted</li>
</ul>
<p><strong>Dependencies:</strong></p>
<ul>
<li>Depends on all user resources to ensure users exist before granting roles</li>
</ul>
<h2 id="locals"><a class="header" href="#locals">Locals</a></h2>
<p>The module uses locals for complex data transformations:</p>
<h3 id="all_usernames"><a class="header" href="#all_usernames"><code>all_usernames</code></a></h3>
<p>Merges all created users (person, service, legacy service) into a single map keyed by user key.</p>
<h3 id="user_role_grants"><a class="header" href="#user_role_grants"><code>user_role_grants</code></a></h3>
<p>Maps each user to their list of roles to assign.</p>
<h3 id="flattened_user_role_grants"><a class="header" href="#flattened_user_role_grants"><code>flattened_user_role_grants</code></a></h3>
<p>Flattens user-role combinations into a map keyed by <code>"&lt;user_key&gt;::&lt;role_index&gt;"</code> for use with <code>for_each</code>.</p>
<h2 id="outputs-4"><a class="header" href="#outputs-4">Outputs</a></h2>
<h3 id="users"><a class="header" href="#users"><code>USERS</code></a></h3>
<p>Type: <code>map(object)</code></p>
<p>A map of all created person user resources, keyed by username.</p>
<h3 id="service_users"><a class="header" href="#service_users"><code>SERVICE_USERS</code></a></h3>
<p>Type: <code>map(object)</code></p>
<p>A map of all created service user resources, keyed by username.</p>
<h3 id="legacy_service_users"><a class="header" href="#legacy_service_users"><code>LEGACY_SERVICE_USERS</code></a></h3>
<p>Type: <code>map(object)</code></p>
<p>A map of all created legacy service user resources, keyed by username.</p>
<p><strong>Usage:</strong></p>
<pre><code class="language-hcl"># Reference a user (if needed)
user_name = module.ALL_USERS.USERS.TEST_USER1.name
</code></pre>
<h2 id="user-types"><a class="header" href="#user-types">User Types</a></h2>
<h3 id="person-users"><a class="header" href="#person-users">Person Users</a></h3>
<p>Standard user accounts for individuals:</p>
<ul>
<li>Require first name and last name</li>
<li>Support email addresses</li>
<li>Support password policies (must_change_password)</li>
<li>Support MFA settings (disable_mfa)</li>
<li>Can have default warehouse and role</li>
</ul>
<h3 id="service-users"><a class="header" href="#service-users">Service Users</a></h3>
<p>Modern service accounts for applications:</p>
<ul>
<li>Require first name and last name (can be descriptive)</li>
<li>Support email addresses</li>
<li>Do not support password policies</li>
<li>Do not support MFA settings</li>
<li>Can have default warehouse and role</li>
<li>Recommended for new service accounts</li>
</ul>
<h3 id="legacy-service-users"><a class="header" href="#legacy-service-users">Legacy Service Users</a></h3>
<p>Legacy service accounts for backward compatibility:</p>
<ul>
<li>Require first name and last name</li>
<li>Support email addresses</li>
<li>Support password policies</li>
<li>Do not support MFA settings</li>
<li>Can have default warehouse and role</li>
<li>Use only for existing legacy integrations</li>
</ul>
<h2 id="role-assignment"><a class="header" href="#role-assignment">Role Assignment</a></h2>
<p>Roles are assigned to users through the <code>roles_to_assign</code> list:</p>
<pre><code class="language-hcl">user_map = {
  "USER1" = {
    first_name  = "User"
    last_name   = "One"
    user_type   = "person"
    roles_to_assign = [
      module.ALL_ROLES.ROLES.ANALYST.name,
      module.ALL_ROLES.ROLES.DATA_ENGINEER.name
    ]
  }
}
</code></pre>
<p><strong>Important:</strong></p>
<ul>
<li>Roles must exist before they can be assigned</li>
<li>Reference roles using module outputs: <code>module.ALL_ROLES.ROLES.ROLE_NAME.name</code></li>
<li>Empty list <code>[]</code> means no roles assigned (user only has PUBLIC role)</li>
</ul>
<h2 id="default-warehouse-and-role"><a class="header" href="#default-warehouse-and-role">Default Warehouse and Role</a></h2>
<p>Users can have default warehouse and role configured:</p>
<pre><code class="language-hcl">user_map = {
  "USER1" = {
    first_name       = "User"
    last_name        = "One"
    user_type        = "person"
    default_warehouse = module.ALL_WAREHOUSES.WAREHOUSES.MY_WH.name
    default_role     = module.ALL_ROLES.ROLES.ANALYST.name
    roles_to_assign  = [module.ALL_ROLES.ROLES.ANALYST.name]
  }
}
</code></pre>
<p><strong>Notes:</strong></p>
<ul>
<li>Use <code>"NONE"</code> to explicitly set no default (results in <code>null</code>)</li>
<li>Default role defaults to <code>PUBLIC</code> if not specified or set to <code>"NONE"</code></li>
<li>Default warehouse can be <code>null</code> if not specified</li>
</ul>
<h2 id="provider-requirements-1"><a class="header" href="#provider-requirements-1">Provider Requirements</a></h2>
<p>The module requires the <code>snowflake_securityadmin</code> provider alias because:</p>
<ul>
<li>Creating users requires SECURITYADMIN privileges</li>
<li>Granting roles to users requires SECURITYADMIN privileges</li>
</ul>
<h2 id="dependencies-1"><a class="header" href="#dependencies-1">Dependencies</a></h2>
<h3 id="internal-dependencies-1"><a class="header" href="#internal-dependencies-1">Internal Dependencies</a></h3>
<ul>
<li><code>snowflake_grant_account_role.USER_GRANT</code> depends on all user resources</li>
</ul>
<h3 id="external-dependencies-1"><a class="header" href="#external-dependencies-1">External Dependencies</a></h3>
<ul>
<li><strong>Roles Module</strong>: Users reference roles from the roles module for assignment</li>
<li><strong>Warehouse Module</strong> (optional): Users may reference warehouses for default warehouse configuration</li>
</ul>
<h2 id="examples-1"><a class="header" href="#examples-1">Examples</a></h2>
<h3 id="multiple-user-types"><a class="header" href="#multiple-user-types">Multiple User Types</a></h3>
<pre><code class="language-hcl">module "ALL_USERS" {
  source = "./modules/snowflake/users"
  
  providers = {
    snowflake = snowflake.snowflake_securityadmin
  }
  
  user_map = {
    # Person user
    "JOHN_DOE" = {
      first_name  = "John"
      last_name   = "Doe"
      email       = "john.doe@example.com"
      user_type   = "person"
      roles_to_assign = [module.ALL_ROLES.ROLES.ANALYST.name]
    },
    
    # Service user
    "APP_SERVICE" = {
      first_name  = "Application"
      last_name   = "Service"
      user_type   = "service"
      roles_to_assign = [module.ALL_ROLES.ROLES.DATA_ENGINEER.name]
    },
    
    # Legacy service user
    "LEGACY_APP" = {
      first_name  = "Legacy"
      last_name   = "Application"
      user_type   = "legacy_service"
      roles_to_assign = []
    }
  }
}
</code></pre>
<h3 id="user-with-all-options"><a class="header" href="#user-with-all-options">User with All Options</a></h3>
<pre><code class="language-hcl">module "ALL_USERS" {
  source = "./modules/snowflake/users"
  
  providers = {
    snowflake = snowflake.snowflake_securityadmin
  }
  
  user_map = {
    "FULL_USER" = {
      first_name                     = "Full"
      last_name                      = "User"
      email                          = "full.user@example.com"
      comment                        = "User with all options configured"
      disabled                       = "false"
      default_warehouse              = module.ALL_WAREHOUSES.WAREHOUSES.MY_WH.name
      default_role                   = module.ALL_ROLES.ROLES.ANALYST.name
      default_secondary_roles_option = "NONE"
      user_type                      = "person"
      must_change_password           = "true"
      disable_mfa                    = "false"
      roles_to_assign                = [
        module.ALL_ROLES.ROLES.ANALYST.name,
        module.ALL_ROLES.ROLES.DATA_ENGINEER.name
      ]
    }
  }
}
</code></pre>
<h2 id="best-practices-5"><a class="header" href="#best-practices-5">Best Practices</a></h2>
<ol>
<li><strong>Use Descriptive Names</strong>: Use clear, descriptive usernames</li>
<li><strong>Set Defaults</strong>: Configure default warehouse and role for better UX</li>
<li><strong>Minimal Roles</strong>: Assign only necessary roles (principle of least privilege)</li>
<li><strong>Service Users</strong>: Use service users for applications, not person users</li>
<li><strong>Email Addresses</strong>: Always provide email addresses for person users</li>
<li><strong>Comments</strong>: Add comments to document user purpose</li>
</ol>
<h2 id="troubleshooting-4"><a class="header" href="#troubleshooting-4">Troubleshooting</a></h2>
<h3 id="user-already-exists"><a class="header" href="#user-already-exists">User Already Exists</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: 2003: Object already exists
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Import existing user: <code>terraform import module.ALL_USERS.snowflake_user.USERS["USERNAME"] "USERNAME"</code></li>
<li>Or remove user from Snowflake manually</li>
<li>Or use a different username</li>
</ul>
<h3 id="role-not-found"><a class="header" href="#role-not-found">Role Not Found</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: Role does not exist
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Ensure roles are created before users</li>
<li>Verify role names in <code>roles_to_assign</code> match module outputs</li>
<li>Check that roles module is applied before users module</li>
</ul>
<h3 id="insufficient-privileges-2"><a class="header" href="#insufficient-privileges-2">Insufficient Privileges</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: 001003 (42000): SQL access control error: Insufficient privileges
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Ensure provider uses SECURITYADMIN role</li>
<li>Verify user can assume SECURITYADMIN role</li>
<li>Check that roles exist and are accessible</li>
</ul>
<h2 id="related-documentation-1"><a class="header" href="#related-documentation-1">Related Documentation</a></h2>
<ul>
<li><a href="modules/roles-module.html">Roles Module</a> - Creates roles assigned to users</li>
<li><a href="modules/warehouse-module.html">Warehouse Module</a> - Creates warehouses used as defaults</li>
<li><a href="modules/../getting-started/initial-setup.html">Initial Setup</a> - Setting up users</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="warehouse-module-1"><a class="header" href="#warehouse-module-1">Warehouse Module</a></h1>
<p>The Warehouse module manages Snowflake compute warehouses with configurable sizing, scaling, and privilege grants.</p>
<h2 id="overview-2"><a class="header" href="#overview-2">Overview</a></h2>
<p>The Warehouse module (<code>modules/snowflake/warehouse</code>) creates Snowflake compute warehouses and automatically grants warehouse privileges to specified roles. Warehouses can be configured with various sizing, scaling, and performance options.</p>
<h2 id="module-location-2"><a class="header" href="#module-location-2">Module Location</a></h2>
<pre><code>modules/snowflake/warehouse/
├── main.tf        # Warehouse resource definitions
├── variables.tf   # Input variables
└── outputs.tf     # Output values
</code></pre>
<h2 id="usage-2"><a class="header" href="#usage-2">Usage</a></h2>
<h3 id="basic-warehouse"><a class="header" href="#basic-warehouse">Basic Warehouse</a></h3>
<pre><code class="language-hcl">module "ALL_WAREHOUSES" {
  source = "./modules/snowflake/warehouse"
  
  providers = {
    snowflake = snowflake.snowflake_sysadmin
  }
  
  warehouse_map = {
    "MY_WAREHOUSE" = {
      warehouse_type = "STANDARD"
      warehouse_generation = "2"
      role_privileges = [
        {
          account_role_name = module.ALL_ROLES.ROLES.ANALYST.name
          privileges        = ["USAGE"]
        }
      ]
    }
  }
}
</code></pre>
<h3 id="warehouse-with-all-options"><a class="header" href="#warehouse-with-all-options">Warehouse with All Options</a></h3>
<pre><code class="language-hcl">module "ALL_WAREHOUSES" {
  source = "./modules/snowflake/warehouse"
  
  providers = {
    snowflake = snowflake.snowflake_sysadmin
  }
  
  warehouse_map = {
    "PRODUCTION_WH" = {
      warehouse_type                = "STANDARD"
      warehouse_generation          = "2"
      warehouse_size                = "MEDIUM"
      warehouse_max_cluster_count   = 3
      warehouse_min_cluster_count   = 1
      warehouse_scaling_policy      = "STANDARD"
      warehouse_auto_suspend        = 300
      warehouse_auto_resume         = true
      warehouse_initially_suspended = true
      warehouse_comment             = "Production warehouse"
      warehouse_max_concurrency_level = 8
      warehouse_statement_timeout_in_seconds = 3600
      role_privileges = [
        {
          account_role_name = module.ALL_ROLES.ROLES.DATA_ENGINEER.name
          privileges        = ["USAGE", "OPERATE"]
        }
      ]
      with_grant_option = false
    }
  }
}
</code></pre>
<h2 id="input-variables-2"><a class="header" href="#input-variables-2">Input Variables</a></h2>
<h3 id="warehouse_map"><a class="header" href="#warehouse_map"><code>warehouse_map</code></a></h3>
<p>Type: <code>map(object)</code></p>
<p>A map where:</p>
<ul>
<li><strong>Key</strong>: Warehouse name (string)</li>
<li><strong>Value</strong>: Warehouse configuration object</li>
</ul>
<h4 id="warehouse-configuration-object"><a class="header" href="#warehouse-configuration-object">Warehouse Configuration Object</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Required</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td><code>warehouse_type</code></td><td><code>string</code></td><td>Yes</td><td>-</td><td>Type: “STANDARD” or “SNOWPARK-OPTIMIZED”</td></tr>
<tr><td><code>warehouse_generation</code></td><td><code>string</code></td><td>Yes</td><td>-</td><td>Generation: “1” or “2” (recommended: “2”)</td></tr>
<tr><td><code>warehouse_size</code></td><td><code>string</code></td><td>No</td><td><code>"XSMALL"</code></td><td>Size: “XSMALL”, “SMALL”, “MEDIUM”, “LARGE”, “X-LARGE”, “XX-LARGE”, “XXX-LARGE”, “X4-LARGE”, “X5-LARGE”, “X6-LARGE”</td></tr>
<tr><td><code>warehouse_max_cluster_count</code></td><td><code>number</code></td><td>No</td><td><code>1</code></td><td>Maximum number of clusters (1-10)</td></tr>
<tr><td><code>warehouse_min_cluster_count</code></td><td><code>number</code></td><td>No</td><td><code>1</code></td><td>Minimum number of clusters (1-10)</td></tr>
<tr><td><code>warehouse_scaling_policy</code></td><td><code>string</code></td><td>No</td><td><code>"ECONOMY"</code></td><td>Scaling policy: “STANDARD” or “ECONOMY”</td></tr>
<tr><td><code>warehouse_auto_suspend</code></td><td><code>number</code></td><td>No</td><td><code>60</code></td><td>Auto-suspend time in seconds (60-604800)</td></tr>
<tr><td><code>warehouse_auto_resume</code></td><td><code>bool</code></td><td>No</td><td><code>true</code></td><td>Whether to auto-resume when queries arrive</td></tr>
<tr><td><code>warehouse_initially_suspended</code></td><td><code>bool</code></td><td>No</td><td><code>true</code></td><td>Whether warehouse starts suspended</td></tr>
<tr><td><code>warehouse_comment</code></td><td><code>string</code></td><td>No</td><td><code>null</code></td><td>Comment describing the warehouse</td></tr>
<tr><td><code>warehouse_max_concurrency_level</code></td><td><code>number</code></td><td>No</td><td><code>8</code></td><td>Maximum concurrent queries (1-512)</td></tr>
<tr><td><code>warehouse_statement_timeout_in_seconds</code></td><td><code>number</code></td><td>No</td><td><code>900</code></td><td>Statement timeout in seconds</td></tr>
<tr><td><code>role_privileges</code></td><td><code>list(object)</code></td><td>Yes</td><td>-</td><td>List of role privilege grants</td></tr>
<tr><td><code>with_grant_option</code></td><td><code>bool</code></td><td>No</td><td><code>false</code></td><td>Whether grants include grant option</td></tr>
</tbody></table>
</div>
<h4 id="role-privilege-object"><a class="header" href="#role-privilege-object">Role Privilege Object</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody>
<tr><td><code>account_role_name</code></td><td><code>string</code></td><td>Yes</td><td>Name of the role receiving privileges</td></tr>
<tr><td><code>privileges</code></td><td><code>list(string)</code></td><td>Yes</td><td>List of privileges: “USAGE”, “OPERATE”, “MODIFY”, “MONITOR”, “ALL PRIVILEGES”</td></tr>
</tbody></table>
</div>
<h2 id="resources-created-2"><a class="header" href="#resources-created-2">Resources Created</a></h2>
<h3 id="snowflake_warehousewarehouses"><a class="header" href="#snowflake_warehousewarehouses"><code>snowflake_warehouse.WAREHOUSES</code></a></h3>
<p>Creates warehouses using <code>for_each</code> over the <code>warehouse_map</code>.</p>
<p><strong>Properties:</strong></p>
<ul>
<li><code>name</code>: Warehouse name (from map key)</li>
<li><code>warehouse_type</code>: Type of warehouse</li>
<li><code>generation</code>: Warehouse generation</li>
<li><code>warehouse_size</code>: Size of warehouse</li>
<li><code>max_cluster_count</code>: Maximum clusters</li>
<li><code>min_cluster_count</code>: Minimum clusters</li>
<li><code>scaling_policy</code>: Scaling policy</li>
<li><code>auto_suspend</code>: Auto-suspend time</li>
<li><code>auto_resume</code>: Auto-resume setting</li>
<li><code>initially_suspended</code>: Initial suspension state</li>
<li><code>comment</code>: Warehouse comment</li>
<li><code>max_concurrency_level</code>: Maximum concurrent queries</li>
<li><code>statement_timeout_in_seconds</code>: Statement timeout</li>
</ul>
<h3 id="snowflake_grant_privileges_to_account_rolewarehouse_grant"><a class="header" href="#snowflake_grant_privileges_to_account_rolewarehouse_grant"><code>snowflake_grant_privileges_to_account_role.WAREHOUSE_GRANT</code></a></h3>
<p>Grants warehouse privileges to roles based on the <code>role_privileges</code> configuration.</p>
<p><strong>Properties:</strong></p>
<ul>
<li><code>account_role_name</code>: Role receiving privileges</li>
<li><code>privileges</code>: List of privileges</li>
<li><code>on_account_object.object_type</code>: “WAREHOUSE”</li>
<li><code>on_account_object.object_name</code>: Warehouse name</li>
<li><code>with_grant_option</code>: Whether grant includes grant option</li>
</ul>
<p><strong>Dependencies:</strong></p>
<ul>
<li>Depends on <code>snowflake_warehouse.WAREHOUSES</code> to ensure warehouses exist before granting</li>
</ul>
<h2 id="locals-1"><a class="header" href="#locals-1">Locals</a></h2>
<p>The module uses locals for complex data transformations:</p>
<h3 id="grant_items"><a class="header" href="#grant_items"><code>grant_items</code></a></h3>
<p>Maps each warehouse to its role privilege grants, keyed by <code>"&lt;warehouse_name&gt;::&lt;grant_index&gt;"</code>.</p>
<h3 id="flattened_grants"><a class="header" href="#flattened_grants"><code>flattened_grants</code></a></h3>
<p>Flattens all warehouse grants into a single map for use with <code>for_each</code> on the grant resource.</p>
<h2 id="outputs-5"><a class="header" href="#outputs-5">Outputs</a></h2>
<h3 id="warehouses"><a class="header" href="#warehouses"><code>WAREHOUSES</code></a></h3>
<p>Type: <code>map(object)</code></p>
<p>A map of all created warehouse resources, keyed by warehouse name.</p>
<p><strong>Example Output:</strong></p>
<pre><code class="language-hcl">{
  "MARKETING_XSMALL_WH" = {
    name    = "MARKETING_XSMALL_WH"
    size    = "XSMALL"
    # ... other attributes
  }
  "SALES_SMALL_WH" = {
    name    = "SALES_SMALL_WH"
    size    = "SMALL"
    # ... other attributes
  }
}
</code></pre>
<p><strong>Usage:</strong></p>
<pre><code class="language-hcl"># Reference a warehouse in user defaults
default_warehouse = module.ALL_WAREHOUSES.WAREHOUSES.MARKETING_XSMALL_WH.name
</code></pre>
<h2 id="warehouse-types"><a class="header" href="#warehouse-types">Warehouse Types</a></h2>
<h3 id="standard"><a class="header" href="#standard">STANDARD</a></h3>
<p>Standard warehouse for general-purpose workloads:</p>
<ul>
<li>Supports all warehouse sizes</li>
<li>Good for most use cases</li>
<li>Recommended for most scenarios</li>
</ul>
<h3 id="snowpark-optimized"><a class="header" href="#snowpark-optimized">SNOWPARK-OPTIMIZED</a></h3>
<p>Optimized for Snowpark workloads:</p>
<ul>
<li>Better performance for ML workloads</li>
<li>Higher cost</li>
<li>Use only for Snowpark-specific workloads</li>
</ul>
<h2 id="warehouse-sizes"><a class="header" href="#warehouse-sizes">Warehouse Sizes</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Size</th><th>Credits/Hour</th><th>Use Case</th></tr></thead><tbody>
<tr><td>XSMALL</td><td>1</td><td>Development, testing</td></tr>
<tr><td>SMALL</td><td>2</td><td>Small production workloads</td></tr>
<tr><td>MEDIUM</td><td>4</td><td>Medium production workloads</td></tr>
<tr><td>LARGE</td><td>8</td><td>Large production workloads</td></tr>
<tr><td>X-LARGE</td><td>16</td><td>Very large workloads</td></tr>
<tr><td>XX-LARGE+</td><td>32+</td><td>Enterprise workloads</td></tr>
</tbody></table>
</div>
<h2 id="scaling-policies"><a class="header" href="#scaling-policies">Scaling Policies</a></h2>
<h3 id="standard-1"><a class="header" href="#standard-1">STANDARD</a></h3>
<ul>
<li>Scales up immediately when needed</li>
<li>Scales down after 6 minutes of inactivity</li>
<li>Better performance, higher cost</li>
<li>Recommended for production</li>
</ul>
<h3 id="economy"><a class="header" href="#economy">ECONOMY</a></h3>
<ul>
<li>Scales up after 6 minutes of load</li>
<li>Scales down after 6 minutes of inactivity</li>
<li>Lower cost, may have delays</li>
<li>Recommended for development/testing</li>
</ul>
<h2 id="multi-cluster-warehouses"><a class="header" href="#multi-cluster-warehouses">Multi-Cluster Warehouses</a></h2>
<p>Warehouses can be configured with multiple clusters for concurrency:</p>
<pre><code class="language-hcl">warehouse_map = {
  "HIGH_CONCURRENCY_WH" = {
    warehouse_type              = "STANDARD"
    warehouse_generation        = "2"
    warehouse_size              = "MEDIUM"
    warehouse_max_cluster_count = 5
    warehouse_min_cluster_count = 2
    # ... other settings
  }
}
</code></pre>
<p><strong>Benefits:</strong></p>
<ul>
<li>Handles concurrent queries better</li>
<li>Automatic load balancing</li>
<li>Higher cost (charges per cluster)</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>High concurrency workloads</li>
<li>Multiple users/queries simultaneously</li>
<li>BI tools with many concurrent users</li>
</ul>
<h2 id="privileges"><a class="header" href="#privileges">Privileges</a></h2>
<h3 id="available-privileges"><a class="header" href="#available-privileges">Available Privileges</a></h3>
<ul>
<li><strong>USAGE</strong>: Use the warehouse for queries</li>
<li><strong>OPERATE</strong>: Resume/suspend the warehouse</li>
<li><strong>MODIFY</strong>: Change warehouse settings</li>
<li><strong>MONITOR</strong>: View warehouse usage and metrics</li>
<li><strong>ALL PRIVILEGES</strong>: All of the above</li>
</ul>
<h3 id="granting-privileges"><a class="header" href="#granting-privileges">Granting Privileges</a></h3>
<pre><code class="language-hcl">role_privileges = [
  {
    account_role_name = module.ALL_ROLES.ROLES.ANALYST.name
    privileges        = ["USAGE"]
  },
  {
    account_role_name = module.ALL_ROLES.ROLES.DATA_ENGINEER.name
    privileges        = ["USAGE", "OPERATE", "MONITOR"]
  }
]
</code></pre>
<h2 id="provider-requirements-2"><a class="header" href="#provider-requirements-2">Provider Requirements</a></h2>
<p>The module requires the <code>snowflake_sysadmin</code> provider alias because:</p>
<ul>
<li>Creating warehouses requires SYSADMIN privileges</li>
<li>Granting warehouse privileges requires SYSADMIN privileges</li>
</ul>
<h2 id="dependencies-2"><a class="header" href="#dependencies-2">Dependencies</a></h2>
<h3 id="internal-dependencies-2"><a class="header" href="#internal-dependencies-2">Internal Dependencies</a></h3>
<ul>
<li><code>snowflake_grant_privileges_to_account_role.WAREHOUSE_GRANT</code> depends on <code>snowflake_warehouse.WAREHOUSES</code></li>
</ul>
<h3 id="external-dependencies-2"><a class="header" href="#external-dependencies-2">External Dependencies</a></h3>
<ul>
<li><strong>Roles Module</strong> (optional): Warehouses may grant privileges to roles from the roles module</li>
</ul>
<h2 id="examples-2"><a class="header" href="#examples-2">Examples</a></h2>
<h3 id="development-warehouse"><a class="header" href="#development-warehouse">Development Warehouse</a></h3>
<pre><code class="language-hcl">warehouse_map = {
  "DEV_WH" = {
    warehouse_type                = "STANDARD"
    warehouse_generation          = "2"
    warehouse_size                = "XSMALL"
    warehouse_scaling_policy      = "ECONOMY"
    warehouse_auto_suspend        = 60
    warehouse_initially_suspended = true
    warehouse_comment             = "Development warehouse"
    role_privileges = [
      {
        account_role_name = module.ALL_ROLES.ROLES.DEVELOPER.name
        privileges        = ["USAGE"]
      }
    ]
  }
}
</code></pre>
<h3 id="production-warehouse-with-multi-cluster"><a class="header" href="#production-warehouse-with-multi-cluster">Production Warehouse with Multi-Cluster</a></h3>
<pre><code class="language-hcl">warehouse_map = {
  "PROD_WH" = {
    warehouse_type                = "STANDARD"
    warehouse_generation          = "2"
    warehouse_size                = "LARGE"
    warehouse_max_cluster_count   = 5
    warehouse_min_cluster_count   = 2
    warehouse_scaling_policy      = "STANDARD"
    warehouse_auto_suspend        = 300
    warehouse_auto_resume         = true
    warehouse_initially_suspended = false
    warehouse_comment             = "Production warehouse"
    warehouse_max_concurrency_level = 16
    warehouse_statement_timeout_in_seconds = 3600
    role_privileges = [
      {
        account_role_name = module.ALL_ROLES.ROLES.DATA_ENGINEER.name
        privileges        = ["USAGE", "OPERATE", "MONITOR"]
      }
    ]
    with_grant_option = false
  }
}
</code></pre>
<h3 id="multiple-warehouses-for-different-teams"><a class="header" href="#multiple-warehouses-for-different-teams">Multiple Warehouses for Different Teams</a></h3>
<pre><code class="language-hcl">warehouse_map = {
  "MARKETING_WH" = {
    warehouse_type = "STANDARD"
    warehouse_generation = "2"
    warehouse_size = "SMALL"
    role_privileges = [
      {
        account_role_name = module.ALL_ROLES.ROLES.MARKETING.name
        privileges        = ["USAGE"]
      }
    ]
  },
  "SALES_WH" = {
    warehouse_type = "STANDARD"
    warehouse_generation = "2"
    warehouse_size = "SMALL"
    role_privileges = [
      {
        account_role_name = module.ALL_ROLES.ROLES.SALES.name
        privileges        = ["USAGE"]
      }
    ]
  }
}
</code></pre>
<h2 id="best-practices-6"><a class="header" href="#best-practices-6">Best Practices</a></h2>
<ol>
<li><strong>Right-Size Warehouses</strong>: Start small and scale up as needed</li>
<li><strong>Use Auto-Suspend</strong>: Enable auto-suspend to save costs</li>
<li><strong>Multi-Cluster for Concurrency</strong>: Use multi-cluster for high-concurrency workloads</li>
<li><strong>Separate by Workload</strong>: Use different warehouses for different workloads</li>
<li><strong>Monitor Usage</strong>: Regularly review warehouse usage and adjust sizing</li>
<li><strong>Grant Minimal Privileges</strong>: Grant only necessary privileges (USAGE for most users)</li>
<li><strong>Use Economy for Dev</strong>: Use ECONOMY scaling policy for development warehouses</li>
</ol>
<h2 id="cost-optimization"><a class="header" href="#cost-optimization">Cost Optimization</a></h2>
<h3 id="tips-for-reducing-costs"><a class="header" href="#tips-for-reducing-costs">Tips for Reducing Costs</a></h3>
<ol>
<li><strong>Auto-Suspend</strong>: Set appropriate auto-suspend times (60-300 seconds)</li>
<li><strong>Right-Sizing</strong>: Use smallest size that meets performance needs</li>
<li><strong>Economy Scaling</strong>: Use ECONOMY scaling policy for non-critical workloads</li>
<li><strong>Multi-Cluster</strong>: Only use multi-cluster when necessary</li>
<li><strong>Suspend Manually</strong>: Suspend warehouses when not in use</li>
</ol>
<h3 id="cost-calculation"><a class="header" href="#cost-calculation">Cost Calculation</a></h3>
<p>Warehouse cost = (Warehouse size credits/hour) × (Hours running) × (Number of clusters)</p>
<p>Example:</p>
<ul>
<li>MEDIUM warehouse = 4 credits/hour</li>
<li>Running 8 hours/day = 32 credits/day</li>
<li>5 clusters = 160 credits/day</li>
</ul>
<h2 id="troubleshooting-5"><a class="header" href="#troubleshooting-5">Troubleshooting</a></h2>
<h3 id="warehouse-already-exists"><a class="header" href="#warehouse-already-exists">Warehouse Already Exists</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: 2003: Object already exists
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Import existing warehouse: <code>terraform import module.ALL_WAREHOUSES.snowflake_warehouse.WAREHOUSES["WAREHOUSE_NAME"] "WAREHOUSE_NAME"</code></li>
<li>Or remove warehouse from Snowflake manually</li>
<li>Or use a different warehouse name</li>
</ul>
<h3 id="insufficient-privileges-3"><a class="header" href="#insufficient-privileges-3">Insufficient Privileges</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: 001003 (42000): SQL access control error: Insufficient privileges
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Ensure provider uses SYSADMIN role</li>
<li>Verify user can assume SYSADMIN role</li>
<li>Check that roles exist for privilege grants</li>
</ul>
<h3 id="invalid-warehouse-size"><a class="header" href="#invalid-warehouse-size">Invalid Warehouse Size</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: Invalid warehouse size
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Verify warehouse size is valid (XSMALL, SMALL, MEDIUM, etc.)</li>
<li>Check that size is appropriate for warehouse type</li>
<li>Ensure generation supports the size</li>
</ul>
<h2 id="related-documentation-2"><a class="header" href="#related-documentation-2">Related Documentation</a></h2>
<ul>
<li><a href="modules/roles-module.html">Roles Module</a> - Creates roles that receive warehouse privileges</li>
<li><a href="modules/users-module.html">Users Module</a> - Uses warehouses as default warehouses</li>
<li><a href="modules/../getting-started/initial-setup.html">Initial Setup</a> - Setting up warehouses</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="databases"><a class="header" href="#databases">Databases</a></h1>
<p>This document explains how databases are created and managed in the Terraform configuration.</p>
<h2 id="overview-3"><a class="header" href="#overview-3">Overview</a></h2>
<p>Databases in Snowflake are top-level containers for schemas, tables, views, and other objects. The configuration creates databases directly in the root <code>main.tf</code> file.</p>
<h2 id="resource-definition"><a class="header" href="#resource-definition">Resource Definition</a></h2>
<h3 id="basic-database"><a class="header" href="#basic-database">Basic Database</a></h3>
<pre><code class="language-hcl">resource "snowflake_database" "TEST_DB" {
  name                        = "TEST_DB"
  comment                     = "Test database created via Terraform"
  data_retention_time_in_days = 1
  provider                    = snowflake.snowflake_sysadmin
}
</code></pre>
<h2 id="resource-properties"><a class="header" href="#resource-properties">Resource Properties</a></h2>
<h3 id="required-properties"><a class="header" href="#required-properties">Required Properties</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Property</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>name</code></td><td><code>string</code></td><td>Name of the database</td></tr>
</tbody></table>
</div>
<h3 id="optional-properties"><a class="header" href="#optional-properties">Optional Properties</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Property</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td><code>comment</code></td><td><code>string</code></td><td><code>null</code></td><td>Comment describing the database</td></tr>
<tr><td><code>data_retention_time_in_days</code></td><td><code>number</code></td><td><code>1</code></td><td>Number of days to retain data (Time Travel)</td></tr>
<tr><td><code>provider</code></td><td><code>provider</code></td><td><code>default</code></td><td>Provider alias to use</td></tr>
</tbody></table>
</div>
<h2 id="examples-3"><a class="header" href="#examples-3">Examples</a></h2>
<h3 id="simple-database"><a class="header" href="#simple-database">Simple Database</a></h3>
<pre><code class="language-hcl">resource "snowflake_database" "MY_DB" {
  name    = "MY_DB"
  comment = "My database"
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="database-with-custom-retention"><a class="header" href="#database-with-custom-retention">Database with Custom Retention</a></h3>
<pre><code class="language-hcl">resource "snowflake_database" "PRODUCTION_DB" {
  name                        = "PRODUCTION_DB"
  comment                     = "Production database"
  data_retention_time_in_days = 30
  provider                    = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="multiple-databases"><a class="header" href="#multiple-databases">Multiple Databases</a></h3>
<pre><code class="language-hcl">resource "snowflake_database" "TEST_DB" {
  name    = "TEST_DB"
  comment = "Test database"
  provider = snowflake.snowflake_sysadmin
}

resource "snowflake_database" "TEST_DB2" {
  name    = "TEST_DB2"
  comment = "Test database 2"
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h2 id="data-retention-time-travel"><a class="header" href="#data-retention-time-travel">Data Retention (Time Travel)</a></h2>
<p>The <code>data_retention_time_in_days</code> property controls Time Travel retention:</p>
<ul>
<li><strong>1 day</strong>: Default, minimum retention</li>
<li><strong>Up to 90 days</strong>: For Standard accounts</li>
<li><strong>Up to 1 year</strong>: For Enterprise accounts (with additional cost)</li>
</ul>
<p><strong>Important:</strong></p>
<ul>
<li>Higher retention = higher storage costs</li>
<li>Time Travel allows querying historical data</li>
<li>Can restore dropped objects within retention period</li>
</ul>
<h2 id="provider-requirements-3"><a class="header" href="#provider-requirements-3">Provider Requirements</a></h2>
<p>Databases require the <code>snowflake_sysadmin</code> provider because:</p>
<ul>
<li>Creating databases requires SYSADMIN privileges</li>
<li>Database management is a system administration task</li>
</ul>
<h2 id="dependencies-3"><a class="header" href="#dependencies-3">Dependencies</a></h2>
<h3 id="no-dependencies"><a class="header" href="#no-dependencies">No Dependencies</a></h3>
<p>Databases are top-level objects and don’t depend on other resources in this configuration.</p>
<h3 id="dependent-resources"><a class="header" href="#dependent-resources">Dependent Resources</a></h3>
<p>The following resources depend on databases:</p>
<ul>
<li>Schemas (created within databases)</li>
<li>Tables (created within schemas)</li>
<li>Views (created within schemas)</li>
<li>Grants (granted on databases)</li>
</ul>
<h2 id="granting-access"><a class="header" href="#granting-access">Granting Access</a></h2>
<p>Databases can be granted to roles for access control:</p>
<pre><code class="language-hcl">resource "snowflake_grant_privileges_to_account_role" "DB_GRANT" {
  privileges        = ["USAGE"]
  account_role_name = module.ALL_ROLES.ROLES.ANALYST.name
  on_account_object {
    object_type = "DATABASE"
    object_name = snowflake_database.TEST_DB.name
  }
  with_grant_option = false
  provider          = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="available-privileges-1"><a class="header" href="#available-privileges-1">Available Privileges</a></h3>
<ul>
<li><strong>USAGE</strong>: Use the database (required to access schemas/tables)</li>
<li><strong>MODIFY</strong>: Modify database settings</li>
<li><strong>CREATE SCHEMA</strong>: Create schemas in the database</li>
<li><strong>MONITOR</strong>: View database usage and metrics</li>
<li><strong>OWNERSHIP</strong>: Full ownership of the database</li>
<li><strong>ALL PRIVILEGES</strong>: All of the above</li>
</ul>
<h2 id="best-practices-7"><a class="header" href="#best-practices-7">Best Practices</a></h2>
<ol>
<li><strong>Descriptive Names</strong>: Use clear, descriptive database names</li>
<li><strong>Comments</strong>: Always add comments explaining database purpose</li>
<li><strong>Retention Policy</strong>: Set appropriate retention based on needs and costs</li>
<li><strong>Access Control</strong>: Grant USAGE to roles that need access</li>
<li><strong>Naming Conventions</strong>: Follow consistent naming conventions</li>
</ol>
<h2 id="troubleshooting-6"><a class="header" href="#troubleshooting-6">Troubleshooting</a></h2>
<h3 id="database-already-exists"><a class="header" href="#database-already-exists">Database Already Exists</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: 2003: Object already exists
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Import existing database: <code>terraform import snowflake_database.TEST_DB "TEST_DB"</code></li>
<li>Or remove database from Snowflake manually</li>
<li>Or use a different database name</li>
</ul>
<h3 id="insufficient-privileges-4"><a class="header" href="#insufficient-privileges-4">Insufficient Privileges</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: 001003 (42000): SQL access control error: Insufficient privileges
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Ensure provider uses SYSADMIN role</li>
<li>Verify user can assume SYSADMIN role</li>
<li>Check that user has necessary privileges</li>
</ul>
<h2 id="related-documentation-3"><a class="header" href="#related-documentation-3">Related Documentation</a></h2>
<ul>
<li><a href="resources/schemas.html">Schemas</a> - Created within databases</li>
<li><a href="resources/grants.html">Grants and Privileges</a> - Granting database access</li>
<li><a href="resources/../getting-started/initial-setup.html">Initial Setup</a> - Creating databases</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="schemas"><a class="header" href="#schemas">Schemas</a></h1>
<p>This document explains how schemas are created and managed in the Terraform configuration.</p>
<h2 id="overview-4"><a class="header" href="#overview-4">Overview</a></h2>
<p>Schemas in Snowflake are containers within databases that hold tables, views, and other objects. The configuration creates schemas directly in the root <code>main.tf</code> file.</p>
<h2 id="resource-definition-1"><a class="header" href="#resource-definition-1">Resource Definition</a></h2>
<h3 id="basic-schema"><a class="header" href="#basic-schema">Basic Schema</a></h3>
<pre><code class="language-hcl">resource "snowflake_schema" "ADS" {
  name     = "ADS"
  database = snowflake_database.TEST_DB.name
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="schema-with-all-options"><a class="header" href="#schema-with-all-options">Schema with All Options</a></h3>
<pre><code class="language-hcl">resource "snowflake_schema" "ADS" {
  name                        = "ADS"
  database                    = snowflake_database.TEST_DB.name
  with_managed_access         = true
  is_transient                = true
  comment                     = "Schema for ads data"
  data_retention_time_in_days = 1
  provider                    = snowflake.snowflake_sysadmin
}
</code></pre>
<h2 id="resource-properties-1"><a class="header" href="#resource-properties-1">Resource Properties</a></h2>
<h3 id="required-properties-1"><a class="header" href="#required-properties-1">Required Properties</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Property</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>name</code></td><td><code>string</code></td><td>Name of the schema</td></tr>
<tr><td><code>database</code></td><td><code>string</code></td><td>Name of the parent database</td></tr>
</tbody></table>
</div>
<h3 id="optional-properties-1"><a class="header" href="#optional-properties-1">Optional Properties</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Property</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td><code>comment</code></td><td><code>string</code></td><td><code>null</code></td><td>Comment describing the schema</td></tr>
<tr><td><code>with_managed_access</code></td><td><code>bool</code></td><td><code>false</code></td><td>Enable managed access (object-level security)</td></tr>
<tr><td><code>is_transient</code></td><td><code>bool</code></td><td><code>false</code></td><td>Whether schema is transient (no Time Travel)</td></tr>
<tr><td><code>data_retention_time_in_days</code></td><td><code>number</code></td><td><code>1</code></td><td>Number of days to retain data (Time Travel)</td></tr>
<tr><td><code>provider</code></td><td><code>provider</code></td><td><code>default</code></td><td>Provider alias to use</td></tr>
</tbody></table>
</div>
<h2 id="examples-4"><a class="header" href="#examples-4">Examples</a></h2>
<h3 id="simple-schema"><a class="header" href="#simple-schema">Simple Schema</a></h3>
<pre><code class="language-hcl">resource "snowflake_schema" "MY_SCHEMA" {
  name     = "MY_SCHEMA"
  database = snowflake_database.MY_DB.name
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="schema-with-managed-access"><a class="header" href="#schema-with-managed-access">Schema with Managed Access</a></h3>
<pre><code class="language-hcl">resource "snowflake_schema" "SECURE_SCHEMA" {
  name                = "SECURE_SCHEMA"
  database            = snowflake_database.MY_DB.name
  with_managed_access = true
  comment             = "Schema with managed access for security"
  provider            = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="transient-schema"><a class="header" href="#transient-schema">Transient Schema</a></h3>
<pre><code class="language-hcl">resource "snowflake_schema" "TEMP_SCHEMA" {
  name         = "TEMP_SCHEMA"
  database     = snowflake_database.MY_DB.name
  is_transient = true
  comment      = "Temporary schema without Time Travel"
  provider     = snowflake.snowflake_sysadmin
}
</code></pre>
<h2 id="managed-access"><a class="header" href="#managed-access">Managed Access</a></h2>
<p>When <code>with_managed_access = true</code>:</p>
<ul>
<li>Enables object-level security</li>
<li>Requires explicit grants on objects (not inherited from schema)</li>
<li>More secure but requires more grant management</li>
<li>Recommended for sensitive data</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="language-hcl">resource "snowflake_schema" "SECURE_SCHEMA" {
  name                = "SECURE_SCHEMA"
  database            = snowflake_database.MY_DB.name
  with_managed_access = true
  provider            = snowflake.snowflake_sysadmin
}
</code></pre>
<h2 id="transient-schemas"><a class="header" href="#transient-schemas">Transient Schemas</a></h2>
<p>When <code>is_transient = true</code>:</p>
<ul>
<li>No Time Travel (cannot query historical data)</li>
<li>No Fail-safe (no backup after Time Travel expires)</li>
<li>Lower storage costs</li>
<li>Use for temporary or non-critical data</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="language-hcl">resource "snowflake_schema" "TEMP_SCHEMA" {
  name         = "TEMP_SCHEMA"
  database     = snowflake_database.MY_DB.name
  is_transient = true
  provider     = snowflake.snowflake_sysadmin
}
</code></pre>
<h2 id="data-retention"><a class="header" href="#data-retention">Data Retention</a></h2>
<p>The <code>data_retention_time_in_days</code> property controls Time Travel retention for the schema:</p>
<ul>
<li>Inherits from database if not specified</li>
<li>Can override database retention</li>
<li>Same retention limits as databases (1-90 days standard, up to 1 year enterprise)</li>
</ul>
<h2 id="provider-requirements-4"><a class="header" href="#provider-requirements-4">Provider Requirements</a></h2>
<p>Schemas require the <code>snowflake_sysadmin</code> provider because:</p>
<ul>
<li>Creating schemas requires SYSADMIN privileges</li>
<li>Schema management is a system administration task</li>
</ul>
<h2 id="dependencies-4"><a class="header" href="#dependencies-4">Dependencies</a></h2>
<h3 id="required-dependencies"><a class="header" href="#required-dependencies">Required Dependencies</a></h3>
<p>Schemas depend on databases:</p>
<ul>
<li>Must reference an existing database</li>
<li>Database must be created before schema</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="language-hcl">resource "snowflake_schema" "ADS" {
  name     = "ADS"
  database = snowflake_database.TEST_DB.name  # References database
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="dependent-resources-1"><a class="header" href="#dependent-resources-1">Dependent Resources</a></h3>
<p>The following resources depend on schemas:</p>
<ul>
<li>Tables (created within schemas)</li>
<li>Views (created within schemas)</li>
<li>Grants (granted on schemas)</li>
</ul>
<h2 id="granting-access-1"><a class="header" href="#granting-access-1">Granting Access</a></h2>
<p>Schemas can be granted to roles for access control:</p>
<pre><code class="language-hcl">resource "snowflake_grant_privileges_to_account_role" "SCHEMA_GRANT" {
  privileges        = ["USAGE"]
  account_role_name = module.ALL_ROLES.ROLES.ANALYST.name
  on_schema {
    schema_name = snowflake_schema.ADS.fully_qualified_name
  }
  with_grant_option = false
  provider          = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="available-privileges-2"><a class="header" href="#available-privileges-2">Available Privileges</a></h3>
<ul>
<li><strong>USAGE</strong>: Use the schema (required to access tables/views)</li>
<li><strong>MODIFY</strong>: Modify schema settings</li>
<li><strong>CREATE TABLE</strong>: Create tables in the schema</li>
<li><strong>CREATE VIEW</strong>: Create views in the schema</li>
<li><strong>CREATE FILE FORMAT</strong>: Create file formats</li>
<li><strong>CREATE STAGE</strong>: Create stages</li>
<li><strong>CREATE FUNCTION</strong>: Create functions</li>
<li><strong>CREATE PROCEDURE</strong>: Create procedures</li>
<li><strong>CREATE SEQUENCE</strong>: Create sequences</li>
<li><strong>CREATE TASK</strong>: Create tasks</li>
<li><strong>CREATE PIPE</strong>: Create pipes</li>
<li><strong>CREATE STREAM</strong>: Create streams</li>
<li><strong>MONITOR</strong>: View schema usage and metrics</li>
<li><strong>OWNERSHIP</strong>: Full ownership of the schema</li>
<li><strong>ALL PRIVILEGES</strong>: All of the above</li>
</ul>
<h2 id="fully-qualified-names"><a class="header" href="#fully-qualified-names">Fully Qualified Names</a></h2>
<p>Schemas have a <code>fully_qualified_name</code> attribute that includes the database:</p>
<pre><code class="language-hcl"># Reference fully qualified name
schema_name = snowflake_schema.ADS.fully_qualified_name
# Results in: "TEST_DB.ADS"
</code></pre>
<p>Use <code>fully_qualified_name</code> when:</p>
<ul>
<li>Granting privileges on schemas</li>
<li>Referencing schemas in other resources</li>
<li>Need database-qualified schema name</li>
</ul>
<h2 id="best-practices-8"><a class="header" href="#best-practices-8">Best Practices</a></h2>
<ol>
<li><strong>Descriptive Names</strong>: Use clear, descriptive schema names</li>
<li><strong>Comments</strong>: Always add comments explaining schema purpose</li>
<li><strong>Managed Access</strong>: Use managed access for sensitive data</li>
<li><strong>Transient for Temp</strong>: Use transient for temporary data</li>
<li><strong>Access Control</strong>: Grant USAGE to roles that need access</li>
<li><strong>Naming Conventions</strong>: Follow consistent naming conventions</li>
</ol>
<h2 id="troubleshooting-7"><a class="header" href="#troubleshooting-7">Troubleshooting</a></h2>
<h3 id="schema-already-exists"><a class="header" href="#schema-already-exists">Schema Already Exists</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: 2003: Object already exists
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Import existing schema: <code>terraform import snowflake_schema.ADS "TEST_DB.ADS"</code></li>
<li>Or remove schema from Snowflake manually</li>
<li>Or use a different schema name</li>
</ul>
<h3 id="database-not-found"><a class="header" href="#database-not-found">Database Not Found</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: Database does not exist
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Ensure database is created before schema</li>
<li>Verify database name is correct</li>
<li>Check that database exists in Snowflake</li>
</ul>
<h3 id="insufficient-privileges-5"><a class="header" href="#insufficient-privileges-5">Insufficient Privileges</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: 001003 (42000): SQL access control error: Insufficient privileges
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Ensure provider uses SYSADMIN role</li>
<li>Verify user can assume SYSADMIN role</li>
<li>Check that user has necessary privileges</li>
</ul>
<h2 id="related-documentation-4"><a class="header" href="#related-documentation-4">Related Documentation</a></h2>
<ul>
<li><a href="resources/databases.html">Databases</a> - Parent containers for schemas</li>
<li><a href="resources/tables.html">Tables</a> - Created within schemas</li>
<li><a href="resources/views.html">Views</a> - Created within schemas</li>
<li><a href="resources/grants.html">Grants and Privileges</a> - Granting schema access</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tables"><a class="header" href="#tables">Tables</a></h1>
<p>This document explains how tables are created and managed in the Terraform configuration.</p>
<h2 id="overview-5"><a class="header" href="#overview-5">Overview</a></h2>
<p>Tables in Snowflake store structured data with defined columns and data types. The configuration creates tables directly in the root <code>main.tf</code> file within schemas.</p>
<h2 id="resource-definition-2"><a class="header" href="#resource-definition-2">Resource Definition</a></h2>
<h3 id="basic-table"><a class="header" href="#basic-table">Basic Table</a></h3>
<pre><code class="language-hcl">resource "snowflake_table" "FACEBOOK_ADS" {
  database = snowflake_database.TEST_DB.name
  schema   = snowflake_schema.ADS.name
  name     = "FACEBOOK_ADS"
  comment  = "A table for facebook ads data"
  
  column {
    name     = "ID"
    type     = "NUMBER(38,0)"
    nullable = false
  }
  
  column {
    name = "AD_NAME"
    type = "VARCHAR(16777216)"
  }
  
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h2 id="resource-properties-2"><a class="header" href="#resource-properties-2">Resource Properties</a></h2>
<h3 id="required-properties-2"><a class="header" href="#required-properties-2">Required Properties</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Property</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>name</code></td><td><code>string</code></td><td>Name of the table</td></tr>
<tr><td><code>database</code></td><td><code>string</code></td><td>Name of the parent database</td></tr>
<tr><td><code>schema</code></td><td><code>string</code></td><td>Name of the parent schema</td></tr>
</tbody></table>
</div>
<h3 id="optional-properties-2"><a class="header" href="#optional-properties-2">Optional Properties</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Property</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td><code>comment</code></td><td><code>string</code></td><td><code>null</code></td><td>Comment describing the table</td></tr>
<tr><td><code>provider</code></td><td><code>provider</code></td><td><code>default</code></td><td>Provider alias to use</td></tr>
</tbody></table>
</div>
<h3 id="column-block"><a class="header" href="#column-block">Column Block</a></h3>
<p>Each table must have at least one column block:</p>
<div class="table-wrapper"><table><thead><tr><th>Property</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody>
<tr><td><code>name</code></td><td><code>string</code></td><td>Yes</td><td>Column name</td></tr>
<tr><td><code>type</code></td><td><code>string</code></td><td>Yes</td><td>Column data type</td></tr>
<tr><td><code>nullable</code></td><td><code>bool</code></td><td>No</td><td>Whether column allows NULL values</td></tr>
<tr><td><code>default</code></td><td><code>string</code></td><td>No</td><td>Default value for the column</td></tr>
<tr><td><code>comment</code></td><td><code>string</code></td><td>No</td><td>Comment describing the column</td></tr>
</tbody></table>
</div>
<h2 id="data-types"><a class="header" href="#data-types">Data Types</a></h2>
<p>Common Snowflake data types:</p>
<h3 id="numeric-types"><a class="header" href="#numeric-types">Numeric Types</a></h3>
<ul>
<li><code>NUMBER(p,s)</code>: Fixed-point number (precision, scale)</li>
<li><code>FLOAT</code>, <code>FLOAT4</code>, <code>FLOAT8</code>: Floating-point numbers</li>
<li><code>INTEGER</code>, <code>INT</code>, <code>BIGINT</code>, <code>SMALLINT</code>, <code>TINYINT</code>: Integer types</li>
</ul>
<h3 id="string-types"><a class="header" href="#string-types">String Types</a></h3>
<ul>
<li><code>VARCHAR(n)</code>: Variable-length string (max 16MB)</li>
<li><code>CHAR(n)</code>: Fixed-length string</li>
<li><code>STRING</code>: Alias for VARCHAR(16777216)</li>
<li><code>TEXT</code>: Alias for VARCHAR(16777216)</li>
</ul>
<h3 id="datetime-types"><a class="header" href="#datetime-types">Date/Time Types</a></h3>
<ul>
<li><code>DATE</code>: Date only</li>
<li><code>TIME</code>: Time only</li>
<li><code>TIMESTAMP_NTZ</code>: Timestamp without timezone</li>
<li><code>TIMESTAMP_LTZ</code>: Timestamp with local timezone</li>
<li><code>TIMESTAMP_TZ</code>: Timestamp with timezone</li>
</ul>
<h3 id="other-types"><a class="header" href="#other-types">Other Types</a></h3>
<ul>
<li><code>BOOLEAN</code>: True/false values</li>
<li><code>VARIANT</code>: Semi-structured data (JSON, etc.)</li>
<li><code>ARRAY</code>: Array of values</li>
<li><code>OBJECT</code>: Key-value pairs</li>
</ul>
<h2 id="examples-5"><a class="header" href="#examples-5">Examples</a></h2>
<h3 id="simple-table"><a class="header" href="#simple-table">Simple Table</a></h3>
<pre><code class="language-hcl">resource "snowflake_table" "USERS" {
  database = snowflake_database.MY_DB.name
  schema   = snowflake_schema.PUBLIC.name
  name     = "USERS"
  comment  = "User table"
  
  column {
    name     = "USER_ID"
    type     = "NUMBER(38,0)"
    nullable = false
  }
  
  column {
    name = "USERNAME"
    type = "VARCHAR(255)"
  }
  
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="table-with-all-column-options"><a class="header" href="#table-with-all-column-options">Table with All Column Options</a></h3>
<pre><code class="language-hcl">resource "snowflake_table" "ORDERS" {
  database = snowflake_database.MY_DB.name
  schema   = snowflake_schema.SALES.name
  name     = "ORDERS"
  comment  = "Orders table"
  
  column {
    name     = "ORDER_ID"
    type     = "NUMBER(38,0)"
    nullable = false
    comment  = "Primary key"
  }
  
  column {
    name     = "ORDER_DATE"
    type     = "TIMESTAMP_NTZ(9)"
    nullable = false
    default  = "CURRENT_TIMESTAMP()"
  }
  
  column {
    name     = "CUSTOMER_ID"
    type     = "NUMBER(38,0)"
    nullable = false
  }
  
  column {
    name     = "TOTAL_AMOUNT"
    type     = "NUMBER(10,2)"
    nullable = true
    comment  = "Order total in dollars"
  }
  
  column {
    name     = "ORDER_DATA"
    type     = "VARIANT"
    nullable = true
    comment  = "Additional order data in JSON format"
  }
  
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="table-with-variant-column"><a class="header" href="#table-with-variant-column">Table with Variant Column</a></h3>
<pre><code class="language-hcl">resource "snowflake_table" "FACEBOOK_ADS" {
  database = snowflake_database.TEST_DB.name
  schema   = snowflake_schema.ADS.name
  name     = "FACEBOOK_ADS"
  comment  = "A table for facebook ads data"
  
  column {
    name     = "ID"
    type     = "NUMBER(38,0)"
    nullable = false
  }
  
  column {
    name     = "AD_NAME"
    type     = "VARCHAR(16777216)"
    nullable = false
  }
  
  column {
    name = "AD_DATE"
    type = "TIMESTAMP_NTZ(9)"
  }
  
  column {
    name    = "EXAMPLE_VARIANT"
    type    = "VARIANT"
    comment = "extra data for the ad"
  }
  
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h2 id="provider-requirements-5"><a class="header" href="#provider-requirements-5">Provider Requirements</a></h2>
<p>Tables require the <code>snowflake_sysadmin</code> provider because:</p>
<ul>
<li>Creating tables requires SYSADMIN privileges</li>
<li>Table management is a system administration task</li>
</ul>
<p><strong>Note:</strong> The provider configuration includes <code>preview_features_enabled = ["snowflake_table_resource"]</code> which may be required for table operations.</p>
<h2 id="dependencies-5"><a class="header" href="#dependencies-5">Dependencies</a></h2>
<h3 id="required-dependencies-1"><a class="header" href="#required-dependencies-1">Required Dependencies</a></h3>
<p>Tables depend on:</p>
<ul>
<li><strong>Database</strong>: Must reference an existing database</li>
<li><strong>Schema</strong>: Must reference an existing schema</li>
<li>Schema must be created before table</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="language-hcl">resource "snowflake_table" "MY_TABLE" {
  database = snowflake_database.TEST_DB.name  # References database
  schema   = snowflake_schema.ADS.name        # References schema
  name     = "MY_TABLE"
  # ...
}
</code></pre>
<h3 id="dependent-resources-2"><a class="header" href="#dependent-resources-2">Dependent Resources</a></h3>
<p>The following resources depend on tables:</p>
<ul>
<li>Views (may reference tables)</li>
<li>Grants (granted on tables)</li>
</ul>
<h2 id="fully-qualified-names-1"><a class="header" href="#fully-qualified-names-1">Fully Qualified Names</a></h2>
<p>Tables have a <code>fully_qualified_name</code> attribute that includes database and schema:</p>
<pre><code class="language-hcl"># Reference fully qualified name
object_name = snowflake_table.FACEBOOK_ADS.fully_qualified_name
# Results in: "TEST_DB.ADS.FACEBOOK_ADS"
</code></pre>
<p>Use <code>fully_qualified_name</code> when:</p>
<ul>
<li>Granting privileges on tables</li>
<li>Referencing tables in other resources</li>
<li>Need fully qualified table name</li>
</ul>
<h2 id="granting-access-2"><a class="header" href="#granting-access-2">Granting Access</a></h2>
<p>Tables can be granted to roles for access control:</p>
<pre><code class="language-hcl">resource "snowflake_grant_privileges_to_account_role" "TABLE_GRANT" {
  privileges        = ["SELECT"]
  account_role_name = module.ALL_ROLES.ROLES.ANALYST.name
  on_schema_object {
    object_type = "TABLE"
    object_name = snowflake_table.FACEBOOK_ADS.fully_qualified_name
  }
  with_grant_option = false
  provider          = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="available-privileges-3"><a class="header" href="#available-privileges-3">Available Privileges</a></h3>
<ul>
<li><strong>SELECT</strong>: Query the table</li>
<li><strong>INSERT</strong>: Insert rows into the table</li>
<li><strong>UPDATE</strong>: Update rows in the table</li>
<li><strong>DELETE</strong>: Delete rows from the table</li>
<li><strong>TRUNCATE</strong>: Truncate the table</li>
<li><strong>REFERENCES</strong>: Reference the table in foreign keys</li>
<li><strong>OWNERSHIP</strong>: Full ownership of the table</li>
<li><strong>ALL PRIVILEGES</strong>: All of the above</li>
</ul>
<h2 id="best-practices-9"><a class="header" href="#best-practices-9">Best Practices</a></h2>
<ol>
<li><strong>Descriptive Names</strong>: Use clear, descriptive table and column names</li>
<li><strong>Comments</strong>: Always add comments explaining table and column purpose</li>
<li><strong>Nullable Columns</strong>: Explicitly set <code>nullable</code> for clarity</li>
<li><strong>Data Types</strong>: Choose appropriate data types for data</li>
<li><strong>Primary Keys</strong>: Consider adding primary key constraints (via ALTER TABLE)</li>
<li><strong>Access Control</strong>: Grant appropriate privileges to roles</li>
<li><strong>Naming Conventions</strong>: Follow consistent naming conventions</li>
</ol>
<h2 id="troubleshooting-8"><a class="header" href="#troubleshooting-8">Troubleshooting</a></h2>
<h3 id="table-already-exists"><a class="header" href="#table-already-exists">Table Already Exists</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: 2003: Object already exists
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Import existing table: <code>terraform import snowflake_table.FACEBOOK_ADS "TEST_DB.ADS.FACEBOOK_ADS"</code></li>
<li>Or remove table from Snowflake manually</li>
<li>Or use a different table name</li>
</ul>
<h3 id="schema-not-found"><a class="header" href="#schema-not-found">Schema Not Found</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: Schema does not exist
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Ensure schema is created before table</li>
<li>Verify schema name is correct</li>
<li>Check that schema exists in Snowflake</li>
</ul>
<h3 id="invalid-data-type"><a class="header" href="#invalid-data-type">Invalid Data Type</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: Invalid data type
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Verify data type syntax is correct</li>
<li>Check that data type is supported by Snowflake</li>
<li>Review Snowflake data type documentation</li>
</ul>
<h3 id="insufficient-privileges-6"><a class="header" href="#insufficient-privileges-6">Insufficient Privileges</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: 001003 (42000): SQL access control error: Insufficient privileges
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Ensure provider uses SYSADMIN role</li>
<li>Verify user can assume SYSADMIN role</li>
<li>Check that user has necessary privileges</li>
</ul>
<h2 id="related-documentation-5"><a class="header" href="#related-documentation-5">Related Documentation</a></h2>
<ul>
<li><a href="resources/schemas.html">Schemas</a> - Parent containers for tables</li>
<li><a href="resources/views.html">Views</a> - May reference tables</li>
<li><a href="resources/grants.html">Grants and Privileges</a> - Granting table access</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="views"><a class="header" href="#views">Views</a></h1>
<p>This document explains how views are created and managed in the Terraform configuration.</p>
<h2 id="overview-6"><a class="header" href="#overview-6">Overview</a></h2>
<p>Views in Snowflake are virtual tables defined by SQL queries. They provide a way to present data from one or more tables in a specific format. The configuration creates views directly in the root <code>main.tf</code> file within schemas.</p>
<h2 id="resource-definition-3"><a class="header" href="#resource-definition-3">Resource Definition</a></h2>
<h3 id="basic-view"><a class="header" href="#basic-view">Basic View</a></h3>
<pre><code class="language-hcl">resource "snowflake_view" "AGG_FACEBOOK_ADS" {
  database  = snowflake_database.TEST_DB.name
  schema    = snowflake_schema.ADS.name
  name      = "AGG_FACEBOOK_ADS"
  statement = &lt;&lt;-SQL
    SELECT AD_DATE, COUNT(1) AS COUNT_ADS 
    FROM FACEBOOK_ADS 
    GROUP BY ALL;
  SQL
  comment   = "Aggregated view for facebook ads"
  
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h2 id="resource-properties-3"><a class="header" href="#resource-properties-3">Resource Properties</a></h2>
<h3 id="required-properties-3"><a class="header" href="#required-properties-3">Required Properties</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Property</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>name</code></td><td><code>string</code></td><td>Name of the view</td></tr>
<tr><td><code>database</code></td><td><code>string</code></td><td>Name of the parent database</td></tr>
<tr><td><code>schema</code></td><td><code>string</code></td><td>Name of the parent schema</td></tr>
<tr><td><code>statement</code></td><td><code>string</code></td><td>SQL SELECT statement defining the view</td></tr>
</tbody></table>
</div>
<h3 id="optional-properties-3"><a class="header" href="#optional-properties-3">Optional Properties</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Property</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td><code>comment</code></td><td><code>string</code></td><td><code>null</code></td><td>Comment describing the view</td></tr>
<tr><td><code>is_secure</code></td><td><code>bool</code></td><td><code>false</code></td><td>Whether view is secure (hides underlying query)</td></tr>
<tr><td><code>or_replace</code></td><td><code>bool</code></td><td><code>false</code></td><td>Whether to replace existing view</td></tr>
<tr><td><code>depends_on</code></td><td><code>list</code></td><td><code>[]</code></td><td>Resources this view depends on</td></tr>
<tr><td><code>provider</code></td><td><code>provider</code></td><td><code>default</code></td><td>Provider alias to use</td></tr>
</tbody></table>
</div>
<h2 id="examples-6"><a class="header" href="#examples-6">Examples</a></h2>
<h3 id="simple-view"><a class="header" href="#simple-view">Simple View</a></h3>
<pre><code class="language-hcl">resource "snowflake_view" "USER_SUMMARY" {
  database  = snowflake_database.MY_DB.name
  schema    = snowflake_schema.PUBLIC.name
  name      = "USER_SUMMARY"
  statement = &lt;&lt;-SQL
    SELECT 
      USER_ID,
      USERNAME,
      CREATED_DATE
    FROM USERS
    WHERE ACTIVE = TRUE;
  SQL
  comment   = "Summary of active users"
  
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="aggregated-view"><a class="header" href="#aggregated-view">Aggregated View</a></h3>
<pre><code class="language-hcl">resource "snowflake_view" "AGG_FACEBOOK_ADS" {
  database  = snowflake_database.TEST_DB.name
  schema    = snowflake_schema.ADS.name
  name      = "AGG_FACEBOOK_ADS"
  statement = &lt;&lt;-SQL
    SELECT 
      AD_DATE, 
      COUNT(1) AS COUNT_ADS 
    FROM FACEBOOK_ADS 
    GROUP BY ALL;
  SQL
  comment   = "Aggregated view for facebook ads"
  depends_on = [snowflake_table.FACEBOOK_ADS]
  
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="view-with-joins"><a class="header" href="#view-with-joins">View with Joins</a></h3>
<pre><code class="language-hcl">resource "snowflake_view" "ORDER_DETAILS" {
  database  = snowflake_database.MY_DB.name
  schema    = snowflake_schema.SALES.name
  name      = "ORDER_DETAILS"
  statement = &lt;&lt;-SQL
    SELECT 
      o.ORDER_ID,
      o.ORDER_DATE,
      c.CUSTOMER_NAME,
      c.CUSTOMER_EMAIL,
      o.TOTAL_AMOUNT
    FROM ORDERS o
    JOIN CUSTOMERS c ON o.CUSTOMER_ID = c.CUSTOMER_ID
    WHERE o.ORDER_DATE &gt;= CURRENT_DATE - 30;
  SQL
  comment   = "Order details with customer information"
  depends_on = [snowflake_table.ORDERS, snowflake_table.CUSTOMERS]
  
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="secure-view"><a class="header" href="#secure-view">Secure View</a></h3>
<pre><code class="language-hcl">resource "snowflake_view" "SECURE_USER_DATA" {
  database  = snowflake_database.MY_DB.name
  schema    = snowflake_schema.SECURE.name
  name      = "SECURE_USER_DATA"
  statement = &lt;&lt;-SQL
    SELECT 
      USER_ID,
      USERNAME,
      EMAIL
    FROM USERS
    WHERE DEPARTMENT = CURRENT_ROLE();
  SQL
  comment   = "Secure view with row-level security"
  is_secure = true
  
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h2 id="sql-statement-format"><a class="header" href="#sql-statement-format">SQL Statement Format</a></h2>
<p>The <code>statement</code> property contains the SQL SELECT statement that defines the view:</p>
<h3 id="using-heredoc-syntax"><a class="header" href="#using-heredoc-syntax">Using Heredoc Syntax</a></h3>
<pre><code class="language-hcl">statement = &lt;&lt;-SQL
  SELECT 
    COLUMN1,
    COLUMN2
  FROM TABLE_NAME
  WHERE CONDITION;
SQL
</code></pre>
<p><strong>Benefits:</strong></p>
<ul>
<li>Multi-line SQL support</li>
<li>Better readability</li>
<li>Preserves formatting</li>
</ul>
<h3 id="using-string-literal"><a class="header" href="#using-string-literal">Using String Literal</a></h3>
<pre><code class="language-hcl">statement = "SELECT COLUMN1, COLUMN2 FROM TABLE_NAME WHERE CONDITION;"
</code></pre>
<p><strong>Use when:</strong></p>
<ul>
<li>Simple single-line queries</li>
<li>No special formatting needed</li>
</ul>
<h2 id="dependencies-6"><a class="header" href="#dependencies-6">Dependencies</a></h2>
<p>Views should explicitly declare dependencies on tables they reference:</p>
<pre><code class="language-hcl">resource "snowflake_view" "MY_VIEW" {
  # ... other properties ...
  depends_on = [snowflake_table.MY_TABLE]
}
</code></pre>
<p><strong>Why:</strong></p>
<ul>
<li>Ensures tables are created before views</li>
<li>Prevents errors during Terraform apply</li>
<li>Makes dependencies explicit</li>
</ul>
<h2 id="secure-views"><a class="header" href="#secure-views">Secure Views</a></h2>
<p>Secure views hide the underlying SQL query from users who can only view the view definition:</p>
<pre><code class="language-hcl">resource "snowflake_view" "SECURE_VIEW" {
  # ... other properties ...
  is_secure = true
}
</code></pre>
<p><strong>Benefits:</strong></p>
<ul>
<li>Protects query logic</li>
<li>Prevents reverse engineering</li>
<li>Enhanced security</li>
</ul>
<p><strong>Considerations:</strong></p>
<ul>
<li>Slightly higher query cost</li>
<li>Use for sensitive queries</li>
</ul>
<h2 id="provider-requirements-6"><a class="header" href="#provider-requirements-6">Provider Requirements</a></h2>
<p>Views require the <code>snowflake_sysadmin</code> provider because:</p>
<ul>
<li>Creating views requires SYSADMIN privileges</li>
<li>View management is a system administration task</li>
</ul>
<h2 id="dependencies-7"><a class="header" href="#dependencies-7">Dependencies</a></h2>
<h3 id="required-dependencies-2"><a class="header" href="#required-dependencies-2">Required Dependencies</a></h3>
<p>Views depend on:</p>
<ul>
<li><strong>Database</strong>: Must reference an existing database</li>
<li><strong>Schema</strong>: Must reference an existing schema</li>
<li><strong>Tables</strong> (usually): Views typically reference tables</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="language-hcl">resource "snowflake_view" "MY_VIEW" {
  database = snowflake_database.TEST_DB.name  # References database
  schema   = snowflake_schema.ADS.name        # References schema
  # ... SQL statement references tables ...
  depends_on = [snowflake_table.MY_TABLE]     # Explicit dependency
}
</code></pre>
<h3 id="dependent-resources-3"><a class="header" href="#dependent-resources-3">Dependent Resources</a></h3>
<p>The following resources depend on views:</p>
<ul>
<li>Grants (granted on views)</li>
<li>Other views (views can reference other views)</li>
</ul>
<h2 id="fully-qualified-names-2"><a class="header" href="#fully-qualified-names-2">Fully Qualified Names</a></h2>
<p>Views have a <code>fully_qualified_name</code> attribute that includes database and schema:</p>
<pre><code class="language-hcl"># Reference fully qualified name
object_name = snowflake_view.AGG_FACEBOOK_ADS.fully_qualified_name
# Results in: "TEST_DB.ADS.AGG_FACEBOOK_ADS"
</code></pre>
<p>Use <code>fully_qualified_name</code> when:</p>
<ul>
<li>Granting privileges on views</li>
<li>Referencing views in other resources</li>
<li>Need fully qualified view name</li>
</ul>
<h2 id="granting-access-3"><a class="header" href="#granting-access-3">Granting Access</a></h2>
<p>Views can be granted to roles for access control:</p>
<pre><code class="language-hcl">resource "snowflake_grant_privileges_to_account_role" "VIEW_GRANT" {
  privileges        = ["SELECT"]
  account_role_name = module.ALL_ROLES.ROLES.ANALYST.name
  on_schema_object {
    object_type = "VIEW"
    object_name = snowflake_view.AGG_FACEBOOK_ADS.fully_qualified_name
  }
  with_grant_option = false
  provider          = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="available-privileges-4"><a class="header" href="#available-privileges-4">Available Privileges</a></h3>
<ul>
<li><strong>SELECT</strong>: Query the view</li>
<li><strong>REFERENCES</strong>: Reference the view in other objects</li>
<li><strong>OWNERSHIP</strong>: Full ownership of the view</li>
<li><strong>ALL PRIVILEGES</strong>: All of the above</li>
</ul>
<p><strong>Note:</strong> Views are read-only, so INSERT, UPDATE, DELETE privileges are not applicable.</p>
<h2 id="best-practices-10"><a class="header" href="#best-practices-10">Best Practices</a></h2>
<ol>
<li><strong>Descriptive Names</strong>: Use clear, descriptive view names</li>
<li><strong>Comments</strong>: Always add comments explaining view purpose</li>
<li><strong>Dependencies</strong>: Explicitly declare dependencies on tables</li>
<li><strong>SQL Formatting</strong>: Use heredoc syntax for multi-line SQL</li>
<li><strong>Secure Views</strong>: Use secure views for sensitive queries</li>
<li><strong>Access Control</strong>: Grant SELECT to roles that need access</li>
<li><strong>Performance</strong>: Consider materialized views for frequently accessed data</li>
<li><strong>Documentation</strong>: Document complex SQL logic in comments</li>
</ol>
<h2 id="common-patterns"><a class="header" href="#common-patterns">Common Patterns</a></h2>
<h3 id="aggregation-views"><a class="header" href="#aggregation-views">Aggregation Views</a></h3>
<pre><code class="language-hcl">resource "snowflake_view" "DAILY_SUMMARY" {
  database  = snowflake_database.MY_DB.name
  schema    = snowflake_schema.ANALYTICS.name
  name      = "DAILY_SUMMARY"
  statement = &lt;&lt;-SQL
    SELECT 
      DATE_TRUNC('day', EVENT_DATE) AS DAY,
      COUNT(*) AS EVENT_COUNT,
      SUM(AMOUNT) AS TOTAL_AMOUNT
    FROM EVENTS
    GROUP BY DATE_TRUNC('day', EVENT_DATE);
  SQL
  comment   = "Daily aggregated event summary"
  depends_on = [snowflake_table.EVENTS]
  
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="filtered-views"><a class="header" href="#filtered-views">Filtered Views</a></h3>
<pre><code class="language-hcl">resource "snowflake_view" "ACTIVE_USERS" {
  database  = snowflake_database.MY_DB.name
  schema    = snowflake_schema.PUBLIC.name
  name      = "ACTIVE_USERS"
  statement = &lt;&lt;-SQL
    SELECT *
    FROM USERS
    WHERE STATUS = 'ACTIVE'
      AND LAST_LOGIN &gt;= CURRENT_DATE - 30;
  SQL
  comment   = "Currently active users"
  depends_on = [snowflake_table.USERS]
  
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h2 id="troubleshooting-9"><a class="header" href="#troubleshooting-9">Troubleshooting</a></h2>
<h3 id="view-already-exists"><a class="header" href="#view-already-exists">View Already Exists</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: 2003: Object already exists
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Import existing view: <code>terraform import snowflake_view.AGG_FACEBOOK_ADS "TEST_DB.ADS.AGG_FACEBOOK_ADS"</code></li>
<li>Or remove view from Snowflake manually</li>
<li>Or use <code>or_replace = true</code> to replace existing view</li>
<li>Or use a different view name</li>
</ul>
<h3 id="table-not-found"><a class="header" href="#table-not-found">Table Not Found</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: Table does not exist
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Ensure tables are created before views</li>
<li>Add explicit <code>depends_on</code> declarations</li>
<li>Verify table names in SQL statement</li>
<li>Check that tables exist in Snowflake</li>
</ul>
<h3 id="invalid-sql-statement"><a class="header" href="#invalid-sql-statement">Invalid SQL Statement</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: SQL compilation error
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Verify SQL syntax is correct</li>
<li>Test SQL statement directly in Snowflake</li>
<li>Check that referenced objects exist</li>
<li>Review Snowflake SQL documentation</li>
</ul>
<h3 id="insufficient-privileges-7"><a class="header" href="#insufficient-privileges-7">Insufficient Privileges</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: 001003 (42000): SQL access control error: Insufficient privileges
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Ensure provider uses SYSADMIN role</li>
<li>Verify user can assume SYSADMIN role</li>
<li>Check that user has SELECT on underlying tables</li>
<li>Verify user has necessary privileges</li>
</ul>
<h2 id="related-documentation-6"><a class="header" href="#related-documentation-6">Related Documentation</a></h2>
<ul>
<li><a href="resources/tables.html">Tables</a> - Views typically reference tables</li>
<li><a href="resources/schemas.html">Schemas</a> - Parent containers for views</li>
<li><a href="resources/grants.html">Grants and Privileges</a> - Granting view access</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="grants-and-privileges"><a class="header" href="#grants-and-privileges">Grants and Privileges</a></h1>
<p>This document explains how privileges are granted to roles on various Snowflake objects in the Terraform configuration.</p>
<h2 id="overview-7"><a class="header" href="#overview-7">Overview</a></h2>
<p>Grants in Snowflake control access to objects by assigning privileges to roles. The configuration uses <code>snowflake_grant_privileges_to_account_role</code> resources to grant privileges on databases, schemas, tables, views, and warehouses.</p>
<h2 id="grant-resource"><a class="header" href="#grant-resource">Grant Resource</a></h2>
<h3 id="basic-grant-structure"><a class="header" href="#basic-grant-structure">Basic Grant Structure</a></h3>
<pre><code class="language-hcl">resource "snowflake_grant_privileges_to_account_role" "GRANT_NAME" {
  privileges        = ["USAGE"]
  account_role_name = module.ALL_ROLES.ROLES.ROLE_NAME.name
  
  on_account_object {
    object_type = "DATABASE"
    object_name = snowflake_database.TEST_DB.name
  }
  
  with_grant_option = false
  provider          = snowflake.snowflake_sysadmin
}
</code></pre>
<h2 id="grant-properties"><a class="header" href="#grant-properties">Grant Properties</a></h2>
<h3 id="required-properties-4"><a class="header" href="#required-properties-4">Required Properties</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Property</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>privileges</code></td><td><code>list(string)</code></td><td>List of privileges to grant</td></tr>
<tr><td><code>account_role_name</code></td><td><code>string</code></td><td>Name of the role receiving privileges</td></tr>
</tbody></table>
</div>
<h3 id="object-specification"><a class="header" href="#object-specification">Object Specification</a></h3>
<p>One of the following must be specified:</p>
<h4 id="account-object"><a class="header" href="#account-object">Account Object</a></h4>
<pre><code class="language-hcl">on_account_object {
  object_type = "DATABASE" | "WAREHOUSE" | "INTEGRATION" | ...
  object_name = "OBJECT_NAME"
}
</code></pre>
<h4 id="schema-object"><a class="header" href="#schema-object">Schema Object</a></h4>
<pre><code class="language-hcl">on_schema {
  schema_name = "DATABASE.SCHEMA"  # or fully_qualified_name
}
</code></pre>
<h4 id="schema-object-specific-object"><a class="header" href="#schema-object-specific-object">Schema Object (Specific Object)</a></h4>
<pre><code class="language-hcl">on_schema_object {
  object_type = "TABLE" | "VIEW" | "FUNCTION" | ...
  object_name = "DATABASE.SCHEMA.OBJECT"  # or fully_qualified_name
}
</code></pre>
<h3 id="optional-properties-4"><a class="header" href="#optional-properties-4">Optional Properties</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Property</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td><code>with_grant_option</code></td><td><code>bool</code></td><td><code>false</code></td><td>Whether grant includes grant option</td></tr>
<tr><td><code>provider</code></td><td><code>provider</code></td><td><code>default</code></td><td>Provider alias to use</td></tr>
</tbody></table>
</div>
<h2 id="database-grants"><a class="header" href="#database-grants">Database Grants</a></h2>
<h3 id="grant-usage-on-database"><a class="header" href="#grant-usage-on-database">Grant USAGE on Database</a></h3>
<pre><code class="language-hcl">resource "snowflake_grant_privileges_to_account_role" "MARKETING_TEST_DB_GRANT" {
  privileges        = ["USAGE"]
  account_role_name = module.ALL_ROLES.ROLES.MARKETING.name
  on_account_object {
    object_type = "DATABASE"
    object_name = snowflake_database.TEST_DB.name
  }
  with_grant_option = false
  provider          = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="available-database-privileges"><a class="header" href="#available-database-privileges">Available Database Privileges</a></h3>
<ul>
<li><strong>USAGE</strong>: Use the database (required to access schemas/tables)</li>
<li><strong>MODIFY</strong>: Modify database settings</li>
<li><strong>CREATE SCHEMA</strong>: Create schemas in the database</li>
<li><strong>MONITOR</strong>: View database usage and metrics</li>
<li><strong>OWNERSHIP</strong>: Full ownership of the database</li>
<li><strong>ALL PRIVILEGES</strong>: All of the above</li>
</ul>
<h2 id="schema-grants"><a class="header" href="#schema-grants">Schema Grants</a></h2>
<h3 id="grant-usage-on-schema"><a class="header" href="#grant-usage-on-schema">Grant USAGE on Schema</a></h3>
<pre><code class="language-hcl">resource "snowflake_grant_privileges_to_account_role" "MARKETING_ADS_SCHEMA_GRANT" {
  privileges        = ["USAGE"]
  account_role_name = module.ALL_ROLES.ROLES.MARKETING.name
  on_schema {
    schema_name = snowflake_schema.ADS.fully_qualified_name
  }
  with_grant_option = false
  provider          = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="available-schema-privileges"><a class="header" href="#available-schema-privileges">Available Schema Privileges</a></h3>
<ul>
<li><strong>USAGE</strong>: Use the schema (required to access tables/views)</li>
<li><strong>MODIFY</strong>: Modify schema settings</li>
<li><strong>CREATE TABLE</strong>: Create tables in the schema</li>
<li><strong>CREATE VIEW</strong>: Create views in the schema</li>
<li><strong>CREATE FILE FORMAT</strong>: Create file formats</li>
<li><strong>CREATE STAGE</strong>: Create stages</li>
<li><strong>CREATE FUNCTION</strong>: Create functions</li>
<li><strong>CREATE PROCEDURE</strong>: Create procedures</li>
<li><strong>CREATE SEQUENCE</strong>: Create sequences</li>
<li><strong>CREATE TASK</strong>: Create tasks</li>
<li><strong>CREATE PIPE</strong>: Create pipes</li>
<li><strong>CREATE STREAM</strong>: Create streams</li>
<li><strong>MONITOR</strong>: View schema usage and metrics</li>
<li><strong>OWNERSHIP</strong>: Full ownership of the schema</li>
<li><strong>ALL PRIVILEGES</strong>: All of the above</li>
</ul>
<h2 id="table-grants"><a class="header" href="#table-grants">Table Grants</a></h2>
<h3 id="grant-select-on-table"><a class="header" href="#grant-select-on-table">Grant SELECT on Table</a></h3>
<pre><code class="language-hcl">resource "snowflake_grant_privileges_to_account_role" "FACEBOOK_ADS_TABLE_SELECT_GRANT" {
  privileges        = ["SELECT"]
  account_role_name = module.ALL_ROLES.ROLES.MARKETING.name
  on_schema_object {
    object_type = "TABLE"
    object_name = snowflake_table.FACEBOOK_ADS.fully_qualified_name
  }
  with_grant_option = false
  provider          = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="available-table-privileges"><a class="header" href="#available-table-privileges">Available Table Privileges</a></h3>
<ul>
<li><strong>SELECT</strong>: Query the table</li>
<li><strong>INSERT</strong>: Insert rows into the table</li>
<li><strong>UPDATE</strong>: Update rows in the table</li>
<li><strong>DELETE</strong>: Delete rows from the table</li>
<li><strong>TRUNCATE</strong>: Truncate the table</li>
<li><strong>REFERENCES</strong>: Reference the table in foreign keys</li>
<li><strong>OWNERSHIP</strong>: Full ownership of the table</li>
<li><strong>ALL PRIVILEGES</strong>: All of the above</li>
</ul>
<h3 id="grant-multiple-privileges"><a class="header" href="#grant-multiple-privileges">Grant Multiple Privileges</a></h3>
<pre><code class="language-hcl">resource "snowflake_grant_privileges_to_account_role" "TABLE_FULL_GRANT" {
  privileges        = ["SELECT", "INSERT", "UPDATE", "DELETE"]
  account_role_name = module.ALL_ROLES.ROLES.DATA_ENGINEER.name
  on_schema_object {
    object_type = "TABLE"
    object_name = snowflake_table.MY_TABLE.fully_qualified_name
  }
  with_grant_option = false
  provider          = snowflake.snowflake_sysadmin
}
</code></pre>
<h2 id="view-grants"><a class="header" href="#view-grants">View Grants</a></h2>
<h3 id="grant-select-on-view"><a class="header" href="#grant-select-on-view">Grant SELECT on View</a></h3>
<pre><code class="language-hcl">resource "snowflake_grant_privileges_to_account_role" "AGG_FACEBOOK_ADS_VIEW_SELECT_GRANT" {
  privileges        = ["SELECT"]
  account_role_name = module.ALL_ROLES.ROLES.MARKETING.name
  on_schema_object {
    object_type = "VIEW"
    object_name = snowflake_view.AGG_FACEBOOK_ADS.fully_qualified_name
  }
  with_grant_option = false
  provider          = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="available-view-privileges"><a class="header" href="#available-view-privileges">Available View Privileges</a></h3>
<ul>
<li><strong>SELECT</strong>: Query the view</li>
<li><strong>REFERENCES</strong>: Reference the view in other objects</li>
<li><strong>OWNERSHIP</strong>: Full ownership of the view</li>
<li><strong>ALL PRIVILEGES</strong>: All of the above</li>
</ul>
<p><strong>Note:</strong> Views are read-only, so INSERT, UPDATE, DELETE privileges are not applicable.</p>
<h2 id="warehouse-grants"><a class="header" href="#warehouse-grants">Warehouse Grants</a></h2>
<p>Warehouse privileges are typically managed within the warehouse module, but can also be granted directly:</p>
<h3 id="grant-usage-on-warehouse"><a class="header" href="#grant-usage-on-warehouse">Grant USAGE on Warehouse</a></h3>
<pre><code class="language-hcl">resource "snowflake_grant_privileges_to_account_role" "WAREHOUSE_GRANT" {
  privileges        = ["USAGE"]
  account_role_name = module.ALL_ROLES.ROLES.ANALYST.name
  on_account_object {
    object_type = "WAREHOUSE"
    object_name = module.ALL_WAREHOUSES.WAREHOUSES.MY_WH.name
  }
  with_grant_option = false
  provider          = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="available-warehouse-privileges"><a class="header" href="#available-warehouse-privileges">Available Warehouse Privileges</a></h3>
<ul>
<li><strong>USAGE</strong>: Use the warehouse for queries</li>
<li><strong>OPERATE</strong>: Resume/suspend the warehouse</li>
<li><strong>MODIFY</strong>: Change warehouse settings</li>
<li><strong>MONITOR</strong>: View warehouse usage and metrics</li>
<li><strong>ALL PRIVILEGES</strong>: All of the above</li>
</ul>
<h2 id="grant-option"><a class="header" href="#grant-option">Grant Option</a></h2>
<p>The <code>with_grant_option</code> property allows the grantee to grant the same privileges to other roles:</p>
<pre><code class="language-hcl">resource "snowflake_grant_privileges_to_account_role" "GRANT_WITH_OPTION" {
  privileges        = ["SELECT"]
  account_role_name = module.ALL_ROLES.ROLES.MANAGER.name
  on_schema_object {
    object_type = "TABLE"
    object_name = snowflake_table.MY_TABLE.fully_qualified_name
  }
  with_grant_option = true  # Manager can grant SELECT to others
  provider          = snowflake.snowflake_sysadmin
}
</code></pre>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Delegating privilege management</li>
<li>Allowing role administrators to manage access</li>
<li>Flexible access control</li>
</ul>
<p><strong>Security Consideration:</strong></p>
<ul>
<li>Use carefully as it allows privilege escalation</li>
<li>Typically used for administrative roles</li>
</ul>
<h2 id="fully-qualified-names-3"><a class="header" href="#fully-qualified-names-3">Fully Qualified Names</a></h2>
<p>Use <code>fully_qualified_name</code> attributes for schema and object references:</p>
<pre><code class="language-hcl"># Schema grant
on_schema {
  schema_name = snowflake_schema.ADS.fully_qualified_name
  # Results in: "TEST_DB.ADS"
}

# Table grant
on_schema_object {
  object_name = snowflake_table.FACEBOOK_ADS.fully_qualified_name
  # Results in: "TEST_DB.ADS.FACEBOOK_ADS"
}

# View grant
on_schema_object {
  object_name = snowflake_view.AGG_FACEBOOK_ADS.fully_qualified_name
  # Results in: "TEST_DB.ADS.AGG_FACEBOOK_ADS"
}
</code></pre>
<h2 id="provider-requirements-7"><a class="header" href="#provider-requirements-7">Provider Requirements</a></h2>
<p>Grants require the <code>snowflake_sysadmin</code> provider because:</p>
<ul>
<li>Granting privileges requires SYSADMIN privileges</li>
<li>Privilege management is a system administration task</li>
</ul>
<h2 id="dependencies-8"><a class="header" href="#dependencies-8">Dependencies</a></h2>
<h3 id="required-dependencies-3"><a class="header" href="#required-dependencies-3">Required Dependencies</a></h3>
<p>Grants depend on:</p>
<ul>
<li><strong>Roles</strong>: Roles must exist before granting</li>
<li><strong>Objects</strong>: Objects (databases, schemas, tables, views, warehouses) must exist before granting</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="language-hcl">resource "snowflake_grant_privileges_to_account_role" "TABLE_GRANT" {
  # ... grant configuration ...
  # Implicitly depends on:
  # - module.ALL_ROLES.ROLES.MARKETING (role must exist)
  # - snowflake_table.FACEBOOK_ADS (table must exist)
}
</code></pre>
<h2 id="privilege-hierarchy"><a class="header" href="#privilege-hierarchy">Privilege Hierarchy</a></h2>
<p>Privileges follow a hierarchy in Snowflake:</p>
<ol>
<li><strong>Database USAGE</strong> → Required to access schemas</li>
<li><strong>Schema USAGE</strong> → Required to access tables/views</li>
<li><strong>Table/View SELECT</strong> → Required to query data</li>
</ol>
<p><strong>Example:</strong></p>
<pre><code class="language-hcl"># Step 1: Grant database access
resource "snowflake_grant_privileges_to_account_role" "DB_GRANT" {
  privileges        = ["USAGE"]
  account_role_name = module.ALL_ROLES.ROLES.ANALYST.name
  on_account_object {
    object_type = "DATABASE"
    object_name = snowflake_database.TEST_DB.name
  }
  provider = snowflake.snowflake_sysadmin
}

# Step 2: Grant schema access
resource "snowflake_grant_privileges_to_account_role" "SCHEMA_GRANT" {
  privileges        = ["USAGE"]
  account_role_name = module.ALL_ROLES.ROLES.ANALYST.name
  on_schema {
    schema_name = snowflake_schema.ADS.fully_qualified_name
  }
  provider = snowflake.snowflake_sysadmin
}

# Step 3: Grant table access
resource "snowflake_grant_privileges_to_account_role" "TABLE_GRANT" {
  privileges        = ["SELECT"]
  account_role_name = module.ALL_ROLES.ROLES.ANALYST.name
  on_schema_object {
    object_type = "TABLE"
    object_name = snowflake_table.FACEBOOK_ADS.fully_qualified_name
  }
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h2 id="best-practices-11"><a class="header" href="#best-practices-11">Best Practices</a></h2>
<ol>
<li><strong>Principle of Least Privilege</strong>: Grant only necessary privileges</li>
<li><strong>Explicit Grants</strong>: Explicitly grant each required privilege</li>
<li><strong>Use USAGE First</strong>: Grant USAGE on database/schema before object privileges</li>
<li><strong>Avoid Grant Option</strong>: Use <code>with_grant_option = false</code> unless necessary</li>
<li><strong>Document Grants</strong>: Add comments explaining why grants are needed</li>
<li><strong>Role-Based</strong>: Grant to roles, not individual users</li>
<li><strong>Review Regularly</strong>: Regularly review and audit grants</li>
</ol>
<h2 id="common-patterns-1"><a class="header" href="#common-patterns-1">Common Patterns</a></h2>
<h3 id="read-only-access"><a class="header" href="#read-only-access">Read-Only Access</a></h3>
<pre><code class="language-hcl"># Grant read-only access to a role
resource "snowflake_grant_privileges_to_account_role" "READONLY_DB" {
  privileges        = ["USAGE"]
  account_role_name = module.ALL_ROLES.ROLES.READONLY.name
  on_account_object {
    object_type = "DATABASE"
    object_name = snowflake_database.MY_DB.name
  }
  provider = snowflake.snowflake_sysadmin
}

resource "snowflake_grant_privileges_to_account_role" "READONLY_SCHEMA" {
  privileges        = ["USAGE"]
  account_role_name = module.ALL_ROLES.ROLES.READONLY.name
  on_schema {
    schema_name = snowflake_schema.PUBLIC.fully_qualified_name
  }
  provider = snowflake.snowflake_sysadmin
}

resource "snowflake_grant_privileges_to_account_role" "READONLY_TABLE" {
  privileges        = ["SELECT"]
  account_role_name = module.ALL_ROLES.ROLES.READONLY.name
  on_schema_object {
    object_type = "TABLE"
    object_name = snowflake_table.MY_TABLE.fully_qualified_name
  }
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="full-access"><a class="header" href="#full-access">Full Access</a></h3>
<pre><code class="language-hcl"># Grant full access to a role
resource "snowflake_grant_privileges_to_account_role" "FULL_ACCESS" {
  privileges        = ["ALL PRIVILEGES"]
  account_role_name = module.ALL_ROLES.ROLES.ADMIN.name
  on_schema_object {
    object_type = "TABLE"
    object_name = snowflake_table.MY_TABLE.fully_qualified_name
  }
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h2 id="troubleshooting-10"><a class="header" href="#troubleshooting-10">Troubleshooting</a></h2>
<h3 id="role-not-found-1"><a class="header" href="#role-not-found-1">Role Not Found</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: Role does not exist
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Ensure roles are created before granting</li>
<li>Verify role name is correct</li>
<li>Check that role exists in Snowflake</li>
</ul>
<h3 id="object-not-found"><a class="header" href="#object-not-found">Object Not Found</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: Object does not exist
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Ensure objects are created before granting</li>
<li>Verify object names are correct</li>
<li>Check that objects exist in Snowflake</li>
</ul>
<h3 id="insufficient-privileges-8"><a class="header" href="#insufficient-privileges-8">Insufficient Privileges</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: 001003 (42000): SQL access control error: Insufficient privileges
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Ensure provider uses SYSADMIN role</li>
<li>Verify user can assume SYSADMIN role</li>
<li>Check that user has necessary privileges to grant</li>
</ul>
<h3 id="missing-usage-privilege"><a class="header" href="#missing-usage-privilege">Missing USAGE Privilege</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: Cannot access object - missing USAGE privilege
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Grant USAGE on database first</li>
<li>Grant USAGE on schema before table/view privileges</li>
<li>Follow privilege hierarchy</li>
</ul>
<h2 id="related-documentation-7"><a class="header" href="#related-documentation-7">Related Documentation</a></h2>
<ul>
<li><a href="resources/../modules/roles-module.html">Roles Module</a> - Creates roles that receive grants</li>
<li><a href="resources/databases.html">Databases</a> - Objects that can be granted</li>
<li><a href="resources/schemas.html">Schemas</a> - Objects that can be granted</li>
<li><a href="resources/tables.html">Tables</a> - Objects that can be granted</li>
<li><a href="resources/views.html">Views</a> - Objects that can be granted</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="basic-usage-1"><a class="header" href="#basic-usage-1">Basic Usage</a></h1>
<p>This guide provides practical examples of common operations with the Terraform Snowflake infrastructure.</p>
<h2 id="common-workflows"><a class="header" href="#common-workflows">Common Workflows</a></h2>
<h3 id="1-adding-a-new-role"><a class="header" href="#1-adding-a-new-role">1. Adding a New Role</a></h3>
<p>To add a new role to your infrastructure:</p>
<ol>
<li><strong>Edit <code>main.tf</code></strong> and add the role to the <code>role_map</code>:</li>
</ol>
<pre><code class="language-hcl">module "ALL_ROLES" {
  source = "./modules/snowflake/roles"
  
  providers = {
    snowflake = snowflake.snowflake_securityadmin
  }
  
  role_map = {
    # ... existing roles ...
    "NEW_ROLE" = {
      parent_role_name = "SYSADMIN"
      comment          = "Description of the new role"
    }
  }
}
</code></pre>
<ol start="2">
<li><strong>Plan the changes</strong>:</li>
</ol>
<pre><code class="language-bash">terraform plan
</code></pre>
<ol start="3">
<li><strong>Apply the changes</strong>:</li>
</ol>
<pre><code class="language-bash">terraform apply
</code></pre>
<h3 id="2-adding-a-new-user"><a class="header" href="#2-adding-a-new-user">2. Adding a New User</a></h3>
<p>To add a new user:</p>
<ol>
<li><strong>Edit <code>main.tf</code></strong> and add the user to the <code>user_map</code>:</li>
</ol>
<pre><code class="language-hcl">module "ALL_USERS" {
  source = "./modules/snowflake/users"
  
  providers = {
    snowflake = snowflake.snowflake_securityadmin
  }
  
  user_map = {
    # ... existing users ...
    "NEW_USER" = {
      first_name  = "New"
      last_name   = "User"
      email       = "new.user@example.com"
      user_type   = "person"
      roles_to_assign = [module.ALL_ROLES.ROLES.NEW_ROLE.name]
    }
  }
}
</code></pre>
<ol start="2">
<li><strong>Plan and apply</strong>:</li>
</ol>
<pre><code class="language-bash">terraform plan
terraform apply
</code></pre>
<h3 id="3-adding-a-new-warehouse"><a class="header" href="#3-adding-a-new-warehouse">3. Adding a New Warehouse</a></h3>
<p>To add a new warehouse:</p>
<ol>
<li><strong>Edit <code>main.tf</code></strong> and add the warehouse to the <code>warehouse_map</code>:</li>
</ol>
<pre><code class="language-hcl">module "ALL_WAREHOUSES" {
  source = "./modules/snowflake/warehouse"
  
  providers = {
    snowflake = snowflake.snowflake_sysadmin
  }
  
  warehouse_map = {
    # ... existing warehouses ...
    "NEW_WAREHOUSE" = {
      warehouse_type = "STANDARD"
      warehouse_generation = "2"
      warehouse_size = "SMALL"
      role_privileges = [
        {
          account_role_name = module.ALL_ROLES.ROLES.NEW_ROLE.name
          privileges        = ["USAGE"]
        }
      ]
    }
  }
}
</code></pre>
<ol start="2">
<li><strong>Plan and apply</strong>:</li>
</ol>
<pre><code class="language-bash">terraform plan
terraform apply
</code></pre>
<h3 id="4-adding-a-new-database"><a class="header" href="#4-adding-a-new-database">4. Adding a New Database</a></h3>
<p>To add a new database:</p>
<ol>
<li><strong>Edit <code>main.tf</code></strong> and add the database resource:</li>
</ol>
<pre><code class="language-hcl">resource "snowflake_database" "NEW_DB" {
  name                        = "NEW_DB"
  comment                     = "New database"
  data_retention_time_in_days = 1
  provider                    = snowflake.snowflake_sysadmin
}
</code></pre>
<ol start="2">
<li><strong>Plan and apply</strong>:</li>
</ol>
<pre><code class="language-bash">terraform plan
terraform apply
</code></pre>
<h3 id="5-adding-a-new-table"><a class="header" href="#5-adding-a-new-table">5. Adding a New Table</a></h3>
<p>To add a new table:</p>
<ol>
<li><strong>Edit <code>main.tf</code></strong> and add the table resource:</li>
</ol>
<pre><code class="language-hcl">resource "snowflake_table" "NEW_TABLE" {
  database = snowflake_database.NEW_DB.name
  schema   = snowflake_schema.PUBLIC.name
  name     = "NEW_TABLE"
  comment  = "New table"
  
  column {
    name     = "ID"
    type     = "NUMBER(38,0)"
    nullable = false
  }
  
  column {
    name = "NAME"
    type = "VARCHAR(255)"
  }
  
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<ol start="2">
<li><strong>Plan and apply</strong>:</li>
</ol>
<pre><code class="language-bash">terraform plan
terraform apply
</code></pre>
<h3 id="6-granting-access-to-a-role"><a class="header" href="#6-granting-access-to-a-role">6. Granting Access to a Role</a></h3>
<p>To grant access to a role:</p>
<ol>
<li><strong>Edit <code>main.tf</code></strong> and add grant resources:</li>
</ol>
<pre><code class="language-hcl"># Grant database access
resource "snowflake_grant_privileges_to_account_role" "ROLE_DB_GRANT" {
  privileges        = ["USAGE"]
  account_role_name = module.ALL_ROLES.ROLES.NEW_ROLE.name
  on_account_object {
    object_type = "DATABASE"
    object_name = snowflake_database.NEW_DB.name
  }
  provider = snowflake.snowflake_sysadmin
}

# Grant schema access
resource "snowflake_grant_privileges_to_account_role" "ROLE_SCHEMA_GRANT" {
  privileges        = ["USAGE"]
  account_role_name = module.ALL_ROLES.ROLES.NEW_ROLE.name
  on_schema {
    schema_name = snowflake_schema.PUBLIC.fully_qualified_name
  }
  provider = snowflake.snowflake_sysadmin
}

# Grant table access
resource "snowflake_grant_privileges_to_account_role" "ROLE_TABLE_GRANT" {
  privileges        = ["SELECT"]
  account_role_name = module.ALL_ROLES.ROLES.NEW_ROLE.name
  on_schema_object {
    object_type = "TABLE"
    object_name = snowflake_table.NEW_TABLE.fully_qualified_name
  }
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<ol start="2">
<li><strong>Plan and apply</strong>:</li>
</ol>
<pre><code class="language-bash">terraform plan
terraform apply
</code></pre>
<h2 id="terraform-commands"><a class="header" href="#terraform-commands">Terraform Commands</a></h2>
<h3 id="initialize"><a class="header" href="#initialize">Initialize</a></h3>
<pre><code class="language-bash">terraform init
</code></pre>
<p>Initializes Terraform and downloads providers. Run this:</p>
<ul>
<li>First time setting up the project</li>
<li>After adding new providers</li>
<li>After updating provider versions</li>
</ul>
<h3 id="validate"><a class="header" href="#validate">Validate</a></h3>
<pre><code class="language-bash">terraform validate
</code></pre>
<p>Validates the Terraform configuration syntax. Run this:</p>
<ul>
<li>Before planning or applying</li>
<li>After making configuration changes</li>
<li>In CI/CD pipelines</li>
</ul>
<h3 id="format"><a class="header" href="#format">Format</a></h3>
<pre><code class="language-bash">terraform fmt
</code></pre>
<p>Formats Terraform files to standard style. Run this:</p>
<ul>
<li>Before committing changes</li>
<li>To ensure consistent formatting</li>
</ul>
<h3 id="plan"><a class="header" href="#plan">Plan</a></h3>
<pre><code class="language-bash">terraform plan
</code></pre>
<p>Shows what changes Terraform will make. Always review before applying.</p>
<h3 id="apply"><a class="header" href="#apply">Apply</a></h3>
<pre><code class="language-bash">terraform apply
</code></pre>
<p>Applies the configuration and creates/updates resources.</p>
<h3 id="destroy"><a class="header" href="#destroy">Destroy</a></h3>
<pre><code class="language-bash">terraform destroy
</code></pre>
<p><strong>Warning:</strong> Destroys all resources managed by Terraform. Use with caution!</p>
<h3 id="state-management-2"><a class="header" href="#state-management-2">State Management</a></h3>
<pre><code class="language-bash"># List all resources in state
terraform state list

# Show details of a resource
terraform state show module.ALL_ROLES.snowflake_account_role.ROLES["ANALYST"]

# Remove a resource from state (doesn't delete from Snowflake)
terraform state rm module.ALL_ROLES.snowflake_account_role.ROLES["ANALYST"]

# Import an existing resource
terraform import snowflake_database.MY_DB "MY_DB"
</code></pre>
<h2 id="working-with-modules"><a class="header" href="#working-with-modules">Working with Modules</a></h2>
<h3 id="viewing-module-outputs"><a class="header" href="#viewing-module-outputs">Viewing Module Outputs</a></h3>
<p>Module outputs are available for reference in other resources:</p>
<pre><code class="language-hcl"># Reference a role from the roles module
roles_to_assign = [module.ALL_ROLES.ROLES.ANALYST.name]

# Reference a warehouse from the warehouse module
default_warehouse = module.ALL_WAREHOUSES.WAREHOUSES.MY_WH.name
</code></pre>
<h3 id="viewing-all-outputs"><a class="header" href="#viewing-all-outputs">Viewing All Outputs</a></h3>
<pre><code class="language-bash">terraform output
</code></pre>
<p>View specific output:</p>
<pre><code class="language-bash">terraform output ALL_ROLES
</code></pre>
<h2 id="common-patterns-2"><a class="header" href="#common-patterns-2">Common Patterns</a></h2>
<h3 id="pattern-1-complete-user-setup"><a class="header" href="#pattern-1-complete-user-setup">Pattern 1: Complete User Setup</a></h3>
<p>Create a user with role, warehouse, and database access:</p>
<pre><code class="language-hcl"># 1. Role (in role_map)
"ANALYST" = {
  parent_role_name = "SYSADMIN"
  comment          = "Analyst role"
}

# 2. Warehouse (in warehouse_map)
"ANALYST_WH" = {
  warehouse_type = "STANDARD"
  warehouse_generation = "2"
  warehouse_size = "SMALL"
  role_privileges = [
    {
      account_role_name = module.ALL_ROLES.ROLES.ANALYST.name
      privileges        = ["USAGE"]
    }
  ]
}

# 3. User (in user_map)
"ANALYST_USER" = {
  first_name       = "Analyst"
  last_name        = "User"
  email            = "analyst@example.com"
  user_type        = "person"
  default_warehouse = module.ALL_WAREHOUSES.WAREHOUSES.ANALYST_WH.name
  default_role     = module.ALL_ROLES.ROLES.ANALYST.name
  roles_to_assign  = [module.ALL_ROLES.ROLES.ANALYST.name]
}

# 4. Database grant
resource "snowflake_grant_privileges_to_account_role" "ANALYST_DB_GRANT" {
  privileges        = ["USAGE"]
  account_role_name = module.ALL_ROLES.ROLES.ANALYST.name
  on_account_object {
    object_type = "DATABASE"
    object_name = snowflake_database.MY_DB.name
  }
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="pattern-2-read-only-access"><a class="header" href="#pattern-2-read-only-access">Pattern 2: Read-Only Access</a></h3>
<p>Grant read-only access to a role:</p>
<pre><code class="language-hcl"># Database USAGE
resource "snowflake_grant_privileges_to_account_role" "READONLY_DB" {
  privileges        = ["USAGE"]
  account_role_name = module.ALL_ROLES.ROLES.READONLY.name
  on_account_object {
    object_type = "DATABASE"
    object_name = snowflake_database.MY_DB.name
  }
  provider = snowflake.snowflake_sysadmin
}

# Schema USAGE
resource "snowflake_grant_privileges_to_account_role" "READONLY_SCHEMA" {
  privileges        = ["USAGE"]
  account_role_name = module.ALL_ROLES.ROLES.READONLY.name
  on_schema {
    schema_name = snowflake_schema.PUBLIC.fully_qualified_name
  }
  provider = snowflake.snowflake_sysadmin
}

# Table SELECT (read-only)
resource "snowflake_grant_privileges_to_account_role" "READONLY_TABLE" {
  privileges        = ["SELECT"]
  account_role_name = module.ALL_ROLES.ROLES.READONLY.name
  on_schema_object {
    object_type = "TABLE"
    object_name = snowflake_table.MY_TABLE.fully_qualified_name
  }
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h2 id="troubleshooting-common-issues"><a class="header" href="#troubleshooting-common-issues">Troubleshooting Common Issues</a></h2>
<h3 id="issue-resource-already-exists-1"><a class="header" href="#issue-resource-already-exists-1">Issue: Resource Already Exists</a></h3>
<p><strong>Solution:</strong> Import the existing resource:</p>
<pre><code class="language-bash">terraform import snowflake_database.MY_DB "MY_DB"
</code></pre>
<h3 id="issue-dependency-error"><a class="header" href="#issue-dependency-error">Issue: Dependency Error</a></h3>
<p><strong>Solution:</strong> Ensure resources are created in the correct order. Use <code>depends_on</code> if needed:</p>
<pre><code class="language-hcl">resource "snowflake_view" "MY_VIEW" {
  # ... configuration ...
  depends_on = [snowflake_table.MY_TABLE]
}
</code></pre>
<h3 id="issue-invalid-reference"><a class="header" href="#issue-invalid-reference">Issue: Invalid Reference</a></h3>
<p><strong>Solution:</strong> Verify module outputs are referenced correctly:</p>
<pre><code class="language-hcl"># Correct
roles_to_assign = [module.ALL_ROLES.ROLES.ANALYST.name]

# Incorrect
roles_to_assign = [module.ALL_ROLES.ANALYST]  # Missing .ROLES and .name
</code></pre>
<h2 id="next-steps-7"><a class="header" href="#next-steps-7">Next Steps</a></h2>
<ul>
<li>Learn about <a href="usage/customizing-configuration.html">Customizing Configuration</a></li>
<li>Review <a href="usage/best-practices.html">Best Practices</a></li>
<li>See <a href="usage/adding-new-resources.html">Adding New Resources</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="customizing-configuration"><a class="header" href="#customizing-configuration">Customizing Configuration</a></h1>
<p>This guide explains how to customize the Terraform configuration for your specific needs.</p>
<h2 id="environment-specific-configuration-1"><a class="header" href="#environment-specific-configuration-1">Environment-Specific Configuration</a></h2>
<h3 id="using-separate-tfvars-files"><a class="header" href="#using-separate-tfvars-files">Using Separate .tfvars Files</a></h3>
<p>Create separate variable files for different environments:</p>
<pre><code class="language-bash"># Development
terraform.tfvars.dev

# Staging
terraform.tfvars.staging

# Production
terraform.tfvars.prod
</code></pre>
<p>Apply with:</p>
<pre><code class="language-bash">terraform apply -var-file="terraform.tfvars.dev"
</code></pre>
<h3 id="example-environment-files"><a class="header" href="#example-environment-files">Example Environment Files</a></h3>
<p><strong>terraform.tfvars.dev:</strong></p>
<pre><code class="language-hcl">snowflake_organization = "DEV_ORG"
snowflake_account      = "DEV_ACCOUNT"
snowflake_username     = "terraform_dev"
snowflake_password     = "dev_password"
snowflake_role         = "ACCOUNTADMIN"
snowflake_warehouse    = "DEV_WH"
</code></pre>
<p><strong>terraform.tfvars.prod:</strong></p>
<pre><code class="language-hcl">snowflake_organization = "PROD_ORG"
snowflake_account      = "PROD_ACCOUNT"
snowflake_username     = "terraform_prod"
snowflake_password     = "prod_password"
snowflake_role         = "ACCOUNTADMIN"
snowflake_warehouse    = "PROD_WH"
</code></pre>
<h2 id="customizing-roles"><a class="header" href="#customizing-roles">Customizing Roles</a></h2>
<h3 id="adding-custom-roles"><a class="header" href="#adding-custom-roles">Adding Custom Roles</a></h3>
<p>Edit the <code>role_map</code> in <code>main.tf</code>:</p>
<pre><code class="language-hcl">module "ALL_ROLES" {
  source = "./modules/snowflake/roles"
  
  providers = {
    snowflake = snowflake.snowflake_securityadmin
  }
  
  role_map = {
    # Add your custom roles
    "CUSTOM_ROLE" = {
      parent_role_name = "SYSADMIN"
      comment          = "Custom role for specific use case"
    },
    "ANOTHER_ROLE" = {
      parent_role_name = "CUSTOM_ROLE"
      comment          = "Role that inherits from CUSTOM_ROLE"
    }
  }
}
</code></pre>
<h3 id="role-hierarchy-examples"><a class="header" href="#role-hierarchy-examples">Role Hierarchy Examples</a></h3>
<p><strong>Flat Hierarchy:</strong></p>
<pre><code class="language-hcl">role_map = {
  "ROLE1" = { parent_role_name = "SYSADMIN", comment = "Role 1" },
  "ROLE2" = { parent_role_name = "SYSADMIN", comment = "Role 2" },
  "ROLE3" = { parent_role_name = "SYSADMIN", comment = "Role 3" }
}
</code></pre>
<p><strong>Nested Hierarchy:</strong></p>
<pre><code class="language-hcl">role_map = {
  "PARENT" = { comment = "Parent role" },
  "CHILD1" = { parent_role_name = "PARENT", comment = "Child 1" },
  "CHILD2" = { parent_role_name = "PARENT", comment = "Child 2" },
  "GRANDCHILD" = { parent_role_name = "CHILD1", comment = "Grandchild" }
}
</code></pre>
<h2 id="customizing-users"><a class="header" href="#customizing-users">Customizing Users</a></h2>
<h3 id="user-configuration-options"><a class="header" href="#user-configuration-options">User Configuration Options</a></h3>
<pre><code class="language-hcl">module "ALL_USERS" {
  source = "./modules/snowflake/users"
  
  providers = {
    snowflake = snowflake.snowflake_securityadmin
  }
  
  user_map = {
    "CUSTOM_USER" = {
      # Required
      first_name  = "Custom"
      last_name   = "User"
      user_type   = "person"  # or "service" or "legacy_service"
      
      # Optional
      email                          = "custom.user@example.com"
      comment                        = "Custom user description"
      disabled                       = "false"
      default_warehouse              = module.ALL_WAREHOUSES.WAREHOUSES.MY_WH.name
      default_role                   = module.ALL_ROLES.ROLES.MY_ROLE.name
      default_secondary_roles_option = "NONE"
      must_change_password           = "true"
      disable_mfa                    = "false"
      roles_to_assign                = [
        module.ALL_ROLES.ROLES.MY_ROLE.name,
        module.ALL_ROLES.ROLES.ANOTHER_ROLE.name
      ]
    }
  }
}
</code></pre>
<h3 id="service-user-configuration"><a class="header" href="#service-user-configuration">Service User Configuration</a></h3>
<pre><code class="language-hcl">user_map = {
  "SERVICE_ACCOUNT" = {
    first_name  = "Service"
    last_name   = "Account"
    user_type   = "service"
    comment     = "Service account for application"
    roles_to_assign = [
      module.ALL_ROLES.ROLES.DATA_ENGINEER.name
    ]
  }
}
</code></pre>
<h2 id="customizing-warehouses"><a class="header" href="#customizing-warehouses">Customizing Warehouses</a></h2>
<h3 id="warehouse-configuration-options"><a class="header" href="#warehouse-configuration-options">Warehouse Configuration Options</a></h3>
<pre><code class="language-hcl">module "ALL_WAREHOUSES" {
  source = "./modules/snowflake/warehouse"
  
  providers = {
    snowflake = snowflake.snowflake_sysadmin
  }
  
  warehouse_map = {
    "CUSTOM_WH" = {
      # Required
      warehouse_type       = "STANDARD"  # or "SNOWPARK-OPTIMIZED"
      warehouse_generation = "2"         # or "1"
      
      # Optional sizing
      warehouse_size               = "MEDIUM"  # XSMALL, SMALL, MEDIUM, LARGE, etc.
      warehouse_max_cluster_count = 3
      warehouse_min_cluster_count  = 1
      
      # Optional scaling
      warehouse_scaling_policy = "STANDARD"  # or "ECONOMY"
      
      # Optional auto-suspend/resume
      warehouse_auto_suspend        = 300
      warehouse_auto_resume          = true
      warehouse_initially_suspended  = true
      
      # Optional performance
      warehouse_max_concurrency_level        = 16
      warehouse_statement_timeout_in_seconds = 3600
      
      # Optional metadata
      warehouse_comment = "Custom warehouse description"
      
      # Required: role privileges
      role_privileges = [
        {
          account_role_name = module.ALL_ROLES.ROLES.MY_ROLE.name
          privileges        = ["USAGE", "OPERATE"]
        }
      ]
      with_grant_option = false
    }
  }
}
</code></pre>
<h3 id="cost-optimized-warehouse"><a class="header" href="#cost-optimized-warehouse">Cost-Optimized Warehouse</a></h3>
<pre><code class="language-hcl">warehouse_map = {
  "COST_OPTIMIZED_WH" = {
    warehouse_type                = "STANDARD"
    warehouse_generation          = "2"
    warehouse_size                = "XSMALL"
    warehouse_scaling_policy      = "ECONOMY"
    warehouse_auto_suspend        = 60
    warehouse_auto_resume         = true
    warehouse_initially_suspended = true
    role_privileges = [
      {
        account_role_name = module.ALL_ROLES.ROLES.DEVELOPER.name
        privileges        = ["USAGE"]
      }
    ]
  }
}
</code></pre>
<h3 id="high-performance-warehouse"><a class="header" href="#high-performance-warehouse">High-Performance Warehouse</a></h3>
<pre><code class="language-hcl">warehouse_map = {
  "HIGH_PERF_WH" = {
    warehouse_type                = "STANDARD"
    warehouse_generation          = "2"
    warehouse_size                = "LARGE"
    warehouse_max_cluster_count   = 5
    warehouse_min_cluster_count   = 2
    warehouse_scaling_policy      = "STANDARD"
    warehouse_auto_suspend        = 600
    warehouse_auto_resume         = true
    warehouse_initially_suspended = false
    warehouse_max_concurrency_level = 32
    warehouse_statement_timeout_in_seconds = 7200
    role_privileges = [
      {
        account_role_name = module.ALL_ROLES.ROLES.DATA_ENGINEER.name
        privileges        = ["USAGE", "OPERATE", "MONITOR"]
      }
    ]
  }
}
</code></pre>
<h2 id="customizing-databases"><a class="header" href="#customizing-databases">Customizing Databases</a></h2>
<h3 id="database-with-custom-retention-1"><a class="header" href="#database-with-custom-retention-1">Database with Custom Retention</a></h3>
<pre><code class="language-hcl">resource "snowflake_database" "CUSTOM_DB" {
  name                        = "CUSTOM_DB"
  comment                     = "Custom database with 30-day retention"
  data_retention_time_in_days = 30
  provider                    = snowflake.snowflake_sysadmin
}
</code></pre>
<h2 id="customizing-schemas"><a class="header" href="#customizing-schemas">Customizing Schemas</a></h2>
<h3 id="schema-with-managed-access-1"><a class="header" href="#schema-with-managed-access-1">Schema with Managed Access</a></h3>
<pre><code class="language-hcl">resource "snowflake_schema" "SECURE_SCHEMA" {
  name                = "SECURE_SCHEMA"
  database            = snowflake_database.CUSTOM_DB.name
  with_managed_access = true
  comment             = "Schema with managed access for security"
  provider            = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="transient-schema-1"><a class="header" href="#transient-schema-1">Transient Schema</a></h3>
<pre><code class="language-hcl">resource "snowflake_schema" "TEMP_SCHEMA" {
  name         = "TEMP_SCHEMA"
  database     = snowflake_database.CUSTOM_DB.name
  is_transient = true
  comment      = "Temporary schema without Time Travel"
  provider     = snowflake.snowflake_sysadmin
}
</code></pre>
<h2 id="customizing-tables"><a class="header" href="#customizing-tables">Customizing Tables</a></h2>
<h3 id="table-with-multiple-columns"><a class="header" href="#table-with-multiple-columns">Table with Multiple Columns</a></h3>
<pre><code class="language-hcl">resource "snowflake_table" "CUSTOM_TABLE" {
  database = snowflake_database.CUSTOM_DB.name
  schema   = snowflake_schema.PUBLIC.name
  name     = "CUSTOM_TABLE"
  comment  = "Custom table with various column types"
  
  column {
    name     = "ID"
    type     = "NUMBER(38,0)"
    nullable = false
    comment  = "Primary key"
  }
  
  column {
    name     = "NAME"
    type     = "VARCHAR(255)"
    nullable = false
  }
  
  column {
    name     = "CREATED_AT"
    type     = "TIMESTAMP_NTZ(9)"
    nullable = false
    default  = "CURRENT_TIMESTAMP()"
  }
  
  column {
    name     = "AMOUNT"
    type     = "NUMBER(10,2)"
    nullable = true
  }
  
  column {
    name     = "METADATA"
    type     = "VARIANT"
    nullable = true
    comment  = "Additional metadata in JSON format"
  }
  
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h2 id="using-variables-for-customization"><a class="header" href="#using-variables-for-customization">Using Variables for Customization</a></h2>
<h3 id="define-variables"><a class="header" href="#define-variables">Define Variables</a></h3>
<p>In <code>variables.tf</code>:</p>
<pre><code class="language-hcl">variable "environment" {
  type        = string
  description = "Environment name (dev, staging, prod)"
  default     = "dev"
}

variable "warehouse_size" {
  type        = string
  description = "Default warehouse size"
  default     = "SMALL"
}
</code></pre>
<h3 id="use-variables-in-configuration"><a class="header" href="#use-variables-in-configuration">Use Variables in Configuration</a></h3>
<p>In <code>main.tf</code>:</p>
<pre><code class="language-hcl">module "ALL_WAREHOUSES" {
  source = "./modules/snowflake/warehouse"
  
  warehouse_map = {
    "MY_WH" = {
      warehouse_type       = "STANDARD"
      warehouse_generation = "2"
      warehouse_size       = var.warehouse_size  # Use variable
      # ... other configuration
    }
  }
}
</code></pre>
<h3 id="set-variables"><a class="header" href="#set-variables">Set Variables</a></h3>
<p>In <code>terraform.tfvars</code>:</p>
<pre><code class="language-hcl">environment    = "production"
warehouse_size = "LARGE"
</code></pre>
<p>Or via command line:</p>
<pre><code class="language-bash">terraform apply -var="environment=production" -var="warehouse_size=LARGE"
</code></pre>
<h2 id="conditional-configuration"><a class="header" href="#conditional-configuration">Conditional Configuration</a></h2>
<h3 id="using-count"><a class="header" href="#using-count">Using Count</a></h3>
<pre><code class="language-hcl">resource "snowflake_database" "DEV_DB" {
  count   = var.environment == "dev" ? 1 : 0
  name    = "DEV_DB"
  comment = "Development database"
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="using-for_each-with-conditions"><a class="header" href="#using-for_each-with-conditions">Using for_each with Conditions</a></h3>
<pre><code class="language-hcl">locals {
  environments = {
    dev  = { warehouse_size = "XSMALL" }
    prod = { warehouse_size = "LARGE" }
  }
}

module "ALL_WAREHOUSES" {
  source = "./modules/snowflake/warehouse"
  
  warehouse_map = {
    for env, config in local.environments : "WH_${env}" =&gt; {
      warehouse_type       = "STANDARD"
      warehouse_generation = "2"
      warehouse_size       = config.warehouse_size
      # ... other configuration
    }
  }
}
</code></pre>
<h2 id="best-practices-for-customization"><a class="header" href="#best-practices-for-customization">Best Practices for Customization</a></h2>
<ol>
<li><strong>Use Variables</strong>: Don’t hardcode values, use variables</li>
<li><strong>Environment Files</strong>: Use separate <code>.tfvars</code> files for environments</li>
<li><strong>Comments</strong>: Document why customizations are made</li>
<li><strong>Version Control</strong>: Commit all <code>.tf</code> files, never commit <code>.tfvars</code></li>
<li><strong>Consistent Naming</strong>: Follow consistent naming conventions</li>
<li><strong>Review Changes</strong>: Always review <code>terraform plan</code> before applying</li>
</ol>
<h2 id="next-steps-8"><a class="header" href="#next-steps-8">Next Steps</a></h2>
<ul>
<li>Learn about <a href="usage/adding-new-resources.html">Adding New Resources</a></li>
<li>Review <a href="usage/best-practices.html">Best Practices</a></li>
<li>See <a href="usage/basic-usage.html">Basic Usage</a> for common operations</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="adding-new-resources-1"><a class="header" href="#adding-new-resources-1">Adding New Resources</a></h1>
<p>This guide explains how to add new resources to your Terraform configuration.</p>
<h2 id="adding-resources-step-by-step"><a class="header" href="#adding-resources-step-by-step">Adding Resources Step by Step</a></h2>
<h3 id="step-1-plan-your-resource"><a class="header" href="#step-1-plan-your-resource">Step 1: Plan Your Resource</a></h3>
<p>Before adding a resource, consider:</p>
<ul>
<li>What type of resource is it? (database, schema, table, view, etc.)</li>
<li>What are its dependencies?</li>
<li>What provider does it need?</li>
<li>What privileges need to be granted?</li>
</ul>
<h3 id="step-2-add-the-resource-definition"><a class="header" href="#step-2-add-the-resource-definition">Step 2: Add the Resource Definition</a></h3>
<p>Add the resource to <code>main.tf</code> following existing patterns.</p>
<h3 id="step-3-plan-and-validate"><a class="header" href="#step-3-plan-and-validate">Step 3: Plan and Validate</a></h3>
<pre><code class="language-bash">terraform validate
terraform plan
</code></pre>
<h3 id="step-4-apply"><a class="header" href="#step-4-apply">Step 4: Apply</a></h3>
<pre><code class="language-bash">terraform apply
</code></pre>
<h2 id="adding-a-new-database"><a class="header" href="#adding-a-new-database">Adding a New Database</a></h2>
<h3 id="example"><a class="header" href="#example">Example</a></h3>
<pre><code class="language-hcl">resource "snowflake_database" "NEW_DATABASE" {
  name                        = "NEW_DATABASE"
  comment                     = "Description of the database"
  data_retention_time_in_days = 1
  provider                    = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="considerations"><a class="header" href="#considerations">Considerations</a></h3>
<ul>
<li>Database names must be unique</li>
<li>Choose appropriate retention period</li>
<li>Consider granting USAGE to roles</li>
</ul>
<h2 id="adding-a-new-schema"><a class="header" href="#adding-a-new-schema">Adding a New Schema</a></h2>
<h3 id="example-1"><a class="header" href="#example-1">Example</a></h3>
<pre><code class="language-hcl">resource "snowflake_schema" "NEW_SCHEMA" {
  name     = "NEW_SCHEMA"
  database = snowflake_database.NEW_DATABASE.name
  comment  = "Description of the schema"
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="considerations-1"><a class="header" href="#considerations-1">Considerations</a></h3>
<ul>
<li>Schema must reference an existing database</li>
<li>Consider <code>with_managed_access</code> for security</li>
<li>Consider <code>is_transient</code> for temporary data</li>
</ul>
<h2 id="adding-a-new-table"><a class="header" href="#adding-a-new-table">Adding a New Table</a></h2>
<h3 id="example-2"><a class="header" href="#example-2">Example</a></h3>
<pre><code class="language-hcl">resource "snowflake_table" "NEW_TABLE" {
  database = snowflake_database.NEW_DATABASE.name
  schema   = snowflake_schema.NEW_SCHEMA.name
  name     = "NEW_TABLE"
  comment  = "Description of the table"
  
  column {
    name     = "ID"
    type     = "NUMBER(38,0)"
    nullable = false
  }
  
  column {
    name = "NAME"
    type = "VARCHAR(255)"
  }
  
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="considerations-2"><a class="header" href="#considerations-2">Considerations</a></h3>
<ul>
<li>Table must reference existing database and schema</li>
<li>Choose appropriate data types</li>
<li>Consider nullable constraints</li>
<li>Add comments for documentation</li>
</ul>
<h2 id="adding-a-new-view"><a class="header" href="#adding-a-new-view">Adding a New View</a></h2>
<h3 id="example-3"><a class="header" href="#example-3">Example</a></h3>
<pre><code class="language-hcl">resource "snowflake_view" "NEW_VIEW" {
  database  = snowflake_database.NEW_DATABASE.name
  schema    = snowflake_schema.NEW_SCHEMA.name
  name      = "NEW_VIEW"
  statement = &lt;&lt;-SQL
    SELECT 
      ID,
      NAME
    FROM NEW_TABLE
    WHERE ACTIVE = TRUE;
  SQL
  comment   = "Description of the view"
  depends_on = [snowflake_table.NEW_TABLE]
  
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="considerations-3"><a class="header" href="#considerations-3">Considerations</a></h3>
<ul>
<li>View must reference existing database and schema</li>
<li>SQL statement must be valid</li>
<li>Add <code>depends_on</code> for referenced tables</li>
<li>Consider <code>is_secure</code> for sensitive queries</li>
</ul>
<h2 id="adding-grants"><a class="header" href="#adding-grants">Adding Grants</a></h2>
<h3 id="database-grant"><a class="header" href="#database-grant">Database Grant</a></h3>
<pre><code class="language-hcl">resource "snowflake_grant_privileges_to_account_role" "DB_GRANT" {
  privileges        = ["USAGE"]
  account_role_name = module.ALL_ROLES.ROLES.ROLE_NAME.name
  on_account_object {
    object_type = "DATABASE"
    object_name = snowflake_database.NEW_DATABASE.name
  }
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="schema-grant"><a class="header" href="#schema-grant">Schema Grant</a></h3>
<pre><code class="language-hcl">resource "snowflake_grant_privileges_to_account_role" "SCHEMA_GRANT" {
  privileges        = ["USAGE"]
  account_role_name = module.ALL_ROLES.ROLES.ROLE_NAME.name
  on_schema {
    schema_name = snowflake_schema.NEW_SCHEMA.fully_qualified_name
  }
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="table-grant"><a class="header" href="#table-grant">Table Grant</a></h3>
<pre><code class="language-hcl">resource "snowflake_grant_privileges_to_account_role" "TABLE_GRANT" {
  privileges        = ["SELECT"]
  account_role_name = module.ALL_ROLES.ROLES.ROLE_NAME.name
  on_schema_object {
    object_type = "TABLE"
    object_name = snowflake_table.NEW_TABLE.fully_qualified_name
  }
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h2 id="adding-resources-to-modules"><a class="header" href="#adding-resources-to-modules">Adding Resources to Modules</a></h2>
<h3 id="adding-a-role"><a class="header" href="#adding-a-role">Adding a Role</a></h3>
<p>Edit the <code>role_map</code> in the <code>ALL_ROLES</code> module:</p>
<pre><code class="language-hcl">module "ALL_ROLES" {
  # ... existing configuration ...
  
  role_map = {
    # ... existing roles ...
    "NEW_ROLE" = {
      parent_role_name = "SYSADMIN"
      comment          = "New role description"
    }
  }
}
</code></pre>
<h3 id="adding-a-user"><a class="header" href="#adding-a-user">Adding a User</a></h3>
<p>Edit the <code>user_map</code> in the <code>ALL_USERS</code> module:</p>
<pre><code class="language-hcl">module "ALL_USERS" {
  # ... existing configuration ...
  
  user_map = {
    # ... existing users ...
    "NEW_USER" = {
      first_name  = "New"
      last_name   = "User"
      email       = "new.user@example.com"
      user_type   = "person"
      roles_to_assign = [module.ALL_ROLES.ROLES.NEW_ROLE.name]
    }
  }
}
</code></pre>
<h3 id="adding-a-warehouse"><a class="header" href="#adding-a-warehouse">Adding a Warehouse</a></h3>
<p>Edit the <code>warehouse_map</code> in the <code>ALL_WAREHOUSES</code> module:</p>
<pre><code class="language-hcl">module "ALL_WAREHOUSES" {
  # ... existing configuration ...
  
  warehouse_map = {
    # ... existing warehouses ...
    "NEW_WAREHOUSE" = {
      warehouse_type       = "STANDARD"
      warehouse_generation = "2"
      warehouse_size       = "SMALL"
      role_privileges = [
        {
          account_role_name = module.ALL_ROLES.ROLES.NEW_ROLE.name
          privileges        = ["USAGE"]
        }
      ]
    }
  }
}
</code></pre>
<h2 id="complete-example-adding-a-new-data-domain"><a class="header" href="#complete-example-adding-a-new-data-domain">Complete Example: Adding a New Data Domain</a></h2>
<p>This example shows adding a complete data domain (database, schema, table, view, and grants):</p>
<h3 id="1-add-database"><a class="header" href="#1-add-database">1. Add Database</a></h3>
<pre><code class="language-hcl">resource "snowflake_database" "SALES_DB" {
  name                        = "SALES_DB"
  comment                     = "Sales database"
  data_retention_time_in_days = 30
  provider                    = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="2-add-schema"><a class="header" href="#2-add-schema">2. Add Schema</a></h3>
<pre><code class="language-hcl">resource "snowflake_schema" "ORDERS" {
  name     = "ORDERS"
  database = snowflake_database.SALES_DB.name
  comment  = "Orders schema"
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="3-add-table"><a class="header" href="#3-add-table">3. Add Table</a></h3>
<pre><code class="language-hcl">resource "snowflake_table" "ORDER_ITEMS" {
  database = snowflake_database.SALES_DB.name
  schema   = snowflake_schema.ORDERS.name
  name     = "ORDER_ITEMS"
  comment  = "Order items table"
  
  column {
    name     = "ORDER_ITEM_ID"
    type     = "NUMBER(38,0)"
    nullable = false
  }
  
  column {
    name     = "ORDER_ID"
    type     = "NUMBER(38,0)"
    nullable = false
  }
  
  column {
    name     = "PRODUCT_ID"
    type     = "NUMBER(38,0)"
    nullable = false
  }
  
  column {
    name     = "QUANTITY"
    type     = "NUMBER(10,0)"
    nullable = false
  }
  
  column {
    name     = "PRICE"
    type     = "NUMBER(10,2)"
    nullable = false
  }
  
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="4-add-view"><a class="header" href="#4-add-view">4. Add View</a></h3>
<pre><code class="language-hcl">resource "snowflake_view" "ORDER_SUMMARY" {
  database  = snowflake_database.SALES_DB.name
  schema    = snowflake_schema.ORDERS.name
  name      = "ORDER_SUMMARY"
  statement = &lt;&lt;-SQL
    SELECT 
      ORDER_ID,
      COUNT(*) AS ITEM_COUNT,
      SUM(PRICE * QUANTITY) AS TOTAL_AMOUNT
    FROM ORDER_ITEMS
    GROUP BY ORDER_ID;
  SQL
  comment   = "Order summary view"
  depends_on = [snowflake_table.ORDER_ITEMS]
  
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h3 id="5-add-grants"><a class="header" href="#5-add-grants">5. Add Grants</a></h3>
<pre><code class="language-hcl"># Database grant
resource "snowflake_grant_privileges_to_account_role" "SALES_DB_GRANT" {
  privileges        = ["USAGE"]
  account_role_name = module.ALL_ROLES.ROLES.SALES.name
  on_account_object {
    object_type = "DATABASE"
    object_name = snowflake_database.SALES_DB.name
  }
  provider = snowflake.snowflake_sysadmin
}

# Schema grant
resource "snowflake_grant_privileges_to_account_role" "ORDERS_SCHEMA_GRANT" {
  privileges        = ["USAGE"]
  account_role_name = module.ALL_ROLES.ROLES.SALES.name
  on_schema {
    schema_name = snowflake_schema.ORDERS.fully_qualified_name
  }
  provider = snowflake.snowflake_sysadmin
}

# Table grant
resource "snowflake_grant_privileges_to_account_role" "ORDER_ITEMS_TABLE_GRANT" {
  privileges        = ["SELECT", "INSERT", "UPDATE"]
  account_role_name = module.ALL_ROLES.ROLES.SALES.name
  on_schema_object {
    object_type = "TABLE"
    object_name = snowflake_table.ORDER_ITEMS.fully_qualified_name
  }
  provider = snowflake.snowflake_sysadmin
}

# View grant
resource "snowflake_grant_privileges_to_account_role" "ORDER_SUMMARY_VIEW_GRANT" {
  privileges        = ["SELECT"]
  account_role_name = module.ALL_ROLES.ROLES.SALES.name
  on_schema_object {
    object_type = "VIEW"
    object_name = snowflake_view.ORDER_SUMMARY.fully_qualified_name
  }
  provider = snowflake.snowflake_sysadmin
}
</code></pre>
<h2 id="importing-existing-resources"><a class="header" href="#importing-existing-resources">Importing Existing Resources</a></h2>
<p>If a resource already exists in Snowflake, import it:</p>
<pre><code class="language-bash"># Import database
terraform import snowflake_database.EXISTING_DB "EXISTING_DB"

# Import schema
terraform import snowflake_schema.EXISTING_SCHEMA "DB.SCHEMA"

# Import table
terraform import snowflake_table.EXISTING_TABLE "DB.SCHEMA.TABLE"

# Import view
terraform import snowflake_view.EXISTING_VIEW "DB.SCHEMA.VIEW"
</code></pre>
<p>Then add the resource definition to <code>main.tf</code> matching the imported resource.</p>
<h2 id="best-practices-12"><a class="header" href="#best-practices-12">Best Practices</a></h2>
<ol>
<li><strong>Follow Naming Conventions</strong>: Use consistent naming patterns</li>
<li><strong>Add Comments</strong>: Document the purpose of each resource</li>
<li><strong>Check Dependencies</strong>: Ensure dependencies are correct</li>
<li><strong>Use Fully Qualified Names</strong>: Use <code>fully_qualified_name</code> for grants</li>
<li><strong>Plan Before Apply</strong>: Always run <code>terraform plan</code> first</li>
<li><strong>Test Incrementally</strong>: Add resources one at a time and test</li>
<li><strong>Version Control</strong>: Commit changes to version control</li>
</ol>
<h2 id="troubleshooting-11"><a class="header" href="#troubleshooting-11">Troubleshooting</a></h2>
<h3 id="resource-already-exists"><a class="header" href="#resource-already-exists">Resource Already Exists</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: 2003: Object already exists
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Import the existing resource</li>
<li>Or remove it from Snowflake first</li>
<li>Or use a different name</li>
</ul>
<h3 id="dependency-error"><a class="header" href="#dependency-error">Dependency Error</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: Resource depends on resource that doesn't exist
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Check that dependencies are created first</li>
<li>Add explicit <code>depends_on</code> if needed</li>
<li>Verify resource names are correct</li>
</ul>
<h3 id="invalid-reference"><a class="header" href="#invalid-reference">Invalid Reference</a></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: Reference to undeclared resource
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Verify resource names match exactly</li>
<li>Check that modules are referenced correctly</li>
<li>Ensure resources are defined before use</li>
</ul>
<h2 id="next-steps-9"><a class="header" href="#next-steps-9">Next Steps</a></h2>
<ul>
<li>Review <a href="usage/best-practices.html">Best Practices</a> for guidelines</li>
<li>See <a href="usage/customizing-configuration.html">Customizing Configuration</a> for advanced options</li>
<li>Check <a href="usage/basic-usage.html">Basic Usage</a> for common operations</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="best-practices-13"><a class="header" href="#best-practices-13">Best Practices</a></h1>
<p>This document outlines best practices for managing Snowflake infrastructure with Terraform.</p>
<h2 id="general-best-practices"><a class="header" href="#general-best-practices">General Best Practices</a></h2>
<h3 id="1-version-control"><a class="header" href="#1-version-control">1. Version Control</a></h3>
<p><strong>Do:</strong></p>
<ul>
<li>Commit all <code>.tf</code> files to version control</li>
<li>Use meaningful commit messages</li>
<li>Tag releases for important changes</li>
</ul>
<p><strong>Don’t:</strong></p>
<ul>
<li>Never commit <code>terraform.tfvars</code> (contains secrets)</li>
<li>Never commit <code>terraform.tfstate</code> files</li>
<li>Never commit <code>.terraform/</code> directory</li>
</ul>
<h3 id="2-state-management"><a class="header" href="#2-state-management">2. State Management</a></h3>
<p><strong>Do:</strong></p>
<ul>
<li>Use remote state for team collaboration</li>
<li>Enable state locking</li>
<li>Regularly backup state files</li>
<li>Use separate state files per environment</li>
</ul>
<p><strong>Don’t:</strong></p>
<ul>
<li>Don’t edit state files manually</li>
<li>Don’t share state files via email or chat</li>
<li>Don’t use local state in production</li>
</ul>
<h3 id="3-security"><a class="header" href="#3-security">3. Security</a></h3>
<p><strong>Do:</strong></p>
<ul>
<li>Use environment variables or secrets management for sensitive values</li>
<li>Rotate credentials regularly</li>
<li>Use least privilege principle</li>
<li>Review grants regularly</li>
</ul>
<p><strong>Don’t:</strong></p>
<ul>
<li>Don’t hardcode passwords</li>
<li>Don’t commit secrets</li>
<li>Don’t use overly permissive roles</li>
</ul>
<h2 id="configuration-best-practices"><a class="header" href="#configuration-best-practices">Configuration Best Practices</a></h2>
<h3 id="1-naming-conventions"><a class="header" href="#1-naming-conventions">1. Naming Conventions</a></h3>
<p><strong>Use Consistent Naming:</strong></p>
<pre><code class="language-hcl"># Good: Clear, descriptive names
resource "snowflake_database" "SALES_DATABASE" { ... }
resource "snowflake_schema" "ORDERS_SCHEMA" { ... }

# Bad: Unclear names
resource "snowflake_database" "DB1" { ... }
resource "snowflake_schema" "S1" { ... }
</code></pre>
<p><strong>Follow Patterns:</strong></p>
<ul>
<li>UPPERCASE for resource names</li>
<li>Descriptive prefixes/suffixes</li>
<li>Consistent abbreviations</li>
</ul>
<h3 id="2-comments"><a class="header" href="#2-comments">2. Comments</a></h3>
<p><strong>Always Add Comments:</strong></p>
<pre><code class="language-hcl">resource "snowflake_database" "SALES_DB" {
  name    = "SALES_DB"
  comment = "Sales database for order processing"  # Good: Descriptive
  # Bad: Missing or vague comments
}
</code></pre>
<h3 id="3-variables"><a class="header" href="#3-variables">3. Variables</a></h3>
<p><strong>Use Variables Instead of Hardcoding:</strong></p>
<pre><code class="language-hcl"># Good: Using variables
warehouse_size = var.warehouse_size

# Bad: Hardcoded values
warehouse_size = "SMALL"
</code></pre>
<h3 id="4-resource-organization"><a class="header" href="#4-resource-organization">4. Resource Organization</a></h3>
<p><strong>Group Related Resources:</strong></p>
<pre><code class="language-hcl"># Group by domain/team
# Sales resources
resource "snowflake_database" "SALES_DB" { ... }
resource "snowflake_schema" "SALES_SCHEMA" { ... }

# Marketing resources
resource "snowflake_database" "MARKETING_DB" { ... }
resource "snowflake_schema" "MARKETING_SCHEMA" { ... }
</code></pre>
<h2 id="module-best-practices"><a class="header" href="#module-best-practices">Module Best Practices</a></h2>
<h3 id="1-module-design"><a class="header" href="#1-module-design">1. Module Design</a></h3>
<p><strong>Single Responsibility:</strong></p>
<ul>
<li>Each module should have one clear purpose</li>
<li>Keep modules focused and reusable</li>
</ul>
<p><strong>Map-Based Configuration:</strong></p>
<ul>
<li>Use maps for flexible resource creation</li>
<li>Easy to add/remove resources</li>
</ul>
<h3 id="2-module-usage"><a class="header" href="#2-module-usage">2. Module Usage</a></h3>
<p><strong>Reference Module Outputs:</strong></p>
<pre><code class="language-hcl"># Good: Using module outputs
roles_to_assign = [module.ALL_ROLES.ROLES.ANALYST.name]

# Bad: Hardcoding role names
roles_to_assign = ["ANALYST"]
</code></pre>
<h2 id="role-management-best-practices"><a class="header" href="#role-management-best-practices">Role Management Best Practices</a></h2>
<h3 id="1-role-hierarchy"><a class="header" href="#1-role-hierarchy">1. Role Hierarchy</a></h3>
<p><strong>Keep Hierarchies Shallow:</strong></p>
<pre><code class="language-hcl"># Good: 2-3 levels deep
DATA_SCIENTIST
  └── DATA_ENGINEER
      └── ANALYST

# Bad: Too deep (hard to manage)
LEVEL1
  └── LEVEL2
      └── LEVEL3
          └── LEVEL4
              └── LEVEL5
</code></pre>
<h3 id="2-role-naming"><a class="header" href="#2-role-naming">2. Role Naming</a></h3>
<p><strong>Use Descriptive Names:</strong></p>
<pre><code class="language-hcl"># Good: Clear purpose
"DATA_ENGINEER"
"SALES_ANALYST"
"MARKETING_MANAGER"

# Bad: Unclear
"ROLE1"
"USER_ROLE"
"ACCESS"
</code></pre>
<h3 id="3-principle-of-least-privilege"><a class="header" href="#3-principle-of-least-privilege">3. Principle of Least Privilege</a></h3>
<p><strong>Grant Only Necessary Privileges:</strong></p>
<pre><code class="language-hcl"># Good: Minimal privileges
privileges = ["USAGE", "SELECT"]

# Bad: Overly permissive
privileges = ["ALL PRIVILEGES"]
</code></pre>
<h2 id="user-management-best-practices"><a class="header" href="#user-management-best-practices">User Management Best Practices</a></h2>
<h3 id="1-user-types"><a class="header" href="#1-user-types">1. User Types</a></h3>
<p><strong>Use Appropriate User Types:</strong></p>
<ul>
<li><strong>Person users</strong>: For human users</li>
<li><strong>Service users</strong>: For applications (preferred)</li>
<li><strong>Legacy service users</strong>: Only for existing integrations</li>
</ul>
<h3 id="2-default-configuration"><a class="header" href="#2-default-configuration">2. Default Configuration</a></h3>
<p><strong>Set Appropriate Defaults:</strong></p>
<pre><code class="language-hcl">user_map = {
  "USER" = {
    default_warehouse = module.ALL_WAREHOUSES.WAREHOUSES.USER_WH.name
    default_role     = module.ALL_ROLES.ROLES.USER_ROLE.name
    # ... other config
  }
}
</code></pre>
<h3 id="3-email-addresses"><a class="header" href="#3-email-addresses">3. Email Addresses</a></h3>
<p><strong>Always Provide Emails for Person Users:</strong></p>
<pre><code class="language-hcl">user_map = {
  "USER" = {
    email = "user@example.com"  # Required for person users
    # ... other config
  }
}
</code></pre>
<h2 id="warehouse-management-best-practices"><a class="header" href="#warehouse-management-best-practices">Warehouse Management Best Practices</a></h2>
<h3 id="1-right-sizing"><a class="header" href="#1-right-sizing">1. Right-Sizing</a></h3>
<p><strong>Start Small, Scale Up:</strong></p>
<pre><code class="language-hcl"># Development: Small
warehouse_size = "XSMALL"

# Production: Appropriate size
warehouse_size = "MEDIUM"  # or LARGE based on needs
</code></pre>
<h3 id="2-auto-suspend"><a class="header" href="#2-auto-suspend">2. Auto-Suspend</a></h3>
<p><strong>Enable Auto-Suspend:</strong></p>
<pre><code class="language-hcl">warehouse_auto_suspend = 60  # Suspend after 1 minute of inactivity
warehouse_auto_resume  = true
</code></pre>
<h3 id="3-scaling-policy"><a class="header" href="#3-scaling-policy">3. Scaling Policy</a></h3>
<p><strong>Choose Based on Use Case:</strong></p>
<pre><code class="language-hcl"># Development: Economy (cost-effective)
warehouse_scaling_policy = "ECONOMY"

# Production: Standard (performance)
warehouse_scaling_policy = "STANDARD"
</code></pre>
<h3 id="4-multi-cluster"><a class="header" href="#4-multi-cluster">4. Multi-Cluster</a></h3>
<p><strong>Use Only When Needed:</strong></p>
<pre><code class="language-hcl"># Only for high-concurrency workloads
warehouse_max_cluster_count = 5
warehouse_min_cluster_count = 2
</code></pre>
<h2 id="database-and-schema-best-practices"><a class="header" href="#database-and-schema-best-practices">Database and Schema Best Practices</a></h2>
<h3 id="1-retention-policies"><a class="header" href="#1-retention-policies">1. Retention Policies</a></h3>
<p><strong>Set Appropriate Retention:</strong></p>
<pre><code class="language-hcl"># Development: Minimal retention
data_retention_time_in_days = 1

# Production: Based on requirements
data_retention_time_in_days = 30  # or 90 for enterprise
</code></pre>
<h3 id="2-managed-access"><a class="header" href="#2-managed-access">2. Managed Access</a></h3>
<p><strong>Use for Sensitive Data:</strong></p>
<pre><code class="language-hcl">resource "snowflake_schema" "SECURE_SCHEMA" {
  with_managed_access = true  # Object-level security
  # ... other config
}
</code></pre>
<h3 id="3-transient-objects"><a class="header" href="#3-transient-objects">3. Transient Objects</a></h3>
<p><strong>Use for Temporary Data:</strong></p>
<pre><code class="language-hcl">resource "snowflake_schema" "TEMP_SCHEMA" {
  is_transient = true  # No Time Travel, lower cost
  # ... other config
}
</code></pre>
<h2 id="grant-management-best-practices"><a class="header" href="#grant-management-best-practices">Grant Management Best Practices</a></h2>
<h3 id="1-privilege-hierarchy"><a class="header" href="#1-privilege-hierarchy">1. Privilege Hierarchy</a></h3>
<p><strong>Follow the Hierarchy:</strong></p>
<ol>
<li>Grant database USAGE</li>
<li>Grant schema USAGE</li>
<li>Grant object privileges (SELECT, INSERT, etc.)</li>
</ol>
<h3 id="2-explicit-grants"><a class="header" href="#2-explicit-grants">2. Explicit Grants</a></h3>
<p><strong>Be Explicit:</strong></p>
<pre><code class="language-hcl"># Good: Explicit grants
privileges = ["USAGE", "SELECT"]

# Bad: Overly broad
privileges = ["ALL PRIVILEGES"]
</code></pre>
<h3 id="3-grant-option"><a class="header" href="#3-grant-option">3. Grant Option</a></h3>
<p><strong>Use Sparingly:</strong></p>
<pre><code class="language-hcl"># Only for administrative roles
with_grant_option = true
</code></pre>
<h2 id="table-and-view-best-practices"><a class="header" href="#table-and-view-best-practices">Table and View Best Practices</a></h2>
<h3 id="1-data-types"><a class="header" href="#1-data-types">1. Data Types</a></h3>
<p><strong>Choose Appropriate Types:</strong></p>
<pre><code class="language-hcl"># Good: Appropriate precision
column {
  name = "AMOUNT"
  type = "NUMBER(10,2)"  # Appropriate for currency
}

# Bad: Overly large
column {
  name = "AMOUNT"
  type = "NUMBER(38,0)"  # Unnecessarily large
}
</code></pre>
<h3 id="2-nullable-columns"><a class="header" href="#2-nullable-columns">2. Nullable Columns</a></h3>
<p><strong>Be Explicit:</strong></p>
<pre><code class="language-hcl">column {
  name     = "ID"
  nullable = false  # Explicit
}
</code></pre>
<h3 id="3-comments"><a class="header" href="#3-comments">3. Comments</a></h3>
<p><strong>Document Columns:</strong></p>
<pre><code class="language-hcl">column {
  name    = "METADATA"
  type    = "VARIANT"
  comment = "Additional metadata in JSON format"
}
</code></pre>
<h3 id="4-view-dependencies"><a class="header" href="#4-view-dependencies">4. View Dependencies</a></h3>
<p><strong>Declare Dependencies:</strong></p>
<pre><code class="language-hcl">resource "snowflake_view" "MY_VIEW" {
  depends_on = [snowflake_table.MY_TABLE]  # Explicit dependency
  # ... other config
}
</code></pre>
<h2 id="workflow-best-practices"><a class="header" href="#workflow-best-practices">Workflow Best Practices</a></h2>
<h3 id="1-plan-before-apply"><a class="header" href="#1-plan-before-apply">1. Plan Before Apply</a></h3>
<p><strong>Always Review Plans:</strong></p>
<pre><code class="language-bash">terraform plan  # Review changes
terraform apply # Apply after review
</code></pre>
<h3 id="2-incremental-changes"><a class="header" href="#2-incremental-changes">2. Incremental Changes</a></h3>
<p><strong>Make Small, Incremental Changes:</strong></p>
<ul>
<li>Add one resource at a time</li>
<li>Test after each addition</li>
<li>Commit working changes</li>
</ul>
<h3 id="3-testing"><a class="header" href="#3-testing">3. Testing</a></h3>
<p><strong>Test in Development First:</strong></p>
<ul>
<li>Test changes in dev environment</li>
<li>Verify functionality</li>
<li>Then apply to production</li>
</ul>
<h3 id="4-documentation"><a class="header" href="#4-documentation">4. Documentation</a></h3>
<p><strong>Keep Documentation Updated:</strong></p>
<ul>
<li>Update docs when adding resources</li>
<li>Document customizations</li>
<li>Explain complex configurations</li>
</ul>
<h2 id="environment-management"><a class="header" href="#environment-management">Environment Management</a></h2>
<h3 id="1-separate-environments"><a class="header" href="#1-separate-environments">1. Separate Environments</a></h3>
<p><strong>Use Separate Configurations:</strong></p>
<pre><code class="language-bash">terraform.tfvars.dev
terraform.tfvars.staging
terraform.tfvars.prod
</code></pre>
<h3 id="2-state-isolation"><a class="header" href="#2-state-isolation">2. State Isolation</a></h3>
<p><strong>Separate State Per Environment:</strong></p>
<ul>
<li>Different state files</li>
<li>Different state backends</li>
<li>Prevents accidental cross-environment changes</li>
</ul>
<h3 id="3-environment-specific-values"><a class="header" href="#3-environment-specific-values">3. Environment-Specific Values</a></h3>
<p><strong>Use Variables:</strong></p>
<pre><code class="language-hcl"># Development
warehouse_size = "XSMALL"

# Production
warehouse_size = "LARGE"
</code></pre>
<h2 id="monitoring-and-maintenance"><a class="header" href="#monitoring-and-maintenance">Monitoring and Maintenance</a></h2>
<h3 id="1-regular-reviews"><a class="header" href="#1-regular-reviews">1. Regular Reviews</a></h3>
<p><strong>Review Regularly:</strong></p>
<ul>
<li>Review grants quarterly</li>
<li>Audit user access</li>
<li>Check warehouse usage</li>
<li>Review costs</li>
</ul>
<h3 id="2-cleanup"><a class="header" href="#2-cleanup">2. Cleanup</a></h3>
<p><strong>Remove Unused Resources:</strong></p>
<ul>
<li>Remove unused users</li>
<li>Suspend unused warehouses</li>
<li>Archive old databases</li>
</ul>
<h3 id="3-updates"><a class="header" href="#3-updates">3. Updates</a></h3>
<p><strong>Keep Updated:</strong></p>
<ul>
<li>Update Terraform version</li>
<li>Update provider versions</li>
<li>Review security updates</li>
</ul>
<h2 id="error-handling"><a class="header" href="#error-handling">Error Handling</a></h2>
<h3 id="1-validation"><a class="header" href="#1-validation">1. Validation</a></h3>
<p><strong>Validate Before Apply:</strong></p>
<pre><code class="language-bash">terraform validate
terraform fmt
terraform plan
</code></pre>
<h3 id="2-error-recovery"><a class="header" href="#2-error-recovery">2. Error Recovery</a></h3>
<p><strong>Handle Errors Gracefully:</strong></p>
<ul>
<li>Review error messages</li>
<li>Check dependencies</li>
<li>Verify permissions</li>
<li>Import existing resources if needed</li>
</ul>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p>Following these best practices will help you:</p>
<ul>
<li>Maintain secure and well-organized infrastructure</li>
<li>Reduce errors and troubleshooting time</li>
<li>Improve collaboration with your team</li>
<li>Optimize costs and performance</li>
<li>Ensure compliance and auditability</li>
</ul>
<p>Remember: Start simple, iterate, and refine your configuration over time.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="variables-reference"><a class="header" href="#variables-reference">Variables Reference</a></h1>
<p>This document provides a complete reference for all variables used in the Terraform configuration.</p>
<h2 id="root-module-variables"><a class="header" href="#root-module-variables">Root Module Variables</a></h2>
<p>Variables are defined in <code>variables.tf</code> and values are provided in <code>terraform.tfvars</code>.</p>
<h3 id="snowflake_organization"><a class="header" href="#snowflake_organization"><code>snowflake_organization</code></a></h3>
<p><strong>Type:</strong> <code>string</code><br />
<strong>Required:</strong> Yes<br />
<strong>Description:</strong> Your Snowflake organization identifier</p>
<p><strong>Example:</strong></p>
<pre><code class="language-hcl">snowflake_organization = "XKVLJOE"
</code></pre>
<p><strong>Where to Find:</strong></p>
<ul>
<li>In Snowflake URL: <code>https://&lt;organization&gt;-&lt;account&gt;.snowflakecomputing.com</code></li>
<li>In Snowflake account settings</li>
</ul>
<h3 id="snowflake_account"><a class="header" href="#snowflake_account"><code>snowflake_account</code></a></h3>
<p><strong>Type:</strong> <code>string</code><br />
<strong>Required:</strong> Yes<br />
<strong>Description:</strong> Your Snowflake account identifier</p>
<p><strong>Example:</strong></p>
<pre><code class="language-hcl">snowflake_account = "JO28946"
</code></pre>
<p><strong>Where to Find:</strong></p>
<ul>
<li>In Snowflake URL: <code>https://&lt;organization&gt;-&lt;account&gt;.snowflakecomputing.com</code></li>
<li>In Snowflake account settings</li>
</ul>
<h3 id="snowflake_username"><a class="header" href="#snowflake_username"><code>snowflake_username</code></a></h3>
<p><strong>Type:</strong> <code>string</code><br />
<strong>Required:</strong> Yes<br />
<strong>Description:</strong> Username for authenticating with Snowflake</p>
<p><strong>Example:</strong></p>
<pre><code class="language-hcl">snowflake_username = "terraform_user"
</code></pre>
<p><strong>Notes:</strong></p>
<ul>
<li>User must have ACCOUNTADMIN role or ability to assume SECURITYADMIN and SYSADMIN</li>
<li>Use a dedicated service account for Terraform</li>
</ul>
<h3 id="snowflake_password"><a class="header" href="#snowflake_password"><code>snowflake_password</code></a></h3>
<p><strong>Type:</strong> <code>string</code><br />
<strong>Required:</strong> Yes<br />
<strong>Sensitive:</strong> Yes<br />
<strong>Description:</strong> Password for authenticating with Snowflake</p>
<p><strong>Example:</strong></p>
<pre><code class="language-hcl">snowflake_password = "SecurePassword123!"
</code></pre>
<p><strong>Security:</strong></p>
<ul>
<li>Never commit to version control</li>
<li>Use environment variables or secrets management</li>
<li>Rotate regularly</li>
</ul>
<h3 id="snowflake_role"><a class="header" href="#snowflake_role"><code>snowflake_role</code></a></h3>
<p><strong>Type:</strong> <code>string</code><br />
<strong>Required:</strong> Yes<br />
<strong>Description:</strong> Initial role to use for Terraform operations</p>
<p><strong>Example:</strong></p>
<pre><code class="language-hcl">snowflake_role = "ACCOUNTADMIN"
</code></pre>
<p><strong>Common Values:</strong></p>
<ul>
<li><code>ACCOUNTADMIN</code>: Full account access (recommended for Terraform)</li>
<li><code>SECURITYADMIN</code>: Security operations</li>
<li><code>SYSADMIN</code>: System administration</li>
</ul>
<p><strong>Notes:</strong></p>
<ul>
<li>Provider aliases override this with specific roles</li>
<li>Typically set to ACCOUNTADMIN for Terraform user</li>
</ul>
<h3 id="snowflake_warehouse"><a class="header" href="#snowflake_warehouse"><code>snowflake_warehouse</code></a></h3>
<p><strong>Type:</strong> <code>string</code><br />
<strong>Required:</strong> No<br />
<strong>Default:</strong> <code>"COMPUTE_WH"</code><br />
<strong>Description:</strong> Warehouse to use for Terraform provider operations</p>
<p><strong>Example:</strong></p>
<pre><code class="language-hcl">snowflake_warehouse = "COMPUTE_WH"
</code></pre>
<p><strong>Notes:</strong></p>
<ul>
<li>Must be an existing warehouse</li>
<li>Used by Terraform provider for operations</li>
<li>Default warehouse is usually sufficient</li>
</ul>
<h2 id="variable-usage"><a class="header" href="#variable-usage">Variable Usage</a></h2>
<h3 id="in-terraformtfvars"><a class="header" href="#in-terraformtfvars">In terraform.tfvars</a></h3>
<pre><code class="language-hcl"># terraform.tfvars
snowflake_organization = "YOUR_ORG"
snowflake_account      = "YOUR_ACCOUNT"
snowflake_username     = "YOUR_USERNAME"
snowflake_password     = "YOUR_PASSWORD"
snowflake_role         = "ACCOUNTADMIN"
snowflake_warehouse    = "COMPUTE_WH"
</code></pre>
<h3 id="via-environment-variables"><a class="header" href="#via-environment-variables">Via Environment Variables</a></h3>
<pre><code class="language-bash"># Linux/macOS
export TF_VAR_snowflake_username="YOUR_USERNAME"
export TF_VAR_snowflake_password="YOUR_PASSWORD"
export TF_VAR_snowflake_organization="YOUR_ORG"
export TF_VAR_snowflake_account="YOUR_ACCOUNT"
export TF_VAR_snowflake_role="ACCOUNTADMIN"
export TF_VAR_snowflake_warehouse="COMPUTE_WH"

# Windows PowerShell
$env:TF_VAR_snowflake_username = "YOUR_USERNAME"
$env:TF_VAR_snowflake_password = "YOUR_PASSWORD"
$env:TF_VAR_snowflake_organization = "YOUR_ORG"
$env:TF_VAR_snowflake_account = "YOUR_ACCOUNT"
$env:TF_VAR_snowflake_role = "ACCOUNTADMIN"
$env:TF_VAR_snowflake_warehouse = "COMPUTE_WH"
</code></pre>
<h3 id="via-command-line"><a class="header" href="#via-command-line">Via Command Line</a></h3>
<pre><code class="language-bash">terraform apply \
  -var="snowflake_organization=YOUR_ORG" \
  -var="snowflake_account=YOUR_ACCOUNT" \
  -var="snowflake_username=YOUR_USERNAME" \
  -var="snowflake_password=YOUR_PASSWORD" \
  -var="snowflake_role=ACCOUNTADMIN" \
  -var="snowflake_warehouse=COMPUTE_WH"
</code></pre>
<h2 id="module-variables"><a class="header" href="#module-variables">Module Variables</a></h2>
<h3 id="roles-module-variables"><a class="header" href="#roles-module-variables">Roles Module Variables</a></h3>
<h4 id="role_map-1"><a class="header" href="#role_map-1"><code>role_map</code></a></h4>
<p><strong>Type:</strong> <code>map(any)</code><br />
<strong>Required:</strong> Yes<br />
<strong>Description:</strong> Map of role names to role configurations</p>
<p><strong>Structure:</strong></p>
<pre><code class="language-hcl">role_map = {
  "ROLE_NAME" = {
    parent_role_name = "PARENT_ROLE"  # Optional, defaults to "SYSADMIN"
    comment          = "Role description"  # Optional
  }
}
</code></pre>
<p><strong>Example:</strong></p>
<pre><code class="language-hcl">role_map = {
  "ANALYST" = {
    parent_role_name = "DATA_ENGINEER"
    comment          = "Role for data analysts"
  }
}
</code></pre>
<h3 id="users-module-variables"><a class="header" href="#users-module-variables">Users Module Variables</a></h3>
<h4 id="user_map-1"><a class="header" href="#user_map-1"><code>user_map</code></a></h4>
<p><strong>Type:</strong> <code>map(object)</code><br />
<strong>Required:</strong> Yes<br />
<strong>Description:</strong> Map of usernames to user configurations</p>
<p><strong>Structure:</strong></p>
<pre><code class="language-hcl">user_map = {
  "USERNAME" = {
    first_name                     = "First"           # Required
    last_name                      = "Last"            # Required
    user_type                      = "person"          # Required: "person", "service", "legacy_service"
    email                          = "user@example.com"  # Optional
    comment                        = "User description"  # Optional
    disabled                       = "false"             # Optional, default: "false"
    default_warehouse              = "WAREHOUSE_NAME"     # Optional, default: "NONE"
    default_role                   = "ROLE_NAME"         # Optional, default: "NONE" (becomes PUBLIC)
    default_secondary_roles_option = "NONE"              # Optional, default: "NONE"
    must_change_password           = "true"             # Optional, default: "true"
    disable_mfa                    = "false"            # Optional, default: "false"
    roles_to_assign                = ["ROLE1", "ROLE2"] # Optional, default: []
  }
}
</code></pre>
<p><strong>Example:</strong></p>
<pre><code class="language-hcl">user_map = {
  "TEST_USER1" = {
    first_name  = "Test"
    last_name   = "User1"
    email       = "test.user1@example.com"
    user_type   = "person"
    roles_to_assign = [module.ALL_ROLES.ROLES.ANALYST.name]
  }
}
</code></pre>
<h3 id="warehouse-module-variables"><a class="header" href="#warehouse-module-variables">Warehouse Module Variables</a></h3>
<h4 id="warehouse_map-1"><a class="header" href="#warehouse_map-1"><code>warehouse_map</code></a></h4>
<p><strong>Type:</strong> <code>map(object)</code><br />
<strong>Required:</strong> Yes<br />
<strong>Description:</strong> Map of warehouse names to warehouse configurations</p>
<p><strong>Structure:</strong></p>
<pre><code class="language-hcl">warehouse_map = {
  "WAREHOUSE_NAME" = {
    warehouse_type                = "STANDARD"           # Required: "STANDARD" or "SNOWPARK-OPTIMIZED"
    warehouse_generation          = "2"                  # Required: "1" or "2"
    warehouse_size                = "SMALL"              # Optional, default: "XSMALL"
    warehouse_max_cluster_count   = 1                    # Optional, default: 1
    warehouse_min_cluster_count   = 1                    # Optional, default: 1
    warehouse_scaling_policy      = "ECONOMY"            # Optional, default: "ECONOMY"
    warehouse_auto_suspend        = 60                   # Optional, default: 60
    warehouse_auto_resume         = true                 # Optional, default: true
    warehouse_initially_suspended = true                 # Optional, default: true
    warehouse_comment             = "Warehouse description"  # Optional
    warehouse_max_concurrency_level = 8                  # Optional, default: 8
    warehouse_statement_timeout_in_seconds = 900        # Optional, default: 900
    role_privileges = [                                  # Required
      {
        account_role_name = "ROLE_NAME"
        privileges        = ["USAGE"]
      }
    ]
    with_grant_option = false                            # Optional, default: false
  }
}
</code></pre>
<p><strong>Example:</strong></p>
<pre><code class="language-hcl">warehouse_map = {
  "MY_WAREHOUSE" = {
    warehouse_type       = "STANDARD"
    warehouse_generation = "2"
    warehouse_size       = "SMALL"
    role_privileges = [
      {
        account_role_name = module.ALL_ROLES.ROLES.ANALYST.name
        privileges        = ["USAGE"]
      }
    ]
  }
}
</code></pre>
<h2 id="custom-variables"><a class="header" href="#custom-variables">Custom Variables</a></h2>
<p>You can add custom variables to <code>variables.tf</code>:</p>
<pre><code class="language-hcl">variable "environment" {
  type        = string
  description = "Environment name"
  default     = "dev"
}

variable "warehouse_size" {
  type        = string
  description = "Default warehouse size"
  default     = "SMALL"
}
</code></pre>
<p>Use in configuration:</p>
<pre><code class="language-hcl">warehouse_size = var.warehouse_size
</code></pre>
<h2 id="variable-precedence"><a class="header" href="#variable-precedence">Variable Precedence</a></h2>
<p>Terraform uses the following precedence (highest to lowest):</p>
<ol>
<li>Command line flags (<code>-var</code> and <code>-var-file</code>)</li>
<li><code>.tfvars</code> files (if <code>-var-file</code> is specified)</li>
<li><code>terraform.tfvars</code> (automatically loaded)</li>
<li><code>terraform.tfvars.json</code> (automatically loaded)</li>
<li>Environment variables (<code>TF_VAR_*</code>)</li>
<li>Default values in variable definitions</li>
</ol>
<h2 id="security-best-practices-1"><a class="header" href="#security-best-practices-1">Security Best Practices</a></h2>
<ol>
<li>
<p><strong>Never Commit Secrets:</strong></p>
<ul>
<li>Keep <code>terraform.tfvars</code> in <code>.gitignore</code></li>
<li>Use environment variables for sensitive values</li>
<li>Use secrets management systems (AWS Secrets Manager, Azure Key Vault, etc.)</li>
</ul>
</li>
<li>
<p><strong>Use Separate Files:</strong></p>
<ul>
<li><code>terraform.tfvars.example</code> (committed, no secrets)</li>
<li><code>terraform.tfvars</code> (not committed, contains secrets)</li>
</ul>
</li>
<li>
<p><strong>Rotate Credentials:</strong></p>
<ul>
<li>Regularly rotate passwords</li>
<li>Use key pair authentication when possible</li>
<li>Implement credential rotation policies</li>
</ul>
</li>
</ol>
<h2 id="related-documentation-8"><a class="header" href="#related-documentation-8">Related Documentation</a></h2>
<ul>
<li><a href="reference/../getting-started/configuration.html">Configuration Guide</a> - How to configure variables</li>
<li><a href="reference/outputs.html">Outputs Reference</a> - Available outputs</li>
<li><a href="reference/module-inputs.html">Module Inputs</a> - Module-specific variables</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="outputs-reference"><a class="header" href="#outputs-reference">Outputs Reference</a></h1>
<p>This document provides a complete reference for all outputs available from the Terraform configuration.</p>
<h2 id="root-module-outputs"><a class="header" href="#root-module-outputs">Root Module Outputs</a></h2>
<p>Outputs are defined in <code>outputs.tf</code> and can be viewed using <code>terraform output</code>.</p>
<h3 id="all_roles"><a class="header" href="#all_roles"><code>ALL_ROLES</code></a></h3>
<p><strong>Type:</strong> <code>object</code><br />
<strong>Sensitive:</strong> No<br />
<strong>Description:</strong> Complete output from the roles module</p>
<p><strong>Structure:</strong></p>
<pre><code class="language-hcl">{
  ROLES = {
    "ROLE_NAME" = {
      name    = "ROLE_NAME"
      comment = "Role description"
      # ... other role attributes
    }
  }
}
</code></pre>
<p><strong>Usage:</strong></p>
<pre><code class="language-bash"># View all roles output
terraform output ALL_ROLES

# View specific role
terraform output -json ALL_ROLES | jq '.ROLES.ANALYST'
</code></pre>
<p><strong>In Configuration:</strong></p>
<pre><code class="language-hcl"># Reference a role
roles_to_assign = [module.ALL_ROLES.ROLES.ANALYST.name]
</code></pre>
<h3 id="all_users"><a class="header" href="#all_users"><code>ALL_USERS</code></a></h3>
<p><strong>Type:</strong> <code>object</code><br />
<strong>Sensitive:</strong> Yes<br />
<strong>Description:</strong> Complete output from the users module</p>
<p><strong>Structure:</strong></p>
<pre><code class="language-hcl">{
  USERS = {
    "USERNAME" = {
      name  = "USERNAME"
      email = "user@example.com"
      # ... other user attributes
    }
  },
  SERVICE_USERS = {
    "SERVICE_USERNAME" = {
      name = "SERVICE_USERNAME"
      # ... other service user attributes
    }
  },
  LEGACY_SERVICE_USERS = {
    "LEGACY_USERNAME" = {
      name = "LEGACY_USERNAME"
      # ... other legacy service user attributes
    }
  }
}
</code></pre>
<p><strong>Usage:</strong></p>
<pre><code class="language-bash"># View all users output (sensitive, be careful)
terraform output ALL_USERS

# View specific user
terraform output -json ALL_USERS | jq '.USERS.TEST_USER1'
</code></pre>
<p><strong>Notes:</strong></p>
<ul>
<li>Marked as sensitive to protect user information</li>
<li>Contains user details including emails</li>
<li>Use with caution in scripts</li>
</ul>
<h3 id="all_warehouses"><a class="header" href="#all_warehouses"><code>ALL_WAREHOUSES</code></a></h3>
<p><strong>Type:</strong> <code>object</code><br />
<strong>Sensitive:</strong> No<br />
<strong>Description:</strong> Complete output from the warehouse module</p>
<p><strong>Structure:</strong></p>
<pre><code class="language-hcl">{
  WAREHOUSES = {
    "WAREHOUSE_NAME" = {
      name = "WAREHOUSE_NAME"
      size = "SMALL"
      # ... other warehouse attributes
    }
  }
}
</code></pre>
<p><strong>Usage:</strong></p>
<pre><code class="language-bash"># View all warehouses output
terraform output ALL_WAREHOUSES

# View specific warehouse
terraform output -json ALL_WAREHOUSES | jq '.WAREHOUSES.MARKETING_XSMALL_WH'
</code></pre>
<p><strong>In Configuration:</strong></p>
<pre><code class="language-hcl"># Reference a warehouse
default_warehouse = module.ALL_WAREHOUSES.WAREHOUSES.MARKETING_XSMALL_WH.name
</code></pre>
<h2 id="module-outputs"><a class="header" href="#module-outputs">Module Outputs</a></h2>
<h3 id="roles-module-outputs"><a class="header" href="#roles-module-outputs">Roles Module Outputs</a></h3>
<h4 id="roles-1"><a class="header" href="#roles-1"><code>ROLES</code></a></h4>
<p><strong>Type:</strong> <code>map(object)</code><br />
<strong>Description:</strong> Map of all created role resources</p>
<p><strong>Access:</strong></p>
<pre><code class="language-hcl">module.ALL_ROLES.ROLES["ROLE_NAME"]
# or
module.ALL_ROLES.ROLES.ROLE_NAME
</code></pre>
<p><strong>Properties:</strong></p>
<ul>
<li><code>name</code>: Role name</li>
<li><code>comment</code>: Role comment</li>
<li>Other role attributes from Snowflake</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="language-hcl"># Get role name
role_name = module.ALL_ROLES.ROLES.ANALYST.name

# Use in user assignment
roles_to_assign = [module.ALL_ROLES.ROLES.ANALYST.name]
</code></pre>
<h3 id="users-module-outputs"><a class="header" href="#users-module-outputs">Users Module Outputs</a></h3>
<h4 id="users-1"><a class="header" href="#users-1"><code>USERS</code></a></h4>
<p><strong>Type:</strong> <code>map(object)</code><br />
<strong>Description:</strong> Map of all created person user resources</p>
<p><strong>Access:</strong></p>
<pre><code class="language-hcl">module.ALL_USERS.USERS["USERNAME"]
# or
module.ALL_USERS.USERS.USERNAME
</code></pre>
<p><strong>Properties:</strong></p>
<ul>
<li><code>name</code>: Username</li>
<li><code>email</code>: User email</li>
<li><code>default_warehouse</code>: Default warehouse</li>
<li><code>default_role</code>: Default role</li>
<li>Other user attributes from Snowflake</li>
</ul>
<h4 id="service_users-1"><a class="header" href="#service_users-1"><code>SERVICE_USERS</code></a></h4>
<p><strong>Type:</strong> <code>map(object)</code><br />
<strong>Description:</strong> Map of all created service user resources</p>
<p><strong>Access:</strong></p>
<pre><code class="language-hcl">module.ALL_USERS.SERVICE_USERS["SERVICE_USERNAME"]
</code></pre>
<p><strong>Properties:</strong></p>
<ul>
<li>Similar to person users</li>
<li>No password-related fields</li>
</ul>
<h4 id="legacy_service_users-1"><a class="header" href="#legacy_service_users-1"><code>LEGACY_SERVICE_USERS</code></a></h4>
<p><strong>Type:</strong> <code>map(object)</code><br />
<strong>Description:</strong> Map of all created legacy service user resources</p>
<p><strong>Access:</strong></p>
<pre><code class="language-hcl">module.ALL_USERS.LEGACY_SERVICE_USERS["LEGACY_USERNAME"]
</code></pre>
<p><strong>Properties:</strong></p>
<ul>
<li>Similar to service users</li>
<li>Legacy format</li>
</ul>
<h3 id="warehouse-module-outputs"><a class="header" href="#warehouse-module-outputs">Warehouse Module Outputs</a></h3>
<h4 id="warehouses-1"><a class="header" href="#warehouses-1"><code>WAREHOUSES</code></a></h4>
<p><strong>Type:</strong> <code>map(object)</code><br />
<strong>Description:</strong> Map of all created warehouse resources</p>
<p><strong>Access:</strong></p>
<pre><code class="language-hcl">module.ALL_WAREHOUSES.WAREHOUSES["WAREHOUSE_NAME"]
# or
module.ALL_WAREHOUSES.WAREHOUSES.WAREHOUSE_NAME
</code></pre>
<p><strong>Properties:</strong></p>
<ul>
<li><code>name</code>: Warehouse name</li>
<li><code>size</code>: Warehouse size</li>
<li><code>warehouse_type</code>: Warehouse type</li>
<li>Other warehouse attributes from Snowflake</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="language-hcl"># Get warehouse name
warehouse_name = module.ALL_WAREHOUSES.WAREHOUSES.MARKETING_XSMALL_WH.name

# Use in user default
default_warehouse = module.ALL_WAREHOUSES.WAREHOUSES.MARKETING_XSMALL_WH.name
</code></pre>
<h2 id="resource-outputs"><a class="header" href="#resource-outputs">Resource Outputs</a></h2>
<p>Individual resources also have outputs that can be referenced:</p>
<h3 id="database-outputs"><a class="header" href="#database-outputs">Database Outputs</a></h3>
<pre><code class="language-hcl">snowflake_database.TEST_DB.name
snowflake_database.TEST_DB.comment
</code></pre>
<h3 id="schema-outputs"><a class="header" href="#schema-outputs">Schema Outputs</a></h3>
<pre><code class="language-hcl">snowflake_schema.ADS.name
snowflake_schema.ADS.fully_qualified_name  # "DATABASE.SCHEMA"
snowflake_schema.ADS.comment
</code></pre>
<h3 id="table-outputs"><a class="header" href="#table-outputs">Table Outputs</a></h3>
<pre><code class="language-hcl">snowflake_table.FACEBOOK_ADS.name
snowflake_table.FACEBOOK_ADS.fully_qualified_name  # "DATABASE.SCHEMA.TABLE"
snowflake_table.FACEBOOK_ADS.comment
</code></pre>
<h3 id="view-outputs"><a class="header" href="#view-outputs">View Outputs</a></h3>
<pre><code class="language-hcl">snowflake_view.AGG_FACEBOOK_ADS.name
snowflake_view.AGG_FACEBOOK_ADS.fully_qualified_name  # "DATABASE.SCHEMA.VIEW"
snowflake_view.AGG_FACEBOOK_ADS.comment
</code></pre>
<h2 id="using-outputs"><a class="header" href="#using-outputs">Using Outputs</a></h2>
<h3 id="in-terraform-configuration"><a class="header" href="#in-terraform-configuration">In Terraform Configuration</a></h3>
<pre><code class="language-hcl"># Reference module outputs
roles_to_assign = [module.ALL_ROLES.ROLES.ANALYST.name]
default_warehouse = module.ALL_WAREHOUSES.WAREHOUSES.MY_WH.name

# Reference resource outputs
schema_name = snowflake_schema.ADS.fully_qualified_name
object_name = snowflake_table.FACEBOOK_ADS.fully_qualified_name
</code></pre>
<h3 id="in-terraform-cli"><a class="header" href="#in-terraform-cli">In Terraform CLI</a></h3>
<pre><code class="language-bash"># View all outputs
terraform output

# View specific output
terraform output ALL_ROLES

# View as JSON
terraform output -json

# View specific output as JSON
terraform output -json ALL_ROLES
</code></pre>
<h3 id="in-scripts"><a class="header" href="#in-scripts">In Scripts</a></h3>
<pre><code class="language-bash"># Get role name
ROLE_NAME=$(terraform output -raw ALL_ROLES | jq -r '.ROLES.ANALYST.name')

# Get warehouse name
WH_NAME=$(terraform output -raw ALL_WAREHOUSES | jq -r '.WAREHOUSES.MY_WH.name')
</code></pre>
<h2 id="output-formatting"><a class="header" href="#output-formatting">Output Formatting</a></h2>
<h3 id="default-format"><a class="header" href="#default-format">Default Format</a></h3>
<pre><code class="language-bash">terraform output ALL_ROLES
</code></pre>
<p>Shows human-readable output.</p>
<h3 id="json-format"><a class="header" href="#json-format">JSON Format</a></h3>
<pre><code class="language-bash">terraform output -json ALL_ROLES
</code></pre>
<p>Shows JSON output for programmatic use.</p>
<h3 id="raw-format"><a class="header" href="#raw-format">Raw Format</a></h3>
<pre><code class="language-bash">terraform output -raw ALL_ROLES
</code></pre>
<p>Shows raw output (useful for single values).</p>
<h2 id="best-practices-14"><a class="header" href="#best-practices-14">Best Practices</a></h2>
<ol>
<li><strong>Use Module Outputs:</strong> Reference module outputs rather than hardcoding values</li>
<li><strong>Fully Qualified Names:</strong> Use <code>fully_qualified_name</code> for grants and references</li>
<li><strong>Sensitive Outputs:</strong> Be careful with sensitive outputs (users)</li>
<li><strong>Documentation:</strong> Document custom outputs you add</li>
<li><strong>Version Control:</strong> Outputs are part of state, not committed separately</li>
</ol>
<h2 id="adding-custom-outputs"><a class="header" href="#adding-custom-outputs">Adding Custom Outputs</a></h2>
<p>You can add custom outputs to <code>outputs.tf</code>:</p>
<pre><code class="language-hcl">output "DATABASE_NAMES" {
  description = "List of all database names"
  value       = [
    snowflake_database.TEST_DB.name,
    snowflake_database.TEST_DB2.name
  ]
}

output "ROLE_COUNT" {
  description = "Number of roles created"
  value       = length(module.ALL_ROLES.ROLES)
}
</code></pre>
<h2 id="related-documentation-9"><a class="header" href="#related-documentation-9">Related Documentation</a></h2>
<ul>
<li><a href="reference/variables.html">Variables Reference</a> - Input variables</li>
<li><a href="reference/module-inputs.html">Module Inputs</a> - Module-specific inputs and outputs</li>
<li><a href="reference/../usage/basic-usage.html">Basic Usage</a> - Using outputs in practice</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="module-inputs-reference"><a class="header" href="#module-inputs-reference">Module Inputs Reference</a></h1>
<p>This document provides detailed reference for module inputs and outputs.</p>
<h2 id="roles-module-2"><a class="header" href="#roles-module-2">Roles Module</a></h2>
<h3 id="inputs-3"><a class="header" href="#inputs-3">Inputs</a></h3>
<h4 id="role_map-2"><a class="header" href="#role_map-2"><code>role_map</code></a></h4>
<p><strong>Type:</strong> <code>map(any)</code><br />
<strong>Required:</strong> Yes<br />
<strong>Description:</strong> Map of role names to role configurations</p>
<p><strong>Structure:</strong></p>
<pre><code class="language-hcl">role_map = {
  "ROLE_NAME" = {
    parent_role_name = "PARENT_ROLE"  # Optional, defaults to "SYSADMIN"
    comment          = "Role description"  # Optional
  }
}
</code></pre>
<p><strong>Example:</strong></p>
<pre><code class="language-hcl">module "ALL_ROLES" {
  source = "./modules/snowflake/roles"
  
  role_map = {
    "ANALYST" = {
      parent_role_name = "DATA_ENGINEER"
      comment          = "Role for data analysts"
    },
    "DATA_ENGINEER" = {
      parent_role_name = "DATA_SCIENTIST"
      comment          = "Role for data engineers"
    }
  }
}
</code></pre>
<p><strong>Field Details:</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Required</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td><code>parent_role_name</code></td><td><code>string</code></td><td>No</td><td><code>"SYSADMIN"</code></td><td>Name of the parent role to grant this role to</td></tr>
<tr><td><code>comment</code></td><td><code>string</code></td><td>No</td><td><code>null</code></td><td>Comment describing the role</td></tr>
</tbody></table>
</div>
<h3 id="outputs-6"><a class="header" href="#outputs-6">Outputs</a></h3>
<h4 id="roles-2"><a class="header" href="#roles-2"><code>ROLES</code></a></h4>
<p><strong>Type:</strong> <code>map(object)</code><br />
<strong>Description:</strong> Map of all created role resources, keyed by role name</p>
<p><strong>Structure:</strong></p>
<pre><code class="language-hcl">{
  "ROLE_NAME" = {
    name    = "ROLE_NAME"
    comment = "Role description"
    # ... other Snowflake role attributes
  }
}
</code></pre>
<p><strong>Usage:</strong></p>
<pre><code class="language-hcl"># Reference a role
module.ALL_ROLES.ROLES.ANALYST.name
</code></pre>
<h2 id="users-module-2"><a class="header" href="#users-module-2">Users Module</a></h2>
<h3 id="inputs-4"><a class="header" href="#inputs-4">Inputs</a></h3>
<h4 id="user_map-2"><a class="header" href="#user_map-2"><code>user_map</code></a></h4>
<p><strong>Type:</strong> <code>map(object)</code><br />
<strong>Required:</strong> Yes<br />
<strong>Description:</strong> Map of usernames to user configurations</p>
<p><strong>Structure:</strong></p>
<pre><code class="language-hcl">user_map = {
  "USERNAME" = {
    first_name                     = "First"           # Required
    last_name                      = "Last"            # Required
    user_type                      = "person"          # Required
    email                          = "user@example.com"  # Optional
    comment                        = "Description"      # Optional
    disabled                       = "false"             # Optional
    default_warehouse              = "WAREHOUSE_NAME"   # Optional
    default_role                   = "ROLE_NAME"       # Optional
    default_secondary_roles_option = "NONE"             # Optional
    must_change_password           = "true"             # Optional
    disable_mfa                    = "false"            # Optional
    roles_to_assign                = ["ROLE1", "ROLE2"] # Optional
  }
}
</code></pre>
<p><strong>Example:</strong></p>
<pre><code class="language-hcl">module "ALL_USERS" {
  source = "./modules/snowflake/users"
  
  user_map = {
    "TEST_USER1" = {
      first_name  = "Test"
      last_name   = "User1"
      email       = "test.user1@example.com"
      user_type   = "person"
      roles_to_assign = [
        module.ALL_ROLES.ROLES.SALES.name,
        module.ALL_ROLES.ROLES.MARKETING.name
      ]
    }
  }
}
</code></pre>
<p><strong>Field Details:</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Required</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td><code>first_name</code></td><td><code>string</code></td><td>Yes</td><td>-</td><td>User’s first name</td></tr>
<tr><td><code>last_name</code></td><td><code>string</code></td><td>Yes</td><td>-</td><td>User’s last name</td></tr>
<tr><td><code>user_type</code></td><td><code>string</code></td><td>Yes</td><td>-</td><td>“person”, “service”, or “legacy_service”</td></tr>
<tr><td><code>email</code></td><td><code>string</code></td><td>No</td><td><code>null</code></td><td>User’s email address</td></tr>
<tr><td><code>comment</code></td><td><code>string</code></td><td>No</td><td><code>null</code></td><td>Comment describing the user</td></tr>
<tr><td><code>disabled</code></td><td><code>string</code></td><td>No</td><td><code>"false"</code></td><td>Whether user is disabled (“true” or “false”)</td></tr>
<tr><td><code>default_warehouse</code></td><td><code>string</code></td><td>No</td><td><code>"NONE"</code></td><td>Default warehouse (use “NONE” for no default)</td></tr>
<tr><td><code>default_role</code></td><td><code>string</code></td><td>No</td><td><code>"NONE"</code></td><td>Default role (use “NONE” for PUBLIC)</td></tr>
<tr><td><code>default_secondary_roles_option</code></td><td><code>string</code></td><td>No</td><td><code>"NONE"</code></td><td>Secondary roles option</td></tr>
<tr><td><code>must_change_password</code></td><td><code>string</code></td><td>No</td><td><code>"true"</code></td><td>Whether user must change password</td></tr>
<tr><td><code>disable_mfa</code></td><td><code>string</code></td><td>No</td><td><code>"false"</code></td><td>Whether MFA is disabled</td></tr>
<tr><td><code>roles_to_assign</code></td><td><code>list(string)</code></td><td>No</td><td><code>[]</code></td><td>List of role names to assign</td></tr>
</tbody></table>
</div>
<p><strong>User Type Notes:</strong></p>
<ul>
<li><strong>person</strong>: Standard user account for individuals</li>
<li><strong>service</strong>: Modern service account for applications (recommended)</li>
<li><strong>legacy_service</strong>: Legacy service account for backward compatibility</li>
</ul>
<h3 id="outputs-7"><a class="header" href="#outputs-7">Outputs</a></h3>
<h4 id="users-2"><a class="header" href="#users-2"><code>USERS</code></a></h4>
<p><strong>Type:</strong> <code>map(object)</code><br />
<strong>Description:</strong> Map of all created person user resources</p>
<p><strong>Usage:</strong></p>
<pre><code class="language-hcl">module.ALL_USERS.USERS.USERNAME
</code></pre>
<h4 id="service_users-2"><a class="header" href="#service_users-2"><code>SERVICE_USERS</code></a></h4>
<p><strong>Type:</strong> <code>map(object)</code><br />
<strong>Description:</strong> Map of all created service user resources</p>
<p><strong>Usage:</strong></p>
<pre><code class="language-hcl">module.ALL_USERS.SERVICE_USERS.SERVICE_USERNAME
</code></pre>
<h4 id="legacy_service_users-2"><a class="header" href="#legacy_service_users-2"><code>LEGACY_SERVICE_USERS</code></a></h4>
<p><strong>Type:</strong> <code>map(object)</code><br />
<strong>Description:</strong> Map of all created legacy service user resources</p>
<p><strong>Usage:</strong></p>
<pre><code class="language-hcl">module.ALL_USERS.LEGACY_SERVICE_USERS.LEGACY_USERNAME
</code></pre>
<h2 id="warehouse-module-2"><a class="header" href="#warehouse-module-2">Warehouse Module</a></h2>
<h3 id="inputs-5"><a class="header" href="#inputs-5">Inputs</a></h3>
<h4 id="warehouse_map-2"><a class="header" href="#warehouse_map-2"><code>warehouse_map</code></a></h4>
<p><strong>Type:</strong> <code>map(object)</code><br />
<strong>Required:</strong> Yes<br />
<strong>Description:</strong> Map of warehouse names to warehouse configurations</p>
<p><strong>Structure:</strong></p>
<pre><code class="language-hcl">warehouse_map = {
  "WAREHOUSE_NAME" = {
    warehouse_type                = "STANDARD"           # Required
    warehouse_generation          = "2"                   # Required
    warehouse_size                = "SMALL"              # Optional
    warehouse_max_cluster_count   = 1                    # Optional
    warehouse_min_cluster_count   = 1                    # Optional
    warehouse_scaling_policy      = "ECONOMY"            # Optional
    warehouse_auto_suspend        = 60                   # Optional
    warehouse_auto_resume          = true                 # Optional
    warehouse_initially_suspended  = true                 # Optional
    warehouse_comment             = "Description"        # Optional
    warehouse_max_concurrency_level = 8                  # Optional
    warehouse_statement_timeout_in_seconds = 900          # Optional
    role_privileges = [                                   # Required
      {
        account_role_name = "ROLE_NAME"
        privileges        = ["USAGE"]
      }
    ]
    with_grant_option = false                            # Optional
  }
}
</code></pre>
<p><strong>Example:</strong></p>
<pre><code class="language-hcl">module "ALL_WAREHOUSES" {
  source = "./modules/snowflake/warehouse"
  
  warehouse_map = {
    "MARKETING_XSMALL_WH" = {
      warehouse_type                = "STANDARD"
      warehouse_generation          = "2"
      warehouse_max_cluster_count   = 1
      warehouse_min_cluster_count   = 1
      warehouse_scaling_policy      = "ECONOMY"
      warehouse_initially_suspended = true
      warehouse_comment             = "Warehouse for Marketing team"
      role_privileges = [
        {
          account_role_name = module.ALL_ROLES.ROLES.MARKETING.name
          privileges        = ["USAGE"]
        }
      ]
      with_grant_option = false
    }
  }
}
</code></pre>
<p><strong>Field Details:</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Required</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td><code>warehouse_type</code></td><td><code>string</code></td><td>Yes</td><td>-</td><td>“STANDARD” or “SNOWPARK-OPTIMIZED”</td></tr>
<tr><td><code>warehouse_generation</code></td><td><code>string</code></td><td>Yes</td><td>-</td><td>“1” or “2” (recommended: “2”)</td></tr>
<tr><td><code>warehouse_size</code></td><td><code>string</code></td><td>No</td><td><code>"XSMALL"</code></td><td>Size: XSMALL, SMALL, MEDIUM, LARGE, etc.</td></tr>
<tr><td><code>warehouse_max_cluster_count</code></td><td><code>number</code></td><td>No</td><td><code>1</code></td><td>Maximum clusters (1-10)</td></tr>
<tr><td><code>warehouse_min_cluster_count</code></td><td><code>number</code></td><td>No</td><td><code>1</code></td><td>Minimum clusters (1-10)</td></tr>
<tr><td><code>warehouse_scaling_policy</code></td><td><code>string</code></td><td>No</td><td><code>"ECONOMY"</code></td><td>“STANDARD” or “ECONOMY”</td></tr>
<tr><td><code>warehouse_auto_suspend</code></td><td><code>number</code></td><td>No</td><td><code>60</code></td><td>Auto-suspend time in seconds</td></tr>
<tr><td><code>warehouse_auto_resume</code></td><td><code>bool</code></td><td>No</td><td><code>true</code></td><td>Whether to auto-resume</td></tr>
<tr><td><code>warehouse_initially_suspended</code></td><td><code>bool</code></td><td>No</td><td><code>true</code></td><td>Whether warehouse starts suspended</td></tr>
<tr><td><code>warehouse_comment</code></td><td><code>string</code></td><td>No</td><td><code>null</code></td><td>Comment describing the warehouse</td></tr>
<tr><td><code>warehouse_max_concurrency_level</code></td><td><code>number</code></td><td>No</td><td><code>8</code></td><td>Maximum concurrent queries</td></tr>
<tr><td><code>warehouse_statement_timeout_in_seconds</code></td><td><code>number</code></td><td>No</td><td><code>900</code></td><td>Statement timeout in seconds</td></tr>
<tr><td><code>role_privileges</code></td><td><code>list(object)</code></td><td>Yes</td><td>-</td><td>List of role privilege grants</td></tr>
<tr><td><code>with_grant_option</code></td><td><code>bool</code></td><td>No</td><td><code>false</code></td><td>Whether grants include grant option</td></tr>
</tbody></table>
</div>
<p><strong>Role Privilege Object:</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody>
<tr><td><code>account_role_name</code></td><td><code>string</code></td><td>Yes</td><td>Name of the role receiving privileges</td></tr>
<tr><td><code>privileges</code></td><td><code>list(string)</code></td><td>Yes</td><td>List of privileges: “USAGE”, “OPERATE”, “MODIFY”, “MONITOR”, “ALL PRIVILEGES”</td></tr>
</tbody></table>
</div>
<h3 id="outputs-8"><a class="header" href="#outputs-8">Outputs</a></h3>
<h4 id="warehouses-2"><a class="header" href="#warehouses-2"><code>WAREHOUSES</code></a></h4>
<p><strong>Type:</strong> <code>map(object)</code><br />
<strong>Description:</strong> Map of all created warehouse resources, keyed by warehouse name</p>
<p><strong>Structure:</strong></p>
<pre><code class="language-hcl">{
  "WAREHOUSE_NAME" = {
    name = "WAREHOUSE_NAME"
    size = "SMALL"
    # ... other Snowflake warehouse attributes
  }
}
</code></pre>
<p><strong>Usage:</strong></p>
<pre><code class="language-hcl"># Reference a warehouse
module.ALL_WAREHOUSES.WAREHOUSES.MARKETING_XSMALL_WH.name
</code></pre>
<h2 id="provider-requirements-8"><a class="header" href="#provider-requirements-8">Provider Requirements</a></h2>
<p>All modules require provider aliases:</p>
<h3 id="roles-module-3"><a class="header" href="#roles-module-3">Roles Module</a></h3>
<pre><code class="language-hcl">providers = {
  snowflake = snowflake.snowflake_securityadmin
}
</code></pre>
<h3 id="users-module-3"><a class="header" href="#users-module-3">Users Module</a></h3>
<pre><code class="language-hcl">providers = {
  snowflake = snowflake.snowflake_securityadmin
}
</code></pre>
<h3 id="warehouse-module-3"><a class="header" href="#warehouse-module-3">Warehouse Module</a></h3>
<pre><code class="language-hcl">providers = {
  snowflake = snowflake.snowflake_sysadmin
}
</code></pre>
<h2 id="common-patterns-3"><a class="header" href="#common-patterns-3">Common Patterns</a></h2>
<h3 id="referencing-module-outputs"><a class="header" href="#referencing-module-outputs">Referencing Module Outputs</a></h3>
<pre><code class="language-hcl"># Reference roles
roles_to_assign = [module.ALL_ROLES.ROLES.ANALYST.name]

# Reference warehouses
default_warehouse = module.ALL_WAREHOUSES.WAREHOUSES.MY_WH.name
</code></pre>
<h3 id="conditional-configuration-1"><a class="header" href="#conditional-configuration-1">Conditional Configuration</a></h3>
<pre><code class="language-hcl"># Conditional role assignment
roles_to_assign = var.environment == "prod" ? 
  [module.ALL_ROLES.ROLES.PROD_ROLE.name] : 
  [module.ALL_ROLES.ROLES.DEV_ROLE.name]
</code></pre>
<h3 id="dynamic-configuration"><a class="header" href="#dynamic-configuration">Dynamic Configuration</a></h3>
<pre><code class="language-hcl"># Dynamic warehouse configuration
warehouse_map = {
  for env in ["dev", "staging", "prod"] : "WH_${env}" =&gt; {
    warehouse_type       = "STANDARD"
    warehouse_generation = "2"
    warehouse_size       = env == "prod" ? "LARGE" : "SMALL"
    # ... other configuration
  }
}
</code></pre>
<h2 id="related-documentation-10"><a class="header" href="#related-documentation-10">Related Documentation</a></h2>
<ul>
<li><a href="reference/variables.html">Variables Reference</a> - Root module variables</li>
<li><a href="reference/outputs.html">Outputs Reference</a> - Root module outputs</li>
<li><a href="reference/../modules/roles-module.html">Roles Module</a> - Detailed roles module documentation</li>
<li><a href="reference/../modules/users-module.html">Users Module</a> - Detailed users module documentation</li>
<li><a href="reference/../modules/warehouse-module.html">Warehouse Module</a> - Detailed warehouse module documentation</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>

    </div>
    </body>
</html>
